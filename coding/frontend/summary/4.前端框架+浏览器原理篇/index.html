<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <link rel="icon" href="https://wannadoing.gitee.io/pic/own-icon.jpg"><title>å‰ç«¯æ¡†æ¶ã€æµè§ˆå™¨åŸç† | Just to do it</title><meta name="description" content="todoingçš„ä¸ªäººçŸ¥è¯†åº“">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.e6ae6583.css">
    <link rel="modulepreload" href="/assets/app.02ae940c.js"><link rel="modulepreload" href="/assets/index.html.68a8b349.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/index.html.e15be7aa.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="https://wannadoing.gitee.io/pic/own-icon.jpg" alt="Just to do it"><!----><span class="site-name hide-in-pad">Just to do it</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home"></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/coding" class="nav-link active" aria-label="coding"><span class="icon iconfont icon-react"></span>coding<!----></a></div><div class="nav-item hide-in-mobile"><a href="/studySchool/" class="nav-link" aria-label="è¯¾ç¨‹ç¬”è®°"><span class="icon iconfont icon-note"></span>è¯¾ç¨‹ç¬”è®°<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ›´å¤š"><span class="title"><span class="icon iconfont icon-more"></span>æ›´å¤š</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/slides.html" class="nav-link" aria-label="ä½¿ç”¨éœ€çŸ¥"><span class="icon iconfont icon-warn"></span>ä½¿ç”¨éœ€çŸ¥<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>èµ„æºåº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://todoing.github.io/store" rel="noopener noreferrer" target="_blank" aria-label="ä¸»é“¾" class="nav-link"><!---->ä¸»é“¾<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://wannadoing.github.io" rel="noopener noreferrer" target="_blank" aria-label="å¤‡ç”¨é“¾" class="nav-link"><!---->å¤‡ç”¨é“¾<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li><li class="dropdown-item"><a href="/functionTest" class="nav-link" aria-label="åŠŸèƒ½æµ‹è¯•"><span class="icon iconfont icon-app"></span>åŠŸèƒ½æµ‹è¯•<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="http://todoing.github.io/blog" rel="noopener noreferrer" target="_blank" aria-label="blog" class="nav-link"><span class="icon iconfont icon-editor"></span>blog<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æ–‡ç« å¯¼å›¾" class="router-link-active router-link-exact-active nav-link sidebar-link sidebar-heading" aria-label="æ–‡ç« å¯¼å›¾"><!---->æ–‡ç« å¯¼å›¾<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#å‰ç«¯æ¡†æ¶" class="router-link-active router-link-exact-active nav-link sidebar-link sidebar-heading" aria-label="å‰ç«¯æ¡†æ¶"><!---->å‰ç«¯æ¡†æ¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#vue" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Vue"><!---->Vue<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#react" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="React"><!---->React<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æœåŠ¡ç«¯æ¸²æŸ“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æœåŠ¡ç«¯æ¸²æŸ“"><!---->æœåŠ¡ç«¯æ¸²æŸ“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#node" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Node"><!---->Node<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨" class="router-link-active router-link-exact-active nav-link sidebar-link sidebar-heading" aria-label="è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨"><!---->è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#ä»è¾“å…¥-url-åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»è¾“å…¥ URL åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"><!---->ä»è¾“å…¥ URL åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#å½»åº•å¼„æ‡‚-cors-è·¨åŸŸè¯·æ±‚" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å½»åº•å¼„æ‡‚ cors è·¨åŸŸè¯·æ±‚"><!---->å½»åº•å¼„æ‡‚ cors è·¨åŸŸè¯·æ±‚<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#tcp-çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"><!---->TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#websocket" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="WebSocket"><!---->WebSocket<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#tcp-å’Œ-udp-çš„åŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="TCP å’Œ UDP çš„åŒºåˆ«"><!---->TCP å’Œ UDP çš„åŒºåˆ«<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#keep-alive-æŒä¹…è¿æ¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="keep-alive æŒä¹…è¿æ¥"><!---->keep-alive æŒä¹…è¿æ¥<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#http1ã€2ã€3-çš„åŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="http1ã€2ã€3 çš„åŒºåˆ«"><!---->http1ã€2ã€3 çš„åŒºåˆ«<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#https-æ¡æ‰‹è¿‡ç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="HTTPS æ¡æ‰‹è¿‡ç¨‹"><!---->HTTPS æ¡æ‰‹è¿‡ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»"><!---->ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#dns-è§£æè¿‡ç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="DNS è§£æè¿‡ç¨‹"><!---->DNS è§£æè¿‡ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#xss-è·¨ç«™è„šæœ¬æ”»å‡»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="XSS(è·¨ç«™è„šæœ¬æ”»å‡»)"><!---->XSS(è·¨ç«™è„šæœ¬æ”»å‡»)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="csrf è·¨ç«™è¯·æ±‚ä¼ªé€ "><!---->csrf è·¨ç«™è¯·æ±‚ä¼ªé€ <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#jsonp-å®‰å…¨é˜²èŒƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="jsonp å®‰å…¨é˜²èŒƒ"><!---->jsonp å®‰å…¨é˜²èŒƒ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æµè§ˆå™¨å¦‚ä½•éªŒè¯-ca-è¯ä¹¦çš„æœ‰æ•ˆæ€§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æµè§ˆå™¨å¦‚ä½•éªŒè¯ ca è¯ä¹¦çš„æœ‰æ•ˆæ€§"><!---->æµè§ˆå™¨å¦‚ä½•éªŒè¯ ca è¯ä¹¦çš„æœ‰æ•ˆæ€§<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#csp-å†…å®¹å®‰å…¨ç­–ç•¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="csp å†…å®¹å®‰å…¨ç­–ç•¥"><!---->csp å†…å®¹å®‰å…¨ç­–ç•¥<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æµè§ˆå™¨åŸç†" class="router-link-active router-link-exact-active nav-link sidebar-link sidebar-heading" aria-label="æµè§ˆå™¨åŸç†"><!---->æµè§ˆå™¨åŸç†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->å‰ç«¯æ¡†æ¶ã€æµè§ˆå™¨åŸç†</h1><div class="page-info"><!----><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 21543 å­—</span><meta property="wordCount" content="21543"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 72 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT72M"></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag5" role>å¼•ç”¨æ–‡ç« </span></li></ul><meta property="keywords" content="å¼•ç”¨æ–‡ç« "></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æ–‡ç« å¯¼å›¾" class="router-link-active router-link-exact-active toc-link level2">æ–‡ç« å¯¼å›¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#å‰ç«¯æ¡†æ¶" class="router-link-active router-link-exact-active toc-link level2">å‰ç«¯æ¡†æ¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#vue" class="router-link-active router-link-exact-active toc-link level3">Vue</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#react" class="router-link-active router-link-exact-active toc-link level3">React</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æœåŠ¡ç«¯æ¸²æŸ“" class="router-link-active router-link-exact-active toc-link level3">æœåŠ¡ç«¯æ¸²æŸ“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#node" class="router-link-active router-link-exact-active toc-link level3">Node</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨" class="router-link-active router-link-exact-active toc-link level2">è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#ä»è¾“å…¥-url-åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">ä»è¾“å…¥ URL åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#å½»åº•å¼„æ‡‚-cors-è·¨åŸŸè¯·æ±‚" class="router-link-active router-link-exact-active toc-link level3">å½»åº•å¼„æ‡‚ cors è·¨åŸŸè¯·æ±‚</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#tcp-çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" class="router-link-active router-link-exact-active toc-link level3">TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#websocket" class="router-link-active router-link-exact-active toc-link level3">WebSocket</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#tcp-å’Œ-udp-çš„åŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">TCP å’Œ UDP çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#keep-alive-æŒä¹…è¿æ¥" class="router-link-active router-link-exact-active toc-link level3">keep-alive æŒä¹…è¿æ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#http1ã€2ã€3-çš„åŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">http1ã€2ã€3 çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#https-æ¡æ‰‹è¿‡ç¨‹" class="router-link-active router-link-exact-active toc-link level3">HTTPS æ¡æ‰‹è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»" class="router-link-active router-link-exact-active toc-link level3">ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#dns-è§£æè¿‡ç¨‹" class="router-link-active router-link-exact-active toc-link level3">DNS è§£æè¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#xss-è·¨ç«™è„šæœ¬æ”»å‡»" class="router-link-active router-link-exact-active toc-link level3">XSS(è·¨ç«™è„šæœ¬æ”»å‡»)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ " class="router-link-active router-link-exact-active toc-link level3">csrf è·¨ç«™è¯·æ±‚ä¼ªé€ </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#jsonp-å®‰å…¨é˜²èŒƒ" class="router-link-active router-link-exact-active toc-link level3">jsonp å®‰å…¨é˜²èŒƒ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æµè§ˆå™¨å¦‚ä½•éªŒè¯-ca-è¯ä¹¦çš„æœ‰æ•ˆæ€§" class="router-link-active router-link-exact-active toc-link level3">æµè§ˆå™¨å¦‚ä½•éªŒè¯ ca è¯ä¹¦çš„æœ‰æ•ˆæ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#csp-å†…å®¹å®‰å…¨ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level3">csp å†…å®¹å®‰å…¨ç­–ç•¥</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/coding/frontend/summary/4.%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6+%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E7%AF%87/#æµè§ˆå™¨åŸç†" class="router-link-active router-link-exact-active toc-link level2">æµè§ˆå™¨åŸç†</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p>å¼•ç”¨äº<a href="https://juejin.cn/post/7146996646394462239" target="_blank" rel="noopener noreferrer">æ˜é‡‘-æµ·é˜”_å¤©ç©º<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="æ–‡ç« å¯¼å›¾" tabindex="-1"><a class="header-anchor" href="#æ–‡ç« å¯¼å›¾" aria-hidden="true">#</a> æ–‡ç« å¯¼å›¾</h2><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9af6a68af1804b499a5c14273405319b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="ç¬¬4ç¯‡.png"></p><h2 id="å‰ç«¯æ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#å‰ç«¯æ¡†æ¶" aria-hidden="true">#</a> å‰ç«¯æ¡†æ¶</h2><h3 id="vue" tabindex="-1"><a class="header-anchor" href="#vue" aria-hidden="true">#</a> Vue</h3><h4 id="æ‰‹å†™-mini-ç‰ˆçš„-mvvm-æ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#æ‰‹å†™-mini-ç‰ˆçš„-mvvm-æ¡†æ¶" aria-hidden="true">#</a> æ‰‹å†™ mini ç‰ˆçš„ MVVM æ¡†æ¶</h4><p>å®ç°æ•ˆæœï¼š2s åä¿®æ”¹å§“åå’Œå¹´é¾„è¿™ä¸¤ä¸ªå€¼ï¼Œé¡µé¢å“åº”å¼æ›´æ–°æ¸²æŸ“</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6009534122ef4cfe99f8db3188d9e5a5~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="mvvm.gif"></p><p><strong>å®ç°æµç¨‹</strong></p><p>1ï¼‰å®šä¹‰<code>observeå‡½æ•°</code>ï¼Œåˆ©ç”¨<code>Object.defineProperty</code>æŠŠ data ä¸­çš„å±æ€§å˜æˆå“åº”å¼çš„ï¼ŒåŒæ—¶ç»™æ¯ä¸€ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ª<code>depå¯¹è±¡</code>ï¼ˆç”¨æ¥å­˜å‚¨å¯¹åº”çš„<code>watcherè§‚å¯Ÿè€…</code>ï¼‰</p><p>2ï¼‰å®šä¹‰<code>compile å‡½æ•°</code>ï¼Œæ¨¡æ¿ç¼–è¯‘ï¼Œéå† DOMï¼Œé‡åˆ° <code>mustache</code>ï¼ˆåŒå¤§æ‹¬å·)å½¢å¼çš„æ–‡æœ¬ï¼Œåˆ™æ›¿æ¢æˆ data.key å¯¹åº”çš„å€¼ï¼ŒåŒæ—¶å°†è¯¥ dom èŠ‚ç‚¹æ·»åŠ åˆ°å¯¹åº” key å€¼çš„ dep å¯¹è±¡ä¸­</p><p>3ï¼‰å½“ data çš„æ•°æ®å˜åŒ–æ—¶ï¼Œè°ƒç”¨ dep å¯¹è±¡çš„<code>update</code>æ–¹æ³•ï¼Œæ›´æ–°æ‰€æœ‰è§‚å¯Ÿè€…ä¸­çš„ dom èŠ‚ç‚¹</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>vueçš„MVVMç®€å•å®ç°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>å§“å: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>å¹´é¾„: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
  window.onload = function () {
    // newä¸€ä¸ªvueå®ä¾‹
    let vue = new Vue(
       {
         el: &#39;#app&#39;,
         data: {
             name: &#39;åŠ è½½ä¸­&#39;, age: &#39;18&#39;
           }
         }
      )
    // 2såæ›´æ–°é¡µé¢çš„ä¿¡æ¯
    setTimeout(() =&gt; {
      // ä¿®æ”¹vueä¸­$dataçš„nameå’Œageå±æ€§
      vue.$data.name = &#39;å°æ˜&#39;;
      vue.$data.age = 20;
    }, 2000)
  }
  class Vue {
    constructor(options) {
      this.options = options
      this.$data = options.data
      this.observe(options.data)
      this.compile(document.querySelector(options.el))
    }
    // ç›‘å¬dataä¸­å±æ€§çš„å˜åŒ–
    observe(data) {
      Object.keys(data).forEach(key =&gt; {
        // ç»™dataä¸­çš„æ¯ä¸€ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ªdepå¯¹è±¡ï¼ˆè¯¥å¯¹è±¡ç”¨æ¥å­˜å‚¨å¯¹åº”çš„watcherè§‚å¯Ÿè€…ï¼‰
        let observer = new Dep()
        // åˆ©ç”¨é—­åŒ… è·å–å’Œè®¾ç½®å±æ€§çš„æ—¶å€™ï¼Œæ“ä½œçš„éƒ½æ˜¯value
        let value = data[key]
        Object.defineProperty(data, key, {
          get() {
            // è§‚å¯Ÿè€…å¯¹è±¡æ·»åŠ å¯¹åº”çš„domèŠ‚ç‚¹
            Dep.target &amp;&amp; observer.add(Dep.target)
            return value
          },
          set(newValue) {
            value = newValue
            // å±æ€§å€¼å˜åŒ–æ—¶ï¼Œæ›´æ–°è§‚å¯Ÿè€…ä¸­æ‰€æœ‰èŠ‚ç‚¹
            observer.update(newValue)
          }
        })
      })
    }
    compile(dom) {
      dom.childNodes.forEach(child =&gt; {
        // nodeType ä¸º3æ—¶ä¸ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹çš„å†…å®¹åŒ…å«`mustache`ï¼ˆåŒå¤§æ‹¬å·{{}})
        if(child.nodeType === 3 &amp;&amp; /\{\{(.*)\}\}/.test(child.textContent)) {
          // RegExp.$1æ˜¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™é‡Œå¯¹åº”çš„å°±æ˜¯dataä¸­çš„keyå€¼
          let key = RegExp.$1.trim()
          // å°†è¯¥èŠ‚ç‚¹æ·»åŠ åˆ°å¯¹åº”çš„è§‚å¯Ÿè€…å¯¹è±¡ä¸­ï¼Œåœ¨ä¸‹é¢çš„çš„this.options.data[key]ä¸­è§¦å‘å¯¹åº”çš„getæ–¹æ³•
          Dep.target = child
          // å°†{{key}} æ›¿æ¢æˆdataä¸­å¯¹åº”çš„å€¼
          child.textContent = child.textContent.replace(`{{${key}}}`, this.options.data[key])
          Dep.target = null
        }
        // é€’å½’éå†å­èŠ‚ç‚¹
        if(child.childNodes.length) {
          this.compile(child)
        }
      })
    }
  }

  // depå¯¹è±¡å­˜å‚¨æ‰€æœ‰çš„è§‚å¯Ÿè€…
  class Dep {
    constructor() {
      this.watcherList = []
    }
    // æ·»åŠ watcher
    add(node) {
      this.watcherList.push(node)
    }
    // æ›´æ–°watcher
    update(value) {
      this.watcherList.forEach(node =&gt; {
        node.textContent= value
      })
    }
  }
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://juejin.cn/post/6844903619808985095" target="_blank" rel="noopener noreferrer">50 è¡Œä»£ç çš„ MVVMï¼Œæ„Ÿå—é—­åŒ…çš„è‰ºæœ¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="æ‰‹å†™-v-model-æ•°æ®åŒå‘ç»‘å®š" tabindex="-1"><a class="header-anchor" href="#æ‰‹å†™-v-model-æ•°æ®åŒå‘ç»‘å®š" aria-hidden="true">#</a> æ‰‹å†™ v-model æ•°æ®åŒå‘ç»‘å®š</h4><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cfeedc6eb44b4dce9c5d1c174f35910e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="mvvm1.gif"></p><p><strong>å’Œå‰æ–‡ mini ç‰ˆ MVVM æ¡†æ¶çš„åŒºåˆ«</strong></p><p>1ï¼‰å®ç°<code>v-model</code>æŒ‡ä»¤ï¼Œinput å€¼æ”¹å˜åï¼Œé¡µé¢å¯¹åº”çš„æ•°æ®ä¹Ÿä¼šå˜åŒ–ï¼Œå®ç°äº†<code>æ•°æ®çš„åŒå‘ç»‘å®š</code></p><p>2ï¼‰ç»™ input å…ƒç´ ç»‘å®š<code>inputäº‹ä»¶</code>ï¼Œå½“è¾“å…¥å€¼å˜åŒ–ä¼šè§¦å‘å¯¹åº”å±æ€§çš„<code>dep.update</code>æ–¹æ³•ï¼Œé€šçŸ¥å¯¹åº”çš„è§‚å¯Ÿè€…å‘ç”Ÿå˜åŒ–</p><p>3ï¼‰å¢åŠ äº†æ•°æ®ä»£ç†ï¼Œé€šè¿‡<code>this.info.person.name</code>å°±å¯ä»¥ç›´æ¥ä¿® <code>$data</code>å¯¹åº”çš„å€¼ï¼Œå®ç°äº†<code>thiså¯¹this.$data</code>çš„ä»£ç†</p><p>4ï¼‰æ•°æ®åŠ«æŒï¼Œå¯¹ data å¢åŠ äº†é€’å½’å’Œè®¾ç½®æ–°å€¼çš„åŠ«æŒï¼Œè®© data ä¸­æ¯ä¸€å±‚æ•°æ®éƒ½æ˜¯å“åº”å¼çš„ï¼Œå¦‚<code>info.person.name</code></p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>vueåŒå‘ç»‘å®šçš„ç®€å•å®ç°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>å¹´é¾„: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{info.person.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{job}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>job<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>è¯·è¾“å…¥å·¥ä½œ<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
  window.onload = function () {
    // newä¸€ä¸ªvueå¯¹è±¡
    let vm = new Vue({
      // elä¸ºéœ€è¦æŒ‚è½½çš„domèŠ‚ç‚¹
      el: &#39;#app&#39;,
      data: {
        info: {
          person: {
            name: &#39;åŠ è½½ä¸­&#39;
          }
        },
        job: &#39;ç¨‹åºçŒ¿&#39;
      }
    })
    setTimeout(() =&gt; {
      vm.info.person.name = &#39;å°æ˜&#39;
    }, 2000)
  }

  class Vue {
    constructor(options) {
      this.$data = options.data
      this.$el = document.querySelector(options.el)
      observe(options.data)
      this.proxy(this.$data, this)
      this.compile(this.$el, this)
    }
    // æ¨¡æ¿ç¼–è¯‘
    compile (dom, vm) {
      Array.from(dom.childNodes).forEach(child =&gt; {
        // å…ƒç´ èŠ‚ç‚¹,åŒ¹é…v-modelï¼Œå¦‚input textAreaå…ƒç´ ç­‰
        if (child.nodeType == 1) {
          Array.from(child.attributes).forEach(attr =&gt; {
            // åˆ¤æ–­å…ƒç´ æ˜¯å¦è®¾ç½® v-model å±æ€§
            if (attr.name.includes(&#39;v-model&#39;)) {
              Dep.target = child
              child.value = vm.$data[attr.value]
              Dep.target = null
              // é‡ç‚¹ï¼šç»™inputåŸå®šç»‘å®šåŸç”Ÿçš„inputäº‹ä»¶
              child.addEventListener(&#39;input&#39;, (e) =&gt; {
                // å½“inputè¾“å…¥å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒåŠ¨æ€è®¾ç½®vm.$data[attr.value]çš„å€¼
                vm.$data[attr.value] = e.target.value
              })
            }
          })
        }
        if (child.nodeType === 3 &amp;&amp; /\{\{(.*)\}\}/.test(child.textContent)) {
          let key = RegExp.$1.trim()
          let keyList = key.split(&#39;.&#39;)
          let value = vm.$data
          Dep.target = child

          // å¾ªç¯éå†ï¼Œæ‰¾åˆ°info.person.nameå¯¹åº”çš„nameå€¼
          keyList.forEach(item =&gt; {
            value = value[item]
          })
          Dep.target = null
          child.textContent = child.textContent.replace(`{{${key}}}`, value)
        }
        if (child.childNodes.length &gt; 0) {
          // é€’å½’æ¨¡æ¿ç¼–è¯‘
          this.compile(child, vm)
        }
      })
    }
    // thisä»£ç† this.$data
    // vm.info.person.name ç›¸å½“äº vm.$data.info.person.name
    proxy ($data, vm) {
      Object.keys($data).forEach(key =&gt; {
        Object.defineProperty(vm, key, {
          set (newValue) {
            $data[key] = newValue
          },
          get () {
            return $data[key]
          }
        })
      })
    }
  }
  function observe (data) {
    if (data &amp;&amp; typeof data == &#39;object&#39;) {
      return new Observe(data)
    }
  }
  // é€’å½’è¿›è¡Œæ•°æ®åŠ«æŒï¼Œä½¿dataä¸­çš„æ¯ä¸€å±‚éƒ½æ˜¯å“åº”å¼çš„
  function Observe(data) {
    Object.keys(data).forEach(key =&gt; {
      let value = data[key]
      let dep = new Dep()
      // é€’å½’
      observe(value)
      Object.defineProperty(data, key, {
        get () {
          Dep.target &amp;&amp; dep.add(Dep.target)
          return value
        },
        set (newValue) {
          value = newValue
          // å¦‚æœæ–°è®¾ç½®çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¹Ÿè¦å˜æˆå“åº”å¼çš„
          observe(newValue)
          dep.update(newValue)
        }
      })
    })
  }

  class Dep {
    constructor() {
      this.subs = []
    }
    add (target) {
      this.subs.push(target)
    }
    update (newValue) {
      this.subs.forEach(node =&gt; {
        if (node.tagName == &#39;INPUT&#39; || node.tagName == &#39;TEXTATEA&#39;) {
          node.value = newValue
        } else {
          node.textContent = newValue
        }
      })
    }
  }

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fxy-sea%2Fblog%2Fblob%2Fdev%2Fmini-vue%2F%E6%89%8B%E5%86%99v-model%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A.html" target="_blank" rel="noopener noreferrer">æ‰‹å†™ v-model çš„ github æºç åœ°å€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="ä½¿ç”¨-proxy-å®ç°æ•°æ®ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-proxy-å®ç°æ•°æ®ç›‘å¬" aria-hidden="true">#</a> ä½¿ç”¨ proxy å®ç°æ•°æ®ç›‘å¬</h4><p>vue3 åº•å±‚é€šè¿‡<code>Proxy</code>å®ç°äº†æ•°æ®ç›‘å¬ï¼Œæ›¿ä»£äº† vue2 ä¸­çš„<code>Object.defineProperty</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// é€’å½’è·å–å¯¹è±¡å¤šå±‚åµŒå¥—çš„æƒ…å†µï¼Œå¦‚pro.info.typeï¼ˆé€’å½’ç›‘å¬ï¼Œä¿è¯æ¯ä¸€å±‚è¿”å›éƒ½æ˜¯proxyå¯¹è±¡ï¼‰</span>
      <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token string">&quot;length&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è§£å†³å¯¹æ•°ç»„ä¿®æ”¹ï¼Œé‡å¤æ›´æ–°è§†å›¾çš„é—®é¢˜</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æ›´æ–°è§†å›¾&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> target <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">observe</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;æµ‹è¯•&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pro <span class="token operator">=</span> <span class="token function">observe</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
pro<span class="token punctuation">.</span>info<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// æ›´æ–°è§†å›¾</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="vue-å¼‚æ­¥æ›´æ–°åŸç†" tabindex="-1"><a class="header-anchor" href="#vue-å¼‚æ­¥æ›´æ–°åŸç†" aria-hidden="true">#</a> vue å¼‚æ­¥æ›´æ–°åŸç†</h4><p><strong>Vue çš„æ•°æ®é¢‘ç¹å˜åŒ–ï¼Œä½†ä¸ºä»€ä¹ˆ dom åªä¼šæ›´æ–°ä¸€æ¬¡ï¼Ÿ</strong></p><p>1ï¼‰Vue æ•°æ®å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œä¸ä¼šç«‹å³æ›´æ–° domï¼Œè€Œæ˜¯å¼‚æ­¥æ›´æ–°çš„</p><p>2ï¼‰ä¾¦å¬åˆ°æ•°æ®å˜åŒ–ï¼ŒVue å°†å¼€å¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ç¼“å­˜åœ¨åŒä¸€äº‹ä»¶å¾ªç¯ä¸­å‘ç”Ÿçš„æ‰€æœ‰æ•°æ®å˜æ›´</p><p>3ï¼‰å¦‚æœåŒä¸€ä¸ª <code>watcher</code> è¢«å¤šæ¬¡è§¦å‘ï¼Œåªä¼šè¢«æ¨å…¥åˆ°é˜Ÿåˆ—ä¸­ä¸€æ¬¡ï¼Œå¯ä»¥é¿å…é‡å¤ä¿®æ”¹ç›¸åŒçš„ domï¼Œè¿™ç§å»é™¤é‡å¤æ•°æ®ï¼Œå¯¹äºé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ DOM æ“ä½œæ˜¯éå¸¸é‡è¦çš„</p><p>4ï¼‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå¼‚æ­¥ watcher é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œä¸€æ¬¡æ€§æ›´æ–° DOM</p><p><strong>å¼‚æ­¥æ›´æ–°çš„æºç å®ç°</strong></p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code>// å®šä¹‰watcherç±»
class Watcher {
  update() {
    // æ”¾åˆ°watcheré˜Ÿåˆ—ä¸­ï¼Œå¼‚æ­¥æ›´æ–°
    queueWatcher(this);
  }
  // è§¦å‘æ›´æ–°
  run() {
    this.get();
  }
}

// é˜Ÿåˆ—ä¸­æ·»åŠ watcher
function queueWatcher(watcher) {
  <span class="token key attr-name">const id</span> <span class="token punctuation">=</span> <span class="token value attr-value">watcher.id;</span>
  // å…ˆåˆ¤æ–­watcheræ˜¯å¦å­˜åœ¨ å»æ‰é‡å¤çš„watcher
  if (!has[id]) {
    queue.push(watcher);
    <span class="token key attr-name">has[id]</span> <span class="token punctuation">=</span> <span class="token value attr-value">true;</span>
    if (!pending) {
      <span class="token key attr-name">pending</span> <span class="token punctuation">=</span> <span class="token value attr-value">true;</span>
      // ä½¿ç”¨å¼‚æ­¥æ›´æ–°watcher
      nextTick(flushSchedulerQueue);
    }
  }
}

<span class="token key attr-name">let queue</span> <span class="token punctuation">=</span> <span class="token value attr-value">[]; // å®šä¹‰watcheré˜Ÿåˆ—</span>
<span class="token key attr-name">let has</span> <span class="token punctuation">=</span> <span class="token value attr-value">{}; // ä½¿ç”¨å¯¹è±¡æ¥ä¿å­˜idï¼Œè¿›è¡Œå»é‡æ“ä½œ</span>
<span class="token key attr-name">let pending</span> <span class="token punctuation">=</span> <span class="token value attr-value">false; // å¦‚æœå¼‚æ­¥é˜Ÿåˆ—æ­£åœ¨æ‰§è¡Œï¼Œå°†ä¸ä¼šå†æ¬¡æ‰§è¡Œ</span>

// æ‰§è¡Œwatcheré˜Ÿåˆ—çš„ä»»åŠ¡
function flushSchedulerQueue() {
  <span class="token key attr-name">queue.forEach((watcher)</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; {</span>
    watcher.run();
    if (watcher.options.render) {
      // åœ¨æ›´æ–°ä¹‹åæ‰§è¡Œå¯¹åº”çš„å›è°ƒ: è¿™é‡Œæ˜¯updatedé’©å­å‡½æ•°
      watcher.cb();
    }
  });
  // æ‰§è¡Œå®Œæˆåæ¸…ç©ºé˜Ÿåˆ— é‡ç½®pendingçŠ¶æ€
  <span class="token key attr-name">queue</span> <span class="token punctuation">=</span> <span class="token value attr-value">[];</span>
  <span class="token key attr-name">has</span> <span class="token punctuation">=</span> <span class="token value attr-value">{};</span>
  <span class="token key attr-name">pending</span> <span class="token punctuation">=</span> <span class="token value attr-value">false;</span>
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nexttick-ä¸ºä»€ä¹ˆè¦ä¼˜å…ˆä½¿ç”¨å¾®ä»»åŠ¡å®ç°" tabindex="-1"><a class="header-anchor" href="#nexttick-ä¸ºä»€ä¹ˆè¦ä¼˜å…ˆä½¿ç”¨å¾®ä»»åŠ¡å®ç°" aria-hidden="true">#</a> nextTick ä¸ºä»€ä¹ˆè¦ä¼˜å…ˆä½¿ç”¨å¾®ä»»åŠ¡å®ç°ï¼Ÿ</h4><p>1ï¼‰vue nextTick çš„æºç å®ç°ï¼Œå¼‚æ­¥ä¼˜å…ˆçº§åˆ¤æ–­ï¼Œæ€»ç»“å°±æ˜¯<code>Promise &gt; MutationObserver &gt; setImmediate &gt; setTimeout</code></p><p>2ï¼‰ä¼˜å…ˆä½¿ç”¨ Promiseï¼Œå› ä¸ºæ ¹æ® <code>event loop</code> ä¸æµè§ˆå™¨æ›´æ–°æ¸²æŸ“æ—¶æœºï¼Œå®ä»»åŠ¡ â†’ å¾®ä»»åŠ¡ â†’ æ¸²æŸ“æ›´æ–°ï¼Œä½¿ç”¨å¾®ä»»åŠ¡ï¼Œæœ¬æ¬¡ event loop è½®è¯¢å°±å¯ä»¥è·å–åˆ°æ›´æ–°çš„ dom</p><p>3ï¼‰å¦‚æœä½¿ç”¨å®ä»»åŠ¡ï¼Œè¦åˆ°ä¸‹ä¸€æ¬¡<code>event loop</code>ä¸­ï¼Œæ‰èƒ½è·å–åˆ°æ›´æ–°çš„ dom</p><p><strong>nextTick çš„æºç å®ç°</strong></p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code>// å®šä¹‰nextTickçš„å›è°ƒé˜Ÿåˆ—
<span class="token key attr-name">let callbacks</span> <span class="token punctuation">=</span> <span class="token value attr-value">[];</span>

// æ‰¹é‡æ‰§è¡ŒnextTickçš„å›è°ƒé˜Ÿåˆ—
function flushCallbacks() {
  <span class="token key attr-name">callbacks.forEach((cb)</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; cb());</span>
  <span class="token key attr-name">callbacks</span> <span class="token punctuation">=</span> <span class="token value attr-value">[];</span>
  <span class="token key attr-name">pending</span> <span class="token punctuation">=</span> <span class="token value attr-value">false;</span>
}

//å®šä¹‰å¼‚æ­¥æ–¹æ³•ï¼Œä¼˜å…ˆä½¿ç”¨å¾®ä»»åŠ¡å®ç°
let timerFunc;

// ä¼˜å…ˆä½¿ç”¨promise å¾®ä»»åŠ¡
if (Promise) {
  <span class="token key attr-name">timerFunc</span> <span class="token punctuation">=</span> <span class="token value attr-value">function () {</span>
    return Promise.resolve().then(flushCallbacks);
  };
  // å¦‚ä¸æ”¯æŒpromiseï¼Œå†ä½¿ç”¨MutationObserver å¾®ä»»åŠ¡
} else if (MutationObserver) {
  <span class="token key attr-name">timerFunc</span> <span class="token punctuation">=</span> <span class="token value attr-value">function () {</span>
    <span class="token key attr-name">const textNode</span> <span class="token punctuation">=</span> <span class="token value attr-value">document.createTextNode(&#39;1&#39;);</span>
    <span class="token key attr-name">const observer</span> <span class="token punctuation">=</span> <span class="token value attr-value">new MutationObserver(() =&gt; {</span>
      flushCallbacks();
      observer.disconnect();
    });
    <span class="token key attr-name">const observe</span> <span class="token punctuation">=</span> <span class="token value attr-value">observer.observe(textNode, { characterData: true });</span>
    <span class="token key attr-name">textNode.textContent</span> <span class="token punctuation">=</span> <span class="token value attr-value">&#39;2&#39;;</span>
  };
  // å¾®ä»»åŠ¡ä¸æ”¯æŒï¼Œå†ä½¿ç”¨å®ä»»åŠ¡å®ç°
} else if (setImmediate) {
  <span class="token key attr-name">timerFunc</span> <span class="token punctuation">=</span> <span class="token value attr-value">function () {</span>
    setImmediate(flushCallbacks);
  };
} else {
  <span class="token key attr-name">timerFunc</span> <span class="token punctuation">=</span> <span class="token value attr-value">function () {</span>
    setTimeout(flushCallbacks);
  };
}

// å®šä¹‰nextTickæ–¹æ³•
export function nextTick(cb) {
  callbacks.push(cb);
  if (!pending) {
    <span class="token key attr-name">pending</span> <span class="token punctuation">=</span> <span class="token value attr-value">true;</span>
    timerFunc();
  }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://juejin.cn/post/6844903843197616136" target="_blank" rel="noopener noreferrer">ä½ çœŸçš„ç†è§£$nextTick ä¹ˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000008589736" target="_blank" rel="noopener noreferrer">Vue æºç è¯¦è§£ä¹‹ nextTickï¼šmicrotask æ‰æ˜¯æ ¸å¿ƒï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="computed-å’Œ-watch-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#computed-å’Œ-watch-çš„åŒºåˆ«" aria-hidden="true">#</a> computed å’Œ watch çš„åŒºåˆ«</h4><p>1ï¼‰è®¡ç®—å±æ€§æœ¬è´¨ä¸Šæ˜¯ <code>computed watcher</code>ï¼Œè€Œ watch æœ¬è´¨ä¸Šæ˜¯ <code>user watcher</code>ï¼ˆç”¨æˆ·è‡ªå·±å®šä¹‰çš„ watcherï¼‰</p><p>2ï¼‰computed æœ‰ç¼“å­˜çš„åŠŸèƒ½ï¼Œé€šè¿‡<code>dirty</code>æ§åˆ¶</p><p>3ï¼‰wacher è®¾ç½®<code>deepï¼štrue</code>ï¼Œå®ç°æ·±åº¦ç›‘å¬çš„åŠŸèƒ½</p><p>4ï¼‰computed å¯ä»¥ç›‘å¬å¤šä¸ªå€¼çš„å˜åŒ–</p><p><strong>computed åŸç†</strong></p><p>1ï¼‰åˆå§‹åŒ–è®¡ç®—å±æ€§æ—¶ï¼Œéå† computed å¯¹è±¡ï¼Œç»™å…¶ä¸­æ¯ä¸€ä¸ªè®¡ç®—å±æ€§åˆ†åˆ«ç”Ÿæˆå”¯ä¸€<code>computed watcher</code>ï¼Œå¹¶å°†è¯¥ watcher ä¸­çš„<code>dirty</code>è®¾ç½®ä¸º true</p><p>åˆå§‹åŒ–æ—¶ï¼Œè®¡ç®—å±æ€§å¹¶ä¸ä¼šç«‹å³è®¡ç®—ï¼ˆvue åšçš„ä¼˜åŒ–ä¹‹ä¸€ï¼‰ï¼Œåªæœ‰å½“è·å–çš„è®¡ç®—å±æ€§å€¼æ‰ä¼šè¿›è¡Œå¯¹åº”è®¡ç®—</p><p>2ï¼‰åˆå§‹åŒ–è®¡ç®—å±æ€§æ—¶ï¼Œå°†<code>Dep.target</code>è®¾ç½®æˆå½“å‰çš„ computed watcherï¼Œå°† computed watcher æ·»åŠ åˆ°æ‰€ä¾èµ– data å€¼å¯¹åº”çš„<code>dep</code>ä¸­ï¼ˆ<code>ä¾èµ–æ”¶é›†çš„è¿‡ç¨‹</code>ï¼‰ï¼Œç„¶åè®¡ç®— computed å¯¹åº”çš„å€¼ï¼Œåå°† dirty æ”¹æˆ false</p><p>3ï¼‰å½“æ‰€ä¾èµ– data ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨ set æ–¹æ³•è§¦å‘ dep çš„ notify æ–¹æ³•ï¼Œå°† computed watcher ä¸­çš„ dirty è®¾ç½®ä¸º true</p><p>4ï¼‰ä¸‹æ¬¡è·å–è®¡ç®—å±æ€§å€¼æ—¶ï¼Œè‹¥ dirty ä¸º true, é‡æ–°è®¡ç®—å±æ€§çš„å€¼</p><p>5ï¼‰dirty æ˜¯æ§åˆ¶ç¼“å­˜çš„å…³é”®ï¼Œå½“æ‰€ä¾èµ–çš„ data å‘ç”Ÿå˜åŒ–ï¼Œdirty è®¾ç½®ä¸º trueï¼Œå†æ¬¡è¢«è·å–æ—¶ï¼Œå°±ä¼šé‡æ–°è®¡ç®—</p><p><strong>computed æºç å®ç°</strong></p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// ç©ºå‡½æ•°</span>
<span class="token keyword">const</span> noop <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// computedåˆå§‹åŒ–çš„Watcherä¼ å…¥lazy: trueï¼Œå°±ä¼šè§¦å‘Watcherä¸­çš„dirtyå€¼ä¸ºtrue</span>
<span class="token keyword">const</span> computedWatcherOptions <span class="token operator">=</span> <span class="token punctuation">{</span> lazy<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//Object.defineProperty é»˜è®¤valueå‚æ•°</span>
<span class="token keyword">const</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token operator">:</span> noop<span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token operator">:</span> noop
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// åˆå§‹åŒ–computed</span>
<span class="token keyword">class</span> initComputed <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ–°å»ºå­˜å‚¨watcherå¯¹è±¡ï¼ŒæŒ‚è½½åœ¨vmå¯¹è±¡æ‰§è¡Œ</span>
    <span class="token keyword">const</span> watchers <span class="token operator">=</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_computedWatchers <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// éå†computed</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> userDef <span class="token operator">=</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">//getterå€¼ä¸ºcomputedä¸­keyçš„ç›‘å¬å‡½æ•°æˆ–å¯¹è±¡çš„getå€¼</span>
      let getter <span class="token operator">=</span> typeof userDef <span class="token operator">===</span> <span class="token string-literal singleline"><span class="token string">&quot;function&quot;</span></span> <span class="token operator">?</span> userDef <span class="token operator">:</span> userDef<span class="token punctuation">.</span>get<span class="token punctuation">;</span>
      <span class="token comment">// æ–°å»ºcomputed watcher</span>
      watchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> new <span class="token function">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> getter<span class="token punctuation">,</span> noop<span class="token punctuation">,</span> computedWatcherOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å®šä¹‰è®¡ç®—å±æ€§</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// é‡æ–°å®šä¹‰è®¡ç®—å±æ€§  å¯¹getå’ŒsetåŠ«æŒ</span>
  <span class="token comment">// åˆ©ç”¨Object.definePropertyæ¥å¯¹è®¡ç®—å±æ€§çš„getå’Œsetè¿›è¡ŒåŠ«æŒ</span>
  <span class="token function">defineComputed</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨èµ‹å€¼åˆ°getä¸Š</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>typeof userDef <span class="token operator">===</span> <span class="token string-literal singleline"><span class="token string">&quot;function&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sharedPropertyDefinition<span class="token punctuation">.</span>get <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      sharedPropertyDefinition<span class="token punctuation">.</span>set <span class="token operator">=</span> noop<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      sharedPropertyDefinition<span class="token punctuation">.</span>get <span class="token operator">=</span> userDef<span class="token punctuation">.</span>get
        <span class="token operator">?</span> userDef<span class="token punctuation">.</span>cache <span class="token operator">!==</span> <span class="token boolean">false</span>
          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
          <span class="token operator">:</span> userDef<span class="token punctuation">.</span>get
        <span class="token operator">:</span> noop<span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœæœ‰è®¾ç½®setæ–¹æ³•åˆ™ç›´æ¥ä½¿ç”¨ï¼Œå¦åˆ™èµ‹å€¼ç©ºå‡½æ•°</span>
      sharedPropertyDefinition<span class="token punctuation">.</span>set <span class="token operator">=</span> userDef<span class="token punctuation">.</span>set <span class="token operator">?</span> userDef<span class="token punctuation">.</span>set <span class="token operator">:</span> noop<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è®¡ç®—å±æ€§çš„getter è·å–è®¡ç®—å±æ€§çš„å€¼æ—¶ä¼šè°ƒç”¨</span>
  <span class="token function">createComputedGetter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> function <span class="token function">computedGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è·å–å¯¹åº”çš„è®¡ç®—å±æ€§watcher</span>
      <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// dirtyä¸ºtrue,è®¡ç®—å±æ€§éœ€è¦é‡æ–°è®¡ç®—</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// è·å–ä¾èµ–</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//è¿”å›è®¡ç®—å±æ€§çš„å€¼</span>
        <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>watch åŸç†</strong></p><p>1ï¼‰éå†<code>watch</code>å¯¹è±¡ï¼Œ ç»™å…¶ä¸­æ¯ä¸€ä¸ª watch å±æ€§ï¼Œç”Ÿæˆå¯¹åº”çš„<code>user watcher</code></p><p>2ï¼‰è°ƒç”¨ watcher ä¸­çš„ get æ–¹æ³•ï¼Œå°†<code>Dep.target</code>è®¾ç½®æˆå½“å‰çš„ user watcherï¼Œå¹¶å°† user watcher æ·»åŠ åˆ°ç›‘å¬ data å€¼å¯¹åº”çš„ dep ä¸­ï¼ˆä¾èµ–æ”¶é›†çš„è¿‡ç¨‹ï¼‰</p><p>3ï¼‰å½“æ‰€ç›‘å¬ data ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨ set æ–¹æ³•è§¦å‘ dep çš„ notify æ–¹æ³•ï¼Œæ‰§è¡Œ watcher ä¸­å®šä¹‰çš„æ–¹æ³•</p><p>4ï¼‰è®¾ç½®æˆ<code>deepï¼štrue</code>çš„æƒ…å†µï¼Œé€’å½’éå†æ‰€ç›‘å¬çš„å¯¹è±¡ï¼Œå°†<code>user watcher</code>æ·»åŠ åˆ°å¯¹è±¡ä¸­æ¯ä¸€å±‚ key å€¼çš„ dep å¯¹è±¡ä¸­ï¼Œè¿™æ ·æ— è®ºå½“å¯¹è±¡çš„ä¸­å“ªä¸€å±‚å‘ç”Ÿå˜åŒ–ï¼Œwacher éƒ½èƒ½ç›‘å¬åˆ°ã€‚é€šè¿‡å¯¹è±¡çš„é€’å½’éå†ï¼Œå®ç°äº†æ·±åº¦ç›‘å¬åŠŸèƒ½</p><p><a href="https://juejin.cn/post/6844903667884097543" target="_blank" rel="noopener noreferrer">Vue.js çš„ computed å’Œ watch æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6956407362085191717" target="_blank" rel="noopener noreferrer">æ‰‹å†™ Vue2.0 æºç ï¼ˆåï¼‰-è®¡ç®—å±æ€§åŸç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1YE411u7m4%3Ffrom%3Dsearch%26seid%3D14891340203736945411" target="_blank" rel="noopener noreferrer">ç å³°ï¼šå²ä¸Šæœ€å…¨æœ€ä¸“ä¸šçš„ Vue.js é¢è¯•é¢˜è®­ç»ƒè¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="vue-css-scoped" tabindex="-1"><a class="header-anchor" href="#vue-css-scoped" aria-hidden="true">#</a> vue css scoped</h4><p><strong>css å±æ€§é€‰æ‹©å™¨ç¤ºä¾‹</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// é¡µé¢ä¸Š â€œå±æ€§é€‰æ‹©å™¨â€è¿™å‡ ä¸ªå­—æ˜¾ç¤ºçº¢è‰²</span>
 <span class="token operator">&lt;</span>div data<span class="token operator">-</span>v<span class="token operator">-</span>hash <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;test-attr&quot;</span><span class="token operator">&gt;</span>å±æ€§é€‰æ‹©å™¨<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    <span class="token comment">/* è¯¥æ ‡ç­¾æœ‰ä¸ªdata-v-hashçš„å±æ€§ï¼Œåªä¸è¿‡è¯¥å±æ€§ä¸ºç©ºï¼Œä¾ç„¶å¯ä»¥ä½¿ç”¨å±æ€§é€‰æ‹©å™¨ */</span>
   <span class="token punctuation">.</span>test<span class="token operator">-</span>attr<span class="token punctuation">[</span>data<span class="token operator">-</span>v<span class="token operator">-</span>hash<span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
     <span class="token comment">// é€šè¿‡jsåˆ¤æ–­æ˜¯å¦å­˜åœ¨ data-v-hash å±æ€§</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.test-attr&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-v-hash&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>vue css scoped åŸç†</strong></p><p>1ï¼‰ç¼–è¯‘æ—¶ï¼Œä¼šç»™æ¯ä¸ª vue æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ idï¼Œä¼šå°†æ­¤ id æ·»åŠ åˆ°å½“å‰æ–‡ä»¶ä¸­æ‰€æœ‰ html çš„æ ‡ç­¾ä¸Š</p><p>å¦‚<code>&lt;div class=&quot;demo&quot;&gt;&lt;/div&gt;</code>ä¼šè¢«ç¼–è¯‘æˆ<code>&lt;div class=&quot;demo&quot; data-v-27e4e96e&gt;&lt;/div&gt;</code></p><p>2ï¼‰ç¼–è¯‘ style æ ‡ç­¾æ—¶ï¼Œä¼šå°† css é€‰æ‹©å™¨æ”¹é€ æˆå±æ€§é€‰æ‹©å™¨ï¼Œå¦‚<code>.demo{color: red;}</code>ä¼šè¢«ç¼–è¯‘æˆ<code>.demo[data-v-27e4e96e]{color: red;}</code></p><h4 id="è™šæ‹Ÿ-dom" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿ-dom" aria-hidden="true">#</a> è™šæ‹Ÿ dom</h4><p><strong>ä»€ä¹ˆæ˜¯è™šæ‹Ÿ domï¼Ÿ</strong></p><p><code>Virtual DOM</code>æ˜¯ JS æ¨¡æ‹ŸçœŸå® DOM èŠ‚ç‚¹ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æ›´åŠ è½»é‡çº§çš„å¯¹ DOM çš„æè¿°</p><h5 id="ä¸ºä»€ä¹ˆç°åœ¨ä¸»æµçš„æ¡†æ¶éƒ½ä½¿ç”¨è™šæ‹Ÿ-dom" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆç°åœ¨ä¸»æµçš„æ¡†æ¶éƒ½ä½¿ç”¨è™šæ‹Ÿ-dom" aria-hidden="true">#</a> <strong>ä¸ºä»€ä¹ˆç°åœ¨ä¸»æµçš„æ¡†æ¶éƒ½ä½¿ç”¨è™šæ‹Ÿ dom?</strong></h5><p>1ï¼‰å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªç§˜è¯€å°±æ˜¯å°½å¯èƒ½å°‘åœ°æ“ä½œ DOMï¼Œé¢‘ç¹å˜åŠ¨ DOM ä¼šé€ æˆæµè§ˆå™¨çš„å›æµæˆ–è€…é‡ç»˜</p><p>2ï¼‰ä½¿ç”¨è™šæ‹Ÿ domï¼Œå½“æ•°æ®å˜åŒ–ï¼Œé¡µé¢éœ€è¦æ›´æ–°æ—¶ï¼Œé€šè¿‡ diff ç®—æ³•ï¼Œå¯¹æ–°æ—§è™šæ‹Ÿ dom èŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”ï¼Œæ¯”è¾ƒä¸¤æ£µæ ‘çš„å·®å¼‚ï¼Œç”Ÿæˆå·®å¼‚å¯¹è±¡ï¼Œä¸€æ¬¡æ€§å¯¹ DOM è¿›è¡Œæ‰¹é‡æ›´æ–°æ“ä½œï¼Œè¿›è€Œæœ‰æ•ˆæé«˜äº†æ€§èƒ½</p><p>3ï¼‰è™šæ‹Ÿ DOM æœ¬è´¨ä¸Šæ˜¯ js å¯¹è±¡ï¼Œè€Œ DOM ä¸å¹³å°å¼ºç›¸å…³ï¼Œç›¸æ¯”ä¹‹ä¸‹è™šæ‹Ÿ DOM å¯ä»¥è¿›è¡Œæ›´æ–¹ä¾¿çš„è·¨å¹³å°æ“ä½œï¼Œä¾‹å¦‚æœåŠ¡å™¨æ¸²æŸ“ã€weex å¼€å‘ç­‰ç­‰</p><h5 id="è™šæ‹Ÿ-dom-ä¸çœŸå®-dom-çš„ç›¸äº’è½¬åŒ–" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿ-dom-ä¸çœŸå®-dom-çš„ç›¸äº’è½¬åŒ–" aria-hidden="true">#</a> <strong>è™šæ‹Ÿ dom ä¸çœŸå® dom çš„ç›¸äº’è½¬åŒ–</strong></h5><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code>// å°†çœŸå®domè½¬åŒ–ä¸ºè™šæ‹Ÿdom
function dom2Json(dom) {
  if (!dom.tagName) return;
  <span class="token key attr-name">let obj</span> <span class="token punctuation">=</span> <span class="token value attr-value">{};</span>
  <span class="token key attr-name">obj.tag</span> <span class="token punctuation">=</span> <span class="token value attr-value">dom.tagName;</span>
  <span class="token key attr-name">obj.children</span> <span class="token punctuation">=</span> <span class="token value attr-value">[];</span>
  <span class="token key attr-name">dom.childNodes.forEach(item</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; {</span>
    // å»æ‰ç©ºçš„èŠ‚ç‚¹
    dom2Json(item) &amp;&amp; obj.children.push(dom2Json(item));
  });
  return obj;
}


  // è™šæ‹ŸdomåŒ…å«ä¸‰ä¸ªå‚æ•°  type, props, children
  class Element {
    constructor(type, props, children) {
      <span class="token key attr-name">this.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">type</span>
      <span class="token key attr-name">this.props</span> <span class="token punctuation">=</span> <span class="token value attr-value">props</span>
      <span class="token key attr-name">this.children</span> <span class="token punctuation">=</span> <span class="token value attr-value">children</span>
    }
  }

 // å°†è™šæ‹Ÿdomæ¸²æŸ“æˆçœŸå®çš„dom
  function render(domObj) {
    <span class="token key attr-name">let el</span> <span class="token punctuation">=</span> <span class="token value attr-value">document.createElement(domObj.type)</span>
    <span class="token key attr-name">Object.keys(domObj.props).forEach(key</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; { // è®¾ç½®å±æ€§</span>
      <span class="token key attr-name">let value</span> <span class="token punctuation">=</span> <span class="token value attr-value">domObj.props[key]</span>
      switch (key) {
        case(&#39;value&#39;):
          <span class="token key attr-name">if (el.tagName</span> <span class="token punctuation">=</span><span class="token value attr-value">= &#39;INPUT&#39; || el.tagName == &#39;TEXTAREA&#39;) {</span>
            <span class="token key attr-name">el.value</span> <span class="token punctuation">=</span> <span class="token value attr-value">value</span>
          } else {
            el.setAttribute(key, value)
          }
          break;
        case(&#39;style&#39;):
          <span class="token key attr-name">el.style.cssText</span> <span class="token punctuation">=</span> <span class="token value attr-value">value</span>
          break;
        default:
          el.setAttribute(key, value)
      }
    })
    <span class="token key attr-name">domObj.children.forEach(child</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; {</span>
      <span class="token key attr-name">child</span> <span class="token punctuation">=</span> <span class="token value attr-value">child instanceof Element ? render(child) : document.createTextNode(child)</span>
    })
    return el
  }

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://juejin.cn/post/6844903806132568072" target="_blank" rel="noopener noreferrer">è®©è™šæ‹Ÿ DOM å’Œ DOM-diff ä¸å†æˆä¸ºä½ çš„ç»Šè„šçŸ³<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FoAlVmZ4Hbt2VhOwFEkNEhw" target="_blank" rel="noopener noreferrer">è™šæ‹Ÿ DOM åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6844903607913938951" target="_blank" rel="noopener noreferrer">è¯¦è§£ vue çš„ diff ç®—æ³•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="vuex-åŸç†" tabindex="-1"><a class="header-anchor" href="#vuex-åŸç†" aria-hidden="true">#</a> vuex åŸç†</h4><p>1ï¼‰vuex ä¸­çš„ store æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰<code>templateæ¨¡æ¿</code>çš„éšè—å¼çš„ vue ç»„ä»¶</p><p>2ï¼‰vuex æ˜¯åˆ©ç”¨ vue çš„<code>mixinæ··å…¥æœºåˆ¶</code>ï¼Œåœ¨<code>beforeCreate</code>é’©å­å‰æ··å…¥ vuexInit æ–¹æ³•</p><p>3ï¼‰vuexInit æ–¹æ³•å®ç°å°† vuex store æ³¨å†Œåˆ°å½“å‰ç»„ä»¶çš„$store å±æ€§ä¸Š</p><p>4ï¼‰vuex çš„ state ä½œä¸ºä¸€ä¸ªéšè—çš„ vue ç»„ä»¶çš„ dataï¼Œå®šä¹‰åœ¨ state ä¸Šé¢çš„å˜é‡ï¼Œç›¸å½“äºè¿™ä¸ª vue å®ä¾‹çš„ data å±æ€§ï¼Œå‡¡æ˜¯å®šä¹‰åœ¨ data ä¸Šçš„æ•°æ®éƒ½æ˜¯å“åº”å¼çš„</p><p>5ï¼‰å½“é¡µé¢ä¸­ä½¿ç”¨äº† vuex state ä¸­çš„æ•°æ®ï¼Œå°±æ˜¯ä¾èµ–æ”¶é›†çš„è¿‡ç¨‹ï¼Œå½“ vuex ä¸­ state ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œå°±é€šè¿‡è°ƒç”¨å¯¹åº”å±æ€§çš„ dep å¯¹è±¡çš„ notify æ–¹æ³•ï¼Œå»ä¿®æ”¹è§†å›¾å˜åŒ–</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fd95a7b8afa06" target="_blank" rel="noopener noreferrer">vuex å·¥ä½œåŸç†è¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_34285318%2Farticle%2Fdetails%2F90182481" target="_blank" rel="noopener noreferrer">Vuex æ•°æ®æµåŠ¨è¿‡ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="vue-router-åŸç†" tabindex="-1"><a class="header-anchor" href="#vue-router-åŸç†" aria-hidden="true">#</a> vue-router åŸç†</h4><p>1ï¼‰åˆ›å»ºçš„é¡µé¢è·¯ç”±ä¼šä¸è¯¥é¡µé¢å½¢æˆä¸€ä¸ªè·¯ç”±è¡¨ï¼ˆkey value å½¢å¼ï¼Œkey ä¸ºè¯¥è·¯ç”±ï¼Œvalue ä¸ºå¯¹åº”çš„é¡µé¢ï¼‰</p><p>2ï¼‰vue-router åŸç†æ˜¯ç›‘å¬ URL çš„å˜åŒ–ï¼Œç„¶ååŒ¹é…è·¯ç”±è§„åˆ™ï¼Œä¼šç”¨æ–°è·¯ç”±çš„é¡µé¢æ›¿æ¢åˆ°è€çš„é¡µé¢ ï¼Œæ— éœ€åˆ·æ–°</p><p>3ï¼‰ç›®å‰å•é¡µé¢ä½¿ç”¨çš„è·¯ç”±æœ‰ä¸¤ç§å®ç°æ–¹å¼: <code>hash æ¨¡å¼</code>ã€<code>history æ¨¡å¼</code></p><p>5ï¼‰hash æ¨¡å¼ï¼ˆè·¯ç”±ä¸­å¸¦#å·ï¼‰ï¼Œé€šè¿‡<code>hashchange</code>äº‹ä»¶æ¥ç›‘å¬è·¯ç”±çš„å˜åŒ– <code>window.addEventListener(&#39;hashchange&#39;, ï¼ˆ)=&gt;{})</code></p><p>6ï¼‰history æ¨¡å¼ï¼Œåˆ©ç”¨äº†<code>pushState()</code> å’Œ<code>replaceState()</code> æ–¹æ³•ï¼Œå®ç°å¾€ history ä¸­æ·»åŠ æ–°çš„æµè§ˆè®°å½•ã€æˆ–æ›¿æ¢å¯¹åº”çš„æµè§ˆè®°å½•</p><p>é€šè¿‡<code>popstate</code>äº‹ä»¶æ¥ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œ<code>window.addEventListener(&#39;popstate&#39;, ï¼ˆ)=&gt;{})</code></p><p><a href="https://juejin.cn/post/6844903615283363848" target="_blank" rel="noopener noreferrer">å‰ç«¯è·¯ç”±ç®€ä»‹ä»¥åŠ vue-router å®ç°åŸç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6844904099050160141" target="_blank" rel="noopener noreferrer">Vue Router åŸç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="vue3-ä¸-vue2-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#vue3-ä¸-vue2-çš„åŒºåˆ«" aria-hidden="true">#</a> vue3 ä¸ vue2 çš„åŒºåˆ«</h4><p>1ï¼‰vue3 æ€§èƒ½æ¯” Vue2.x å¿« 1.2~2 å€</p><p>2ï¼‰ä½¿ç”¨ proxy å–ä»£ Object.definepropertyï¼Œè§£å†³äº† vue2 ä¸­æ–°å¢å±æ€§ç›‘å¬ä¸åˆ°çš„é—®é¢˜ï¼ŒåŒæ—¶ proxy ä¹Ÿæ”¯æŒæ•°ç»„ï¼Œä¸éœ€è¦åƒ vue2 é‚£æ ·å¯¹æ•°ç»„çš„æ–¹æ³•åšæ‹¦æˆªå¤„ç†</p><p>3ï¼‰diff æ–¹æ³•ä¼˜åŒ– vue3 æ–°å¢äº†é™æ€æ ‡è®°ï¼ˆpatchflagï¼‰ï¼Œè™šæ‹ŸèŠ‚ç‚¹å¯¹æ¯”æ—¶ï¼Œå°±åªä¼šå¯¹æ¯”è¿™äº›å¸¦æœ‰é™æ€æ ‡è®°çš„èŠ‚ç‚¹</p><p>4ï¼‰é™æ€æå‡ vue3 å¯¹äºä¸å‚ä¸æ›´æ–°çš„å…ƒç´ ï¼Œä¼šåšé™æ€æå‡ï¼Œåªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œåœ¨æ¸²æŸ“æ—¶ç›´æ¥å¤ç”¨å³å¯ã€‚vue2 æ— è®ºå…ƒç´ æ˜¯å¦å‚ä¸æ›´æ–°ï¼Œæ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ›å»ºç„¶åå†æ¸²æŸ“</p><p>5ï¼‰äº‹ä»¶ä¾¦å¬å™¨ç¼“å­˜ é»˜è®¤æƒ…å†µä¸‹ onClick ä¼šè¢«è§†ä¸ºåŠ¨æ€ç»‘å®šï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šè¿½è¸ªå®ƒçš„å˜åŒ–ï¼Œä½†æ˜¯å› ä¸ºæ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸ç”¨è¿½è¸ªå˜åŒ–ï¼Œç›´æ¥ç¼“å­˜èµ·æ¥å¤ç”¨å³å¯</p><p>6ï¼‰æŒ‰éœ€å¼•å…¥ï¼Œé€šè¿‡ treeSharking ä½“ç§¯æ¯” vue2.x æ›´å°</p><p>7ï¼‰ç»„åˆ APIï¼ˆç±»ä¼¼ react hooksï¼‰ï¼Œå¯ä»¥å°† data ä¸å¯¹åº”çš„é€»è¾‘å†™åˆ°ä¸€èµ·ï¼Œæ›´å®¹æ˜“ç†è§£</p><p>8ï¼‰æä¾›äº†å¾ˆçµæ´»çš„ api æ¯”å¦‚ toRefã€shallowRef ç­‰ç­‰ï¼Œå¯ä»¥çµæ´»æ§åˆ¶æ•°æ®å˜åŒ–æ˜¯å¦éœ€è¦æ›´æ–° ui æ¸²æŸ“</p><p>9ï¼‰æ›´å¥½çš„ Ts æ”¯æŒ</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fzxo_apple%2Farticle%2Fdetails%2F109244117" target="_blank" rel="noopener noreferrer">VUE3 å¯¹æ¯” VUE2 çš„ä¼˜åŠ¿åŠæ–°ç‰¹æ€§åŸç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="react" tabindex="-1"><a class="header-anchor" href="#react" aria-hidden="true">#</a> React</h3><h4 id="vue-å’Œ-react-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#vue-å’Œ-react-çš„åŒºåˆ«" aria-hidden="true">#</a> vue å’Œ react çš„åŒºåˆ«</h4><p>1ï¼‰è®¾è®¡ç†å¿µä¸åŒ</p><p>react æ•´ä½“ä¸Šæ˜¯<code>å‡½æ•°å¼ç¼–ç¨‹</code>æ€æƒ³ï¼Œç»„ä»¶ä½¿ç”¨<code>jsx</code>è¯­æ³•ï¼Œall in jsï¼Œå°† html ä¸ css å…¨éƒ½èå…¥ javaScript ä¸­ï¼Œjsx è¯­æ³•ç›¸å¯¹æ¥è¯´æ›´åŠ çµæ´»</p><p>vue çš„æ•´ä½“æ€æƒ³ï¼Œæ˜¯æ‹¥æŠ±ç»å…¸çš„<code>html(ç»“æ„)+css(è¡¨ç°)+js(è¡Œä¸º)</code>çš„å½¢å¼ï¼Œä½¿ç”¨ template æ¨¡æ¿ï¼Œå¹¶æä¾›æŒ‡ä»¤ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œå¦‚ v-ifã€v-showã€v-for ç­‰ï¼Œå¼€å‘æ—¶æœ‰ç»“æ„ã€è¡¨ç°ã€è¡Œä¸ºåˆ†ç¦»çš„æ„Ÿè§‰</p><p>2ï¼‰æ•°æ®æ˜¯å¦å¯å˜</p><p>vue çš„æ€æƒ³æ˜¯å“åº”å¼çš„ï¼Œé€šè¿‡ Object.defineproperty æˆ– proxy ä»£ç†å®ç°æ•°æ®ç›‘å¬ï¼Œæ¯ä¸€ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ª dep å¯¹è±¡ï¼ˆç”¨æ¥å­˜å‚¨å¯¹åº”çš„ watcherï¼‰ï¼Œå½“å±æ€§å˜åŒ–çš„æ—¶å€™ï¼Œé€šçŸ¥å¯¹åº”çš„ watcher å‘ç”Ÿæ”¹å˜</p><p>react æ¨å´‡çš„æ˜¯æ•°æ®ä¸å¯å˜ï¼Œreact ä½¿ç”¨çš„æ˜¯æµ…æ¯”è¾ƒï¼Œå¦‚æœå¯¹è±¡å’Œæ•°æ®çš„å¼•ç”¨åœ°å€æ²¡æœ‰å˜ï¼Œreact è®¤ä¸ºè¯¥å¯¹è±¡æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ react å˜åŒ–æ—¶ä¸€èˆ¬éƒ½æ˜¯æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡</p><p>3ï¼‰æ›´æ–°æ¸²æŸ“æ–¹å¼ä¸åŒ</p><p>å½“ç»„ä»¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œvue æ˜¯å“åº”å¼ï¼Œé€šè¿‡å¯¹åº”çš„ watcher è‡ªåŠ¨æ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶é‡æ–°æ¸²æŸ“</p><p>react éœ€è¦æ›´æ–°ç»„ä»¶æ—¶ï¼Œä¼šé‡æ–°èµ°æ¸²æŸ“çš„æµç¨‹ï¼Œé€šè¿‡ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œdom diff æ‰¾åˆ°éœ€è¦å˜æ›´çš„èŠ‚ç‚¹ï¼Œæ›´æ–°ä»»åŠ¡è¿˜æ˜¯å¾ˆå¤§ï¼Œéœ€è¦ä½¿ç”¨åˆ° Fiberï¼Œå°†å¤§ä»»åŠ¡åˆ†å‰²ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼Œå¯ä»¥ä¸­æ–­å’Œæ¢å¤ï¼Œä¸é˜»å¡ä¸»è¿›ç¨‹æ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡</p><p>4ï¼‰å„è‡ªçš„ä¼˜åŠ¿ä¸åŒ</p><p>vue çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼šæ¡†æ¶å†…éƒ¨å°è£…çš„å¤šï¼Œæ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œç®€å•çš„è¯­æ³•åŠé¡¹ç›®åˆ›å»ºï¼Œ æ›´å¿«çš„æ¸²æŸ“é€Ÿåº¦å’Œæ›´å°çš„ä½“ç§¯</p><p>react çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š react æ›´çµæ´»ï¼Œæ›´æ¥è¿‘åŸç”Ÿçš„ jsã€å¯æ“æ§æ€§å¼ºï¼Œå¯¹äºèƒ½åŠ›å¼ºçš„äººï¼Œæ›´å®¹æ˜“é€ å‡ºæ›´ä¸ªæ€§åŒ–çš„é¡¹ç›®</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fyubin-%2Fp%2F11537122.html" target="_blank" rel="noopener noreferrer">React ä¸ Vue çš„å¯¹æ¯”<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flihongxun945%2Fmyblog%2Fissues%2F21" target="_blank" rel="noopener noreferrer">å…³äº Vue å’Œ React åŒºåˆ«çš„ä¸€äº›ç¬”è®°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="react-hooks" tabindex="-1"><a class="header-anchor" href="#react-hooks" aria-hidden="true">#</a> react Hooks</h4><p>å¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œè·å– stateã€refsã€ç”Ÿå‘½å‘¨æœŸé’©å­ç­‰å…¶ä»–ç‰¹æ€§</p><p><strong>Hook ä½¿ç”¨è§„åˆ™</strong></p><p>1ï¼‰åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hookï¼ŒHooks åº•å±‚ä½¿ç”¨é“¾è¡¨å­˜å‚¨æ•°æ®ï¼ŒæŒ‰ç…§å®šä¹‰çš„ useState é¡ºåºå­˜å‚¨å¯¹åº”çš„æ•°æ®ï¼Œä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookï¼Œå¦åˆ™ Hooks çš„é¡ºåºä¼šé”™ä¹±</p><p>2ï¼‰è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ â€œuseâ€ å¼€å¤´ï¼Œå¦‚ useFriendStatus</p><p>3ï¼‰åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¸ä¼šå…±äº« stateï¼Œæ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fbrickspert%2Fblog%2Fissues%2F26" target="_blank" rel="noopener noreferrer">React Hooks åŸç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="ä¸ºä»€ä¹ˆ-vue-å’Œ-react-éƒ½é€‰æ‹©äº†-hooks" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-vue-å’Œ-react-éƒ½é€‰æ‹©äº†-hooks" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆ vue å’Œ react éƒ½é€‰æ‹©äº† Hooks</h4><p>1ï¼‰æ›´å¥½çš„çŠ¶æ€å¤ç”¨</p><p>å¯¹äº vue2 æ¥è¯´ï¼Œä½¿ç”¨çš„æ˜¯ mixin è¿›è¡Œæ··å…¥ï¼Œä¼šé€ æˆæ–¹æ³•ä¸å±æ€§çš„éš¾ä»¥è¿½æº¯ã€‚ éšç€é¡¹ç›®çš„å¤æ‚ï¼Œæ–‡ä»¶çš„å¢å¤šï¼Œç»å¸¸ä¼šå‡ºç°ä¸çŸ¥é“æŸä¸ªå˜é‡åœ¨å“ªé‡Œå¼•å…¥çš„ï¼Œå‡ ä¸ªæ–‡ä»¶é—´æ¥å›ç¿»æ‰¾ï¼Œ åŒæ—¶è¿˜ä¼šå‡ºç°åŒåå˜é‡ï¼Œç›¸äº’è¦†ç›–çš„æƒ…å†µâ€¦â€¦ğŸ˜¥</p><p>2ï¼‰æ›´å¥½çš„ä»£ç ç»„ç»‡</p><p>vue2 çš„å±æ€§æ˜¯æ”¾åˆ° data ä¸­ï¼Œæ–¹æ³•å®šä¹‰åœ¨ methods ä¸­ï¼Œä¿®æ”¹æŸä¸€å—çš„ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œ ç»å¸¸ä¼šå‡ºç°ä»£ç é—´æ¥å›è·³è½¬çš„æƒ…å†µï¼Œå¢åŠ å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…</p><p>ä½¿ç”¨<code>Hooks</code>åï¼Œå¯ä»¥å°†ç›¸åŒçš„ä¸šåŠ¡é€»è¾‘æ”¾åˆ°ä¸€èµ·ï¼Œé«˜æ•ˆè€Œæ¸…æ™°åœ°ç»„ç»‡ä»£ç </p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5824a603651b4bf9bf8689436e29f2b7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="componentApi.jpg"></p><p>3ï¼‰å‘Šåˆ« this</p><p>this æœ‰å¤šç§ç»‘å®šæ–¹å¼ï¼Œå­˜åœ¨æ˜¾ç¤ºç»‘å®šã€éšå¼ç»‘å®šã€é»˜è®¤ç»‘å®šç­‰å¤šç§ç©æ³•ï¼Œé‡Œè¾¹çš„å‘ä¸æ˜¯ä¸€èˆ¬çš„å¤š</p><p>vue3 çš„ setup å‡½æ•°ä¸­ä¸èƒ½ä½¿ç”¨ thisï¼Œä¸èƒ½ç”¨æŒºå¥½ï¼Œç›´æ¥é¿å…ä½¿ç”¨ this å¯èƒ½ä¼šé€ æˆé”™è¯¯çš„</p><p><a href="https://juejin.cn/post/7066951709678895141" target="_blank" rel="noopener noreferrer">æµ…è°ˆï¼šä¸ºå•¥ vue å’Œ react éƒ½é€‰æ‹©äº† HooksğŸ‚ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="react-fiber" tabindex="-1"><a class="header-anchor" href="#react-fiber" aria-hidden="true">#</a> react Fiber</h4><p>è§£å†³ react æ—§ç‰ˆæœ¬ï¼Œæ›´æ–°é¡µé¢æ—¶ä¼šå‡ºç°ä¸¢å¸§å¡é¡¿çš„é—®é¢˜</p><p><strong>React æ—§ç‰ˆæœ¬é—®é¢˜</strong></p><p>å½“æˆ‘ä»¬è°ƒç”¨ setState æ›´æ–°é¡µé¢çš„æ—¶å€™ï¼ŒReact ä¼šéå†åº”ç”¨çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè®¡ç®—å‡ºå·®å¼‚ï¼Œç„¶åå†æ›´æ–° UI</p><p>æ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸€æ°”å‘µæˆï¼Œä¸èƒ½è¢«æ‰“æ–­çš„ã€‚å¦‚æœé¡µé¢å…ƒç´ å¾ˆå¤šï¼Œæ•´ä¸ªè¿‡ç¨‹æ‰§è¡Œçš„æ—¶é—´å¯èƒ½è¶…è¿‡ 50 æ¯«ç§’ï¼Œå°±å®¹æ˜“å‡ºç°æ‰å¸§çš„ç°è±¡</p><p><strong>æ–°ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆ</strong></p><p>React Fiber æ˜¯æŠŠä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºäº†å¾ˆå¤šä¸ªå°å—ä»»åŠ¡ï¼Œä¸€ä¸ªå°å—ä»»åŠ¡çš„æ‰§è¡Œå¿…é¡»æ˜¯ä¸€æ¬¡å®Œæˆçš„ï¼Œä¸èƒ½å‡ºç°æš‚åœï¼Œä½†æ˜¯ä¸€ä¸ªå°å—ä»»åŠ¡æ‰§è¡Œå®Œåå¯ä»¥ç§»äº¤æ§åˆ¶æƒç»™æµè§ˆå™¨å»å“åº”ç”¨æˆ·æ“ä½œ</p><p>æ ¸å¿ƒæ˜¯é€šè¿‡ <code>requestIdleCallback</code> ï¼Œä¼šåœ¨åˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´ä¼šæ‰¾å‡ºæ‰€æœ‰éœ€è¦å˜æ›´çš„èŠ‚ç‚¹</p><p>é˜¶æ®µä¸€ï¼Œç”Ÿæˆ Fiber æ ‘ï¼Œå¾—å‡ºéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿™ä¸€æ­¥æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ï¼Œå¯ä»¥è¢«æ‰“æ–­</p><p>é˜¶æ®µäºŒï¼Œå°†éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ä¸€æ¬¡æ€§æ‰¹é‡æ›´æ–°ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸èƒ½è¢«æ‰“æ–­</p><p><a href="https://juejin.cn/post/6943896410987659277" target="_blank" rel="noopener noreferrer">èµ°è¿› React Fiber çš„ä¸–ç•Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="react-ä¸­ä½¿ç”¨äº†-fiber-ä¸ºä»€ä¹ˆ-vue-æ²¡æœ‰ç”¨-fiber" tabindex="-1"><a class="header-anchor" href="#react-ä¸­ä½¿ç”¨äº†-fiber-ä¸ºä»€ä¹ˆ-vue-æ²¡æœ‰ç”¨-fiber" aria-hidden="true">#</a> react ä¸­ä½¿ç”¨äº† Fiberï¼Œä¸ºä»€ä¹ˆ vue æ²¡æœ‰ç”¨ Fiberï¼Ÿ</h4><p><strong>åŸå› æ˜¯äºŒè€…çš„æ›´æ–°æœºåˆ¶ä¸ä¸€æ ·</strong></p><p>Vue æ˜¯åŸºäº template å’Œ watcher çš„ç»„ä»¶çº§æ›´æ–°ï¼ŒæŠŠæ¯ä¸ªæ›´æ–°ä»»åŠ¡åˆ†å‰²å¾—è¶³å¤Ÿå°ï¼Œä¸éœ€è¦ä½¿ç”¨åˆ° Fiber æ¶æ„ï¼Œå°†ä»»åŠ¡è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ‹†åˆ†</p><p>React æ˜¯ä¸ç®¡åœ¨å“ªé‡Œè°ƒç”¨ setStateï¼Œéƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ›´æ–°çš„ï¼Œæ›´æ–°ä»»åŠ¡è¿˜æ˜¯å¾ˆå¤§ï¼Œéœ€è¦ä½¿ç”¨åˆ° Fiber å°†å¤§ä»»åŠ¡åˆ†å‰²ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼Œå¯ä»¥ä¸­æ–­å’Œæ¢å¤ï¼Œä¸é˜»å¡ä¸»è¿›ç¨‹æ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¦‚æœä¸ç”¨ Fiberï¼Œä¼šå‡ºç°è€ç‰ˆæœ¬å¡é¡¿çš„é—®é¢˜</p><p><a href="https://juejin.cn/post/6943896410987659277" target="_blank" rel="noopener noreferrer">èµ°è¿› React Fiber çš„ä¸–ç•Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="ä¸ºä»€ä¹ˆ-react-æ¨è¡Œå‡½æ•°å¼ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-react-æ¨è¡Œå‡½æ•°å¼ç»„ä»¶" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆ react æ¨è¡Œå‡½æ•°å¼ç»„ä»¶</h4><p>1ï¼‰å‡½æ•°ç»„ä»¶ä¸éœ€è¦å£°æ˜ç±»ï¼Œå¯ä»¥é¿å…å¤§é‡çš„è­¬å¦‚ extends æˆ–è€… constructor è¿™æ ·çš„ä»£ç </p><p>2ï¼‰å‡½æ•°ç»„ä»¶ä¸éœ€è¦å¤„ç† this æŒ‡å‘çš„é—®é¢˜</p><p>3ï¼‰å‡½æ•°ç»„ä»¶æ›´è´´è¿‘äºå‡½æ•°å¼ç¼–ç¨‹ï¼Œæ›´åŠ è´´è¿‘ react çš„åŸåˆ™ã€‚ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼Œçµæ´»åº¦æ›´é«˜ï¼Œæ›´å¥½çš„ä»£ç å¤ç”¨</p><p>4ï¼‰éšç€ Hooks åŠŸèƒ½çš„å¼ºå¤§ï¼Œæ›´æ¨åŠ¨äº†å‡½æ•°å¼ç»„ä»¶ + Hooks è¿™å¯¹ç»„åˆçš„å‘å±•</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F343314784" target="_blank" rel="noopener noreferrer">ä¸ºä»€ä¹ˆ React ç°åœ¨è¦æ¨è¡Œå‡½æ•°å¼ç»„ä»¶ï¼Œç”¨ class ä¸å¥½å—ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.cn/post/6844904100891459591" target="_blank" rel="noopener noreferrer">å‡½æ•°å¼ç»„ä»¶ &amp;&amp; React Hook<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="usememo-å’Œ-usecallback-çš„ä½œç”¨ä¸åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#usememo-å’Œ-usecallback-çš„ä½œç”¨ä¸åŒºåˆ«" aria-hidden="true">#</a> useMemo å’Œ useCallback çš„ä½œç”¨ä¸åŒºåˆ«</h4><p><strong>useCallback</strong></p><p>useCallback è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šæ›´æ–°ï¼ˆè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼‰ï¼Œå¤šç”¨äºç”Ÿæˆä¸€ä¸ªé˜²æŠ–å‡½æ•°</p><p>æ³¨æ„ï¼šç»„ä»¶æ¯æ¬¡æ›´æ–°æ—¶ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œè¿™æ ·ä¹‹å‰å†™çš„é˜²æŠ–å‡½æ•°å°±ä¼šå¤±æ•ˆï¼Œéœ€è¦ä½¿ç”¨ useCallback åŒ…è£¹</p><div class="language-scss ext-scss line-numbers-mode"><pre class="language-scss"><code>import <span class="token punctuation">{</span>debounce<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;debounce&#39;</span>
<span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦ç›‘å¬çš„å˜é‡ï¼Œå½“ä¸ºç©ºæ•°ç»„æ—¶[]ï¼Œsubmitåªä¼šè¢«åˆ›å»ºä¸€æ¬¡</span>
<span class="token comment">// å½“ç›‘å¬æœ‰å€¼æ—¶ï¼Œä¼šéšç€å€¼çš„å˜åŒ–é‡æ–°åˆ›å»ºç”Ÿæˆæ–°çš„submit</span>
const submit = <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token function">debounce</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> 2000<span class="token punctuation">)</span><span class="token punctuation">,</span> []<span class="token punctuation">)</span>
&lt;button onClick=<span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> =&gt; <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>&gt;æäº¤&lt;/button&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>useMemo</strong></p><p>useMemo åªæœ‰åœ¨ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°è°ƒç”¨æ­¤å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å€¼, ç±»ä¼¼äº vue ä¸­çš„ computed è®¡ç®—å±æ€§</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">const info</span> <span class="token punctuation">=</span> <span class="token value attr-value">useMemo(() =&gt; {</span>
  //  å®šä¹‰infoå˜é‡ï¼Œ è¯¥å˜é‡ä¼šéšç€ inputPerson, inputAgeçš„å˜åŒ–è€Œå˜åŒ–ï¼Œ infoå¯ä»¥åœ¨é¡µé¢ä¸­æ˜¾ç¤º
  return {
    name: inputPerson,
    age: inputAge
  };
}, [inputPerson, inputAge]);

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://juejin.cn/post/6844904101445124110" target="_blank" rel="noopener noreferrer">è¯¦è§£ React useCallback &amp; useMemo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="setstate-æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥" tabindex="-1"><a class="header-anchor" href="#setstate-æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥" aria-hidden="true">#</a> setState æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ</h4><p>é¦–å…ˆï¼ŒåŒæ­¥å’Œå¼‚æ­¥ä¸»è¦å–å†³äºå®ƒè¢«è°ƒç”¨çš„ç¯å¢ƒ <strong>è¿™é‡Œçš„åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼ŒæŒ‡çš„è°ƒç”¨ setState æ–¹æ³•åï¼Œæ˜¯å¦èƒ½ç«‹åˆ»æ‹¿åˆ°æ›´æ–°åçš„å€¼</strong></p><p>1ï¼‰å¦‚æœ setState åœ¨ React èƒ½å¤Ÿæ§åˆ¶çš„èŒƒå›´è¢«è°ƒç”¨ï¼Œå®ƒå°±æ˜¯å¼‚æ­¥çš„ã€‚æ¯”å¦‚åˆæˆäº‹ä»¶å¤„ç†å‡½æ•°ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°</p><p>åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­ï¼Œå¤šæ¬¡è°ƒç”¨ setState ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œåªä¼šå–æœ€åä¸€æ¬¡çš„æ‰§è¡Œï¼Œå‰é¢çš„ä¼šè¢«è¦†ç›–</p><p>2ï¼‰å¦‚æœ setState åœ¨åŸç”Ÿ JavaScript æ§åˆ¶çš„èŒƒå›´è¢«è°ƒç”¨ï¼Œå®ƒå°±æ˜¯åŒæ­¥çš„ã€‚æ¯”å¦‚åŸç”Ÿäº‹ä»¶å¤„ç†å‡½æ•°ã€setTimeoutã€promise çš„å›è°ƒå‡½æ•°ç­‰</p><p>åœ¨åŸç”Ÿäº‹ä»¶å’Œå¼‚æ­¥ä¸­ï¼Œå¯ä»¥å¤šæ¬¡è°ƒç”¨ setState ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šç”Ÿæ•ˆ</p><p><strong>react ä¸­çš„åˆæˆäº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶</strong></p><p>react ä¸ºäº†è§£å†³è·¨å¹³å°ï¼Œå…¼å®¹æ€§é—®é¢˜ï¼Œè‡ªå·±å°è£…äº†ä¸€å¥—äº‹ä»¶æœºåˆ¶ï¼Œä»£ç†äº†åŸç”Ÿçš„äº‹ä»¶ï¼Œåƒåœ¨ jsx ä¸­å¸¸è§çš„ onClickã€onChange è¿™äº›éƒ½æ˜¯åˆæˆäº‹ä»¶</p><p>åŸç”Ÿäº‹ä»¶æ˜¯æŒ‡é react åˆæˆäº‹ä»¶ï¼ŒåŸç”Ÿè‡ªå¸¦çš„äº‹ä»¶ç›‘å¬ addEventListenerï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç”¨åŸç”Ÿ jsã€jq ç›´æ¥ç»‘å®šäº‹ä»¶çš„å½¢å¼éƒ½å±äºåŸç”Ÿäº‹ä»¶</p><p><a href="https://juejin.cn/post/6844903636749778958" target="_blank" rel="noopener noreferrer">ä½ çœŸçš„ç†è§£ setState å—ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="jsx-è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#jsx-è¯­æ³•" aria-hidden="true">#</a> jsx è¯­æ³•</h4><p>1ï¼‰jsx æ˜¯<code>React.createElement(component, props, ...children)</code> å‡½æ•°çš„è¯­æ³•ç³–</p><p>2ï¼‰åº•å±‚æ˜¯ä½¿ç”¨<code>babel-plugin-transform-react-jsx</code>æ’ä»¶ å°† jsx çš„è¯­æ³•è½¬åŒ–ä¸º js å¯¹è±¡ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ jsx å¯¹è±¡æˆ–æ˜¯å¦æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè½¬åŒ–ä¸ºå¯¹åº”çš„ js å¯¹è±¡ï¼ˆè™šæ‹Ÿ domï¼‰</p><p><strong>jsx ä»£ç ç¤ºä¾‹</strong></p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// ç¤ºä¾‹ä¸€:</span>
<span class="token comment">// å¦‚ä¸‹ JSX ä»£ç </span>
<span class="token operator">&lt;</span>MyButton color<span class="token operator">=</span><span class="token string double-quoted-string">&quot;blue&quot;</span> shadowSize<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Click Me<span class="token operator">&lt;</span><span class="token operator">/</span>MyButton<span class="token operator">&gt;</span>
<span class="token comment">// ä¼šç¼–è¯‘ä¸ºï¼š</span>
React<span class="token operator">.</span><span class="token function">createElement</span><span class="token punctuation">(</span> MyButton<span class="token punctuation">,</span> <span class="token punctuation">{</span>color<span class="token punctuation">:</span> <span class="token string single-quoted-string">&#39;blue&#39;</span><span class="token punctuation">,</span> <span class="token argument-name">shadowSize</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;Click Me&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// ç¤ºä¾‹äºŒ:</span>
<span class="token comment">// ä»¥ä¸‹ä¸¤ç§ç¤ºä¾‹ä»£ç å®Œå…¨ç­‰æ•ˆ</span>
<span class="token keyword">const</span> <span class="token constant">element</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string single-quoted-string">&#39;greet&#39;</span><span class="token operator">&gt;</span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token comment">// ç­‰ä»·äº</span>
<span class="token keyword">const</span> <span class="token constant">element</span> <span class="token operator">=</span> React<span class="token operator">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;h1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span><span class="token string double-quoted-string">&quot;greet&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">&#39;Hello&#39;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æœåŠ¡ç«¯æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡ç«¯æ¸²æŸ“" aria-hidden="true">#</a> æœåŠ¡ç«¯æ¸²æŸ“</h3><p>å·¥ä½œä¸­ï¼Œæ›¾ä½¿ç”¨è¿‡<code>Nestjs</code>å’Œ<code>Nextjs</code>è¿™ä¸¤ä¸ªæœåŠ¡ç«¯æ¸²æŸ“çš„æ¡†æ¶ï¼Œå¼€å‘è¿‡ä¸€äº›éœ€è¦æ”¯æŒ SEO çš„é¡¹ç›®ï¼Œå€Ÿæ­¤æ€»ç»“ä¸€äº›æœåŠ¡ç«¯æ¸²æŸ“çš„çŸ¥è¯†</p><h4 id="æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å¤šç§æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å¤šç§æ¨¡å¼" aria-hidden="true">#</a> æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å¤šç§æ¨¡å¼</h4><p><strong>ä¼ ç»Ÿçš„ spa åº”ç”¨ï¼Œéƒ½å±äº CSR (Client Side Rendering)å®¢æˆ·ç«¯æ¸²æŸ“</strong></p><p>ä¸»è¦é—®é¢˜</p><p>1ï¼‰ç™½å±æ—¶é—´è¿‡é•¿ï¼šåœ¨ JS bundle è¿”å›ä¹‹å‰ï¼Œå‡å¦‚ bundle ä½“ç§¯è¿‡å¤§æˆ–è€…ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹ï¼Œé¡µé¢ä¸€ç›´æ˜¯ç©ºç™½çš„ï¼Œç”¨æˆ·ä½“éªŒä¸å‹å¥½</p><p>2ï¼‰SEO ä¸å‹å¥½ï¼šæœç´¢å¼•æ“è®¿é—®é¡µé¢æ—¶ï¼Œåªä¼šçœ‹ HTML ä¸­çš„å†…å®¹ï¼Œé»˜è®¤æ˜¯ä¸ä¼šæ‰§è¡Œ JSï¼Œæ‰€ä»¥æŠ“å–ä¸åˆ°é¡µé¢çš„å…·ä½“å†…å®¹</p><p><strong>æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å¤šç§æ¨¡å¼</strong></p><p>1ï¼‰SSR (Server Side Rendering)ï¼Œ å³æœåŠ¡ç«¯æ¸²æŸ“</p><p>æœåŠ¡ç«¯ç›´æ¥å®æ—¶åŒæ„æ¸²æŸ“å½“å‰ç”¨æˆ·è®¿é—®çš„é¡µé¢ï¼Œè¿”å›çš„ HTML åŒ…å«é¡µé¢å…·ä½“å†…å®¹ï¼Œæé«˜ç”¨æˆ·çš„ä½“éªŒ</p><p>é€‚ç”¨äºï¼šé¡µé¢åŠ¨æ€å†…å®¹ï¼ŒSEO çš„è¯‰æ±‚ã€è¦æ±‚é¦–å±æ—¶é—´å¿«çš„åœºæ™¯</p><p>ç¼ºç‚¹ï¼šSSR éœ€è¦è¾ƒé«˜çš„æœåŠ¡å™¨è¿ç»´æˆæœ¬ã€åˆ‡æ¢é¡µé¢æ—¶è¾ƒæ…¢ï¼Œæ¯æ¬¡åˆ‡æ¢é¡µé¢éƒ½éœ€è¦æœåŠ¡ç«¯æ–°ç”Ÿæˆé¡µé¢</p><p>2ï¼‰SSG (Static Site Generation)ï¼Œæ˜¯æŒ‡åœ¨åº”ç”¨ç¼–è¯‘æ„å»ºæ—¶é¢„å…ˆæ¸²æŸ“é¡µé¢ï¼Œå¹¶ç”Ÿæˆé™æ€çš„ HTML</p><p>æŠŠç”Ÿæˆçš„ HTML é™æ€èµ„æºéƒ¨ç½²åˆ°æœåŠ¡å™¨åï¼Œæµè§ˆå™¨ä¸ä»…é¦–æ¬¡èƒ½è¯·æ±‚åˆ°å¸¦é¡µé¢å†…å®¹çš„ HTML ï¼Œè€Œä¸”ä¸éœ€è¦æœåŠ¡å™¨å®æ—¶æ¸²æŸ“å’Œå“åº”ï¼Œå¤§å¤§èŠ‚çº¦äº†æœåŠ¡å™¨è¿ç»´æˆæœ¬å’Œèµ„æº</p><p>é€‚ç”¨äºï¼šé¡µé¢å†…å®¹ç”±åç«¯è·å–ï¼Œä½†å˜åŒ–ä¸é¢‘ç¹ï¼Œæ»¡è¶³ SEO çš„è¯‰æ±‚ã€è¦æ±‚é¦–å±æ—¶é—´å¿«çš„åœºæ™¯ï¼ŒSSG æ‰“åŒ…å¥½çš„æ˜¯é™æ€é¡µé¢ï¼Œå’Œæ™®é€šé¡µé¢éƒ¨ç½²ä¸€æ ·</p><p>3ï¼‰ISR (Incremental Static Regeneration)ï¼Œåˆ›å»ºéœ€è¦å¢é‡é™æ€å†ç”Ÿçš„é¡µé¢</p><p>åˆ›å»ºå…·æœ‰åŠ¨æ€è·¯ç”±çš„é¡µé¢ï¼ˆå¢é‡é™æ€å†ç”Ÿï¼‰ï¼Œå…è®¸åœ¨åº”ç”¨è¿è¡Œæ—¶å†é‡æ–°ç”Ÿæˆæ¯ä¸ªé¡µé¢ HTMLï¼Œè€Œä¸éœ€è¦é‡æ–°æ„å»ºæ•´ä¸ªåº”ç”¨ï¼Œè¿™æ ·å³ä½¿æœ‰æµ·é‡é¡µé¢ï¼ˆæ¯”å¦‚åšå®¢ã€å•†å“ä»‹ç»é¡µç­‰åœºæ™¯ï¼‰ï¼Œä¹Ÿèƒ½ä½¿ç”¨ä¸Š SSG çš„ç‰¹æ€§</p><p>åœ¨ Nextjs ä¸­ï¼Œä½¿ç”¨ ISR éœ€è¦ getStaticPaths å’Œ getStaticProps åŒæ—¶é…åˆä½¿ç”¨</p><h4 id="vue-ssr-æœåŠ¡ç«¯æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#vue-ssr-æœåŠ¡ç«¯æ¸²æŸ“" aria-hidden="true">#</a> vue SSR æœåŠ¡ç«¯æ¸²æŸ“</h4><p>vue é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ Nestjs æ¡†æ¶ï¼Œå®ç° ssr æ¸²æŸ“ï¼Œå¼€å‘æœ‰ SEO éœ€æ±‚çš„é¡µé¢</p><p><strong>SSR åŸç†</strong></p><p>é€šè¿‡<code>asyncData</code>è·å–æ•°æ®ï¼Œæ•°æ®è·å–æˆåŠŸåï¼Œé€šè¿‡<code>vue-server-renderer</code>å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­ï¼Œç”Ÿæˆå®Œæ•´çš„ html å†…å®¹ï¼ŒæœåŠ¡ç«¯å°†è¿™æ®µ html å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®ç°æœåŠ¡ç«¯æ¸²æŸ“</p><p><strong>SSR åŸºæœ¬äº¤äº’æµç¨‹</strong></p><p>1ï¼‰åœ¨æµè§ˆå™¨è®¿é—®é¦–é¡µæ—¶ï¼ŒWeb æœåŠ¡å™¨æ ¹æ®è·¯ç”±æ‹¿åˆ°å¯¹åº”æ•°æ®æ¸²æŸ“å¹¶è¾“å‡º htmlï¼Œè¾“å‡ºçš„ html åŒ…å«ä¸¤éƒ¨åˆ†</p><p>â‘  è·¯ç”±é¡µå¯¹åº”çš„é¡µé¢åŠå·²æ¸²æŸ“å¥½çš„æ•°æ®ï¼ˆåç«¯æ¸²æŸ“ï¼‰</p><p>â‘¡ å®Œæ•´çš„ SPA ç¨‹åºä»£ç </p><p>2ï¼‰åœ¨å®¢æˆ·ç«¯é¦–å±æ¸²æŸ“å®Œæˆä¹‹åï¼Œå…¶å®å·²ç»æ˜¯ä¸€ä¸ªå’Œä¹‹å‰çš„ SPA ç›¸å·®æ— å‡ çš„åº”ç”¨ç¨‹åºäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œçš„ä»»ä½•æ“ä½œéƒ½åªæ˜¯å®¢æˆ·ç«¯çš„åº”ç”¨è¿›è¡Œäº¤äº’</p><p><strong>vue SSR æ•´ä½“æµç¨‹</strong></p><p>1ï¼‰é…ç½®ä¸¤ä¸ªå…¥å£æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯ä½¿ç”¨ï¼Œä¸€å¥—ä»£ç ä¸¤å¥—æ‰§è¡Œç¯å¢ƒ</p><p>2ï¼‰æœåŠ¡ç«¯æ¸²æŸ“éœ€è¦ Vue å®ä¾‹ï¼Œæ¯ä¸€æ¬¡å®¢æˆ·ç«¯è¯·æ±‚é¡µé¢ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“éƒ½æ˜¯ç”¨ä¸€ä¸ªæ–°çš„ Vue å®ä¾‹ï¼ŒæœåŠ¡ç«¯åˆ©ç”¨å·¥å‚å‡½æ•°æ¯æ¬¡éƒ½è¿”å›ä¸€ä¸ªæ–°çš„ Vue å®ä¾‹</p><p>3ï¼‰è·å–è¯·æ±‚é¡µé¢çš„è·¯ç”±ï¼Œç”Ÿæˆå¯¹åº”çš„ vue å®ä¾‹</p><p>4ï¼‰å¦‚æœé¡µé¢ä¸­éœ€è¦è°ƒæ¥å£è·å–æ•°æ®ï¼Œé€šè¿‡<code>asyncData</code>è·å–æ•°æ®ï¼Œæ•°æ®è·å–æˆåŠŸåï¼Œé€šè¿‡å¼‚æ­¥çš„æ–¹å¼å†ç»§ç»­è¿›è¡Œåˆå§‹åŒ–ï¼Œé€šè¿‡<code>vue-server-renderer</code>å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­ï¼Œç”Ÿæˆ html å†…å®¹</p><p><strong>å¦‚ä½•é¿å…å®¢æˆ·ç«¯é‡å¤è¯·æ±‚æ•°æ®</strong></p><p>åœ¨æœåŠ¡ç«¯å·²ç»è¯·æ±‚çš„æ•°æ®ï¼Œåœ¨å®¢æˆ·ç«¯åº”è¯¥é¿å…é‡å¤è¯·æ±‚ï¼Œæ€æ ·åŒæ­¥æ•°æ®åˆ°å®¢æˆ·ç«¯ï¼Ÿ</p><p><strong>é€šè¿‡ï¼ˆwindow å¯¹è±¡ä½œä¸ºä¸­é—´åª’ä»‹è¿›è¡Œä¼ é€’æ•°æ®ï¼‰</strong></p><p>1ï¼‰æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œä¿å­˜åˆ°æœåŠ¡ç«¯çš„ store çŠ¶æ€ï¼Œä»¥ä¾¿æ¸²æŸ“æ—¶å€™ä½¿ç”¨ï¼Œæœ€ç»ˆä¼šå°† store ä¿å­˜åˆ° window ä¸­</p><p>2ï¼‰åœ¨ renderer ä¸­ä¼šåœ¨ html ä»£ç ä¸­æ·»åŠ  <code>&lt;script&gt;window.__INITIAL_STATE__ = context.state&lt;/script&gt;ï¼Œ</code> åœ¨è§£æé¡µé¢çš„æ—¶å€™ä¼šè¿›è¡Œè®¾ç½®å…¨å±€å˜é‡</p><p>3ï¼‰åœ¨æµè§ˆå™¨è¿›è¡Œåˆå§‹åŒ– Store çš„æ—¶å€™ï¼Œé€šè¿‡ window å¯¹è±¡è¿›è¡Œè·å–æ•°æ®åœ¨æœåŠ¡ç«¯çš„çŠ¶æ€ï¼Œå¹¶ä¸”å°†å…¶æ³¨å…¥åˆ° store.state çŠ¶æ€ä¸­ï¼Œè¿™æ ·èƒ½å¤Ÿå®ç°çŠ¶æ€ç»Ÿä¸€</p><p><strong>ä¸ºä»€ä¹ˆæœåŠ¡ç«¯æ¸²æŸ“ä¸èƒ½è°ƒç”¨ mounted é’©å­</strong></p><p>æœåŠ¡ç«¯æ¸²æŸ“ä¸èƒ½è°ƒç”¨<code>beforeMount</code>å’Œ<code>mounted</code>ï¼ŒNode ç¯å¢ƒæ²¡æœ‰ document å¯¹è±¡ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œvue åº•å±‚ä¼šåˆ¤æ–­å½“å‰ç¯å¢ƒä¸­æ˜¯å¦æœ‰ el è¿™ä¸ª dom å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸ä¼šæ‰§è¡Œåˆ° beforeMount å’Œ mounted è¿™ä¸¤ä¸ªé’©å­å‡½æ•°</p><p><a href="https://juejin.cn/post/6844903569632526344" target="_blank" rel="noopener noreferrer">Vue æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6950802238524620837" target="_blank" rel="noopener noreferrer">ç†è§£ Vue SSR åŸç†ï¼Œæ­å»ºé¡¹ç›®æ¡†æ¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="react-next-é¢„æ¸²æŸ“æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#react-next-é¢„æ¸²æŸ“æ¨¡å¼" aria-hidden="true">#</a> react Next é¢„æ¸²æŸ“æ¨¡å¼</h4><p>Next.js æ”¯æŒ SSRã€SSGã€ISR ä¸‰ç§æ¨¡å¼ï¼Œé»˜è®¤æ˜¯ SSG</p><p>1ï¼‰SSR æ¨¡å¼</p><p>éœ€è¦å°† Next.js åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œå¼€å¯æœåŠ¡ç«¯æ¸²æŸ“</p><p><strong>æ•´ä¸ªæµç¨‹</strong></p><p>ç”¨æˆ·è®¿é—®é¡µé¢ â†’ å¦‚æœè¯¥é¡µé¢é…ç½®äº† getServerSideProps å‡½æ•° â†’ è°ƒç”¨ getServerSideProps å‡½æ•° â†’ ç”¨æ¥å£çš„æ•°æ®æ¸²æŸ“å‡ºå®Œæ•´çš„é¡µé¢è¿”å›ç»™ç”¨æˆ·</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å®šä¹‰é¡µé¢</span>
<span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Render data...</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¦‚æœè¯¥é¡µé¢é…ç½®äº† getServerSidePropså‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¯·æ±‚æ¥å£æ‹¿åˆ°å¯¹åº”çš„æ•°æ®</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://.../data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¯¼å‡ºæ•´ä¸ªé¡µé¢</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Page<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰SSG æ¨¡å¼</p><p>SSG æ¨¡å¼ï¼šé¡¹ç›®åœ¨æ‰“åŒ…æ—¶ï¼Œä»æ¥å£ä¸­è¯·æ±‚æ•°æ®ï¼Œç„¶åç”¨æ•°æ®æ„å»ºå‡ºå®Œæ•´çš„ html é¡µé¢ï¼Œæœ€åæŠŠæ‰“åŒ…å¥½çš„é™æ€é¡µé¢ï¼Œç›´æ¥æ”¾åˆ°æœåŠ¡å™¨ä¸Šå³å¯</p><p>Next.js å…è®¸ä½ ä»åŒä¸€æ–‡ä»¶ <code>exportï¼ˆå¯¼å‡ºï¼‰</code> ä¸€ä¸ªåä¸º <code>getStaticProps</code> çš„ <code>asyncï¼ˆå¼‚æ­¥ï¼‰</code> å‡½æ•°ã€‚è¯¥å‡½æ•°åœ¨æ„å»ºæ—¶è¢«è°ƒç”¨ï¼Œå¹¶å…è®¸ä½ åœ¨é¢„æ¸²æŸ“æ—¶å°†è·å–çš„æ•°æ®ä½œä¸º <code>props</code> å‚æ•°ä¼ é€’ç»™é¡µé¢</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å®šä¹‰Blogé¡µé¢</span>
<span class="token keyword">function</span> <span class="token function">Blog</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> posts <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Render posts...</span>
<span class="token punctuation">}</span>

<span class="token comment">// getStaticPropså‡½æ•°ï¼Œåœ¨æ„å»ºæ—¶è¢«è°ƒç”¨</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è°ƒç”¨å¤–éƒ¨ API è·å–åšæ–‡åˆ—è¡¨</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://.../posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// é€šè¿‡è¿”å› { props: { posts } } å¯¹è±¡ï¼ŒBlog ç»„ä»¶</span>
  <span class="token comment">// åœ¨æ„å»ºæ—¶å°†æ¥æ”¶åˆ° `posts` å‚æ•°</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      posts<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¯¼å‡ºBlogé¡µé¢</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Blog<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ï¼‰ISR æ¨¡å¼</p><p>åˆ›å»ºå…·æœ‰ åŠ¨æ€è·¯ç”± çš„é¡µé¢ï¼Œç”¨äºæµ·é‡ç”Ÿæˆ</p><p>Next.js å…è®¸åœ¨åº”ç”¨è¿è¡Œæ—¶å†é‡æ–°ç”Ÿæˆæ¯ä¸ªé¡µé¢ HTMLï¼Œè€Œä¸éœ€è¦é‡æ–°æ„å»ºæ•´ä¸ªåº”ç”¨ã€‚è¿™æ ·å³ä½¿æœ‰æµ·é‡é¡µé¢ï¼Œä¹Ÿèƒ½ä½¿ç”¨ä¸Š SSG çš„ç‰¹æ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ ISR éœ€è¦ getStaticPaths å’Œ getStaticProps åŒæ—¶é…åˆä½¿ç”¨</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å®šä¹‰åšæ–‡é¡µé¢</span>
<span class="token keyword">function</span> <span class="token function">Blog</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> post <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Render post...</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ­¤å‡½æ•°åœ¨æ„å»ºæ—¶è¢«è°ƒç”¨</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è°ƒç”¨å¤–éƒ¨ API è·å–åšæ–‡åˆ—è¡¨</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://.../posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ®åšæ–‡åˆ—è¡¨ç”Ÿæˆæ‰€æœ‰éœ€è¦é¢„æ¸²æŸ“çš„è·¯å¾„</span>
  <span class="token keyword">const</span> paths <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> post<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> paths<span class="token punctuation">,</span> <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// åœ¨æ„å»ºæ—¶ä¹Ÿä¼šè¢«è°ƒç”¨</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// params åŒ…å«æ­¤ç‰‡åšæ–‡çš„ `id` ä¿¡æ¯ã€‚</span>
  <span class="token comment">// å¦‚æœè·¯ç”±æ˜¯ /posts/1ï¼Œé‚£ä¹ˆ params.id å°±æ˜¯ 1</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://.../posts/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// é€šè¿‡ props å‚æ•°å‘é¡µé¢ä¼ é€’åšæ–‡çš„æ•°æ®</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> post <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Blog<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.nextjs.cn%2Fdocs%2Fbasic-features%2Fpages%23%E9%A2%84%E6%B8%B2%E6%9F%93" target="_blank" rel="noopener noreferrer">next é¢„æ¸²æŸ“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6977783923099041800" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ Next.js è¿›è¡Œå¢é‡é™æ€å†ç”Ÿï¼ˆISRï¼‰çš„å®Œæ•´æŒ‡å—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="node" tabindex="-1"><a class="header-anchor" href="#node" aria-hidden="true">#</a> Node</h3><p>Node ç»å¸¸ç”¨äºå‰ç«¯æ„å»ºã€å¾®æœåŠ¡ã€ä¸­å°ç­‰åœºæ™¯</p><p>æˆ‘æ›¾ç”¨ Node åšè¿‡ä¸€äº›æŠ½å¥–ç±»çš„æ´»åŠ¨ï¼Œé¡¹ç›®æ¶æ„æ˜¯ <code>express + mongoDb + redis</code></p><p><strong>å¼€å‘åå°é¡¹ç›®çš„æ€»ä½“æ„Ÿå—</strong></p><p>1ï¼‰å’Œåç«¯çš„åŒäº‹æ²Ÿé€šèµ·æ¥æ›´é¡ºç•…äº†ï¼Œä¹‹å‰ä»–ä»¬è€æ˜¯è¯´è¿™å¼ è¡¨ã€é‚£å¼ è¡¨ã€redis ä»€ä¹ˆçš„ï¼Œç°åœ¨ä¹Ÿèƒ½ç†è§£äº†ï¼Œæ¶ˆé™¤äº†ä¸€äº›å½¼æ­¤çš„éš”é˜‚</p><p>2ï¼‰æ›´å…¨é¢çš„å»ç†è§£ä¸šåŠ¡ï¼Œäº†è§£æ•´å¥—æµç¨‹ï¼Œæ¯”å¦‚å‰åç«¯æ˜¯å¦‚ä½•é…åˆçš„ã€æ•°æ®å¦‚ä½•ä¼ é€’ã€åå°æ˜¯å¦‚ä½•å¤„ç†ï¼Œç”šè‡³åœ¨éœ€æ±‚è¯„å®¡æ—¶ï¼Œå¯ä»¥æå‡ºè‡ªå·±çš„æ–¹æ¡ˆæˆ–å»ºè®®</p><p>ä¸‹é¢ï¼Œæˆ‘æµ…è°ˆä¸€ä¸‹å¯¹ Node ç†è§£</p><h4 id="node-é«˜å¹¶å‘çš„åŸç†" tabindex="-1"><a class="header-anchor" href="#node-é«˜å¹¶å‘çš„åŸç†" aria-hidden="true">#</a> Node é«˜å¹¶å‘çš„åŸç†</h4><p><strong>Node çš„ç‰¹ç‚¹ï¼šäº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/Oã€é«˜å¹¶å‘</strong></p><p><strong>Node é«˜å¹¶å‘çš„åŸç†</strong></p><p>Nodejs ä¹‹æ‰€ä»¥å•çº¿ç¨‹å¯ä»¥å¤„ç†é«˜å¹¶å‘çš„åŸå› ï¼Œå¾—ç›Šäºå†…éƒ¨çš„äº‹ä»¶å¾ªç¯æœºåˆ¶å’Œåº•å±‚çº¿ç¨‹æ± å®ç°</p><p>é‡åˆ°å¼‚æ­¥ä»»åŠ¡ï¼Œnode å°†æ‰€æœ‰çš„é˜»å¡æ“ä½œéƒ½äº¤ç»™äº†å†…éƒ¨çš„çº¿ç¨‹æ± å»å®ç°ã€‚æœ¬è´¨ä¸Šçš„å¼‚æ­¥æ“ä½œè¿˜æ˜¯ç”±çº¿ç¨‹æ± å®Œæˆçš„ï¼Œä¸»çº¿ç¨‹æœ¬èº«åªè´Ÿè´£ä¸æ–­çš„å¾€è¿”è°ƒåº¦ï¼Œä»è€Œå®ç°å¼‚æ­¥éé˜»å¡ I/Oï¼Œè¿™ä¾¿æ˜¯ node å•çº¿ç¨‹å’Œäº‹ä»¶é©±åŠ¨çš„ç²¾é«“ä¹‹å¤„</p><p><strong>æ•´ä½“æµç¨‹</strong></p><p>1ï¼‰æ¯ä¸ª Node è¿›ç¨‹åªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹åœ¨æ‰§è¡Œç¨‹åºä»£ç </p><p>2ï¼‰å½“ç”¨æˆ·çš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œã€è¯»å–æ–‡ä»¶ç­‰å…¶å®ƒçš„å¼‚æ­¥æ“ä½œæ—¶ï¼Œnode éƒ½ä¼šæŠŠå®ƒæ”¾åˆ° Event Queueï¼ˆ&quot;äº‹ä»¶é˜Ÿåˆ—&quot;ï¼‰ä¹‹ä¸­ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œå®ƒï¼Œä»£ç ä¹Ÿä¸ä¼šè¢«é˜»å¡ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼Œç›´åˆ°ä¸»çº¿ç¨‹ä»£ç æ‰§è¡Œå®Œæ¯•</p><p>3ï¼‰ä¸»çº¿ç¨‹ä»£ç æ‰§è¡Œå®Œæ¯•å®Œæˆåï¼Œç„¶åé€šè¿‡äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œä¾æ¬¡å–å‡ºå¯¹åº”çš„äº‹ä»¶ï¼Œä»çº¿ç¨‹æ± ä¸­åˆ†é…ä¸€ä¸ªå¯¹åº”çš„çº¿ç¨‹å»æ‰§è¡Œï¼Œå½“æœ‰äº‹ä»¶æ‰§è¡Œå®Œæ¯•åï¼Œä¼šé€šçŸ¥ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œå›è°ƒæ‹¿åˆ°å¯¹åº”çš„ç»“æœ</p><h4 id="node-äº‹ä»¶å¾ªç¯æœºåˆ¶ä¸æµè§ˆå™¨çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#node-äº‹ä»¶å¾ªç¯æœºåˆ¶ä¸æµè§ˆå™¨çš„åŒºåˆ«" aria-hidden="true">#</a> Node äº‹ä»¶å¾ªç¯æœºåˆ¶ä¸æµè§ˆå™¨çš„åŒºåˆ«</h4><p><strong>ä¸»è¦åŒºåˆ«</strong>ï¼šæµè§ˆå™¨ä¸­çš„å¾®ä»»åŠ¡æ˜¯åœ¨æ¯ä¸ªç›¸åº”çš„å®ä»»åŠ¡ä¸­æ‰§è¡Œçš„ï¼Œè€Œ nodejs ä¸­çš„å¾®ä»»åŠ¡æ˜¯åœ¨ä¸åŒé˜¶æ®µä¹‹é—´æ‰§è¡Œçš„ã€‚</p><p>node äº‹ä»¶å¾ªç¯æœºåˆ¶åˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œ</p><p>æ¯å½“è¿›å…¥æŸä¸€ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œéƒ½ä¼šä»å¯¹åº”çš„å›è°ƒé˜Ÿåˆ—ä¸­å–å‡ºå‡½æ•°å»æ‰§è¡Œã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ•°é‡åˆ°è¾¾ç³»ç»Ÿè®¾å®šçš„é˜ˆå€¼ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€é˜¶æ®µ</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3293e898bd56417c94a69b80f77cf4d6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="nodeLoop.jpg"></p><p>ä¸»è¦ä»‹ç»<code>timersã€pollã€check</code>è¿™ 3 ä¸ªé˜¶æ®µï¼Œå› ä¸ºæ—¥å¸¸å¼€å‘ä¸­çš„ç»å¤§éƒ¨åˆ†å¼‚æ­¥ä»»åŠ¡éƒ½æ˜¯åœ¨è¿™ 3 ä¸ªé˜¶æ®µå¤„ç†çš„</p><p>1ï¼‰timer timers é˜¶æ®µä¼šæ‰§è¡Œ setTimeout å’Œ setInterval å›è°ƒï¼Œå¹¶ä¸”æ˜¯ç”± poll é˜¶æ®µæ§åˆ¶çš„</p><p>2ï¼‰poll poll æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„é˜¶æ®µï¼Œè¿™ä¸€é˜¶æ®µä¸­ï¼Œç³»ç»Ÿä¼šåšä¸¤ä»¶äº‹æƒ…ï¼šå›åˆ° timer é˜¶æ®µæ‰§è¡Œå›è°ƒï¼šæ‰§è¡Œ I/O å›è°ƒ</p><p>3ï¼‰ check é˜¶æ®µ setImmediate()çš„å›è°ƒä¼šè¢«åŠ å…¥ check é˜Ÿåˆ—ä¸­ï¼Œä» event loop çš„é˜¶æ®µå›¾å¯ä»¥çŸ¥é“ï¼Œcheck é˜¶æ®µçš„æ‰§è¡Œé¡ºåºåœ¨ poll é˜¶æ®µä¹‹å</p><p>å…¶ä¸­çš„ç»†èŠ‚æ¨èçœ‹ä¸‹è¿™ä¸¤ç¯‡æ–‡ç« </p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2FLuckyWinty%2Farticle%2Fdetails%2F104765786" target="_blank" rel="noopener noreferrer">é¢è¯•é¢˜ï¼šè¯´è¯´äº‹ä»¶å¾ªç¯æœºåˆ¶(æ»¡åˆ†ç­”æ¡ˆæ¥äº†)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F54882306" target="_blank" rel="noopener noreferrer">æµè§ˆå™¨ä¸ Node çš„äº‹ä»¶å¾ªç¯(Event Loop)æœ‰ä½•åŒºåˆ«?<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="ä¸­é—´ä»¶åŸç†" tabindex="-1"><a class="header-anchor" href="#ä¸­é—´ä»¶åŸç†" aria-hidden="true">#</a> ä¸­é—´ä»¶åŸç†</h4><p>æ¯”è¾ƒæµè¡Œçš„ Node.js æ¡†æ¶æœ‰<code>Express</code>ã€<code>KOA</code> å’Œ <code>Egg.js</code>ï¼Œéƒ½æ˜¯åŸºäºä¸­é—´ä»¶æ¥å®ç°çš„ã€‚ä¸­é—´ä»¶ä¸»è¦ç”¨äºè¯·æ±‚æ‹¦æˆªå’Œä¿®æ”¹è¯·æ±‚æˆ–å“åº”ç»“æœ</p><p>node ä¸­é—´ä»¶æœ¬è´¨ä¸Šå°±æ˜¯åœ¨è¿›å…¥å…·ä½“çš„ä¸šåŠ¡å¤„ç†ä¹‹å‰ï¼Œå…ˆè®©ç‰¹å®šè¿‡æ»¤å™¨è¿›è¡Œå¤„ç†</p><p>ä¸€æ¬¡ Http è¯·æ±‚é€šå¸¸åŒ…å«å¾ˆå¤šå·¥ä½œï¼Œå¦‚<code>è¯·æ±‚ä½“è§£æã€Cookieå¤„ç†ã€æƒé™éªŒè¯ã€å‚æ•°éªŒè¯ã€è®°å½•æ—¥å¿—ã€ipè¿‡æ»¤ã€å¼‚å¸¸å¤„ç†</code>ç­‰ï¼Œè¿™äº›ç¯èŠ‚é€šè¿‡ä¸­é—´ä»¶å¤„ç†ï¼Œè®©å¼€å‘äººå‘˜æŠŠæ ¸å¿ƒæ”¾åœ¨å¯¹åº”çš„ä¸šåŠ¡å¼€å‘ä¸Š</p><p><strong>è¿™ç§æ¨¡å¼ä¹Ÿè¢«ç§°ä¸º&quot;æ´‹è‘±åœˆæ¨¡å‹&quot;</strong></p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f896c2c4d21c470ca82e193544b53487~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="onion.png"></p><p><strong>æ¨¡æ‹Ÿä¸€ä¸ªä¸­é—´ä»¶æµç¨‹</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">m1</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m1 run&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;result1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">m2</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m2 run&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;result2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">m3</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m3 run&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;result3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> middlewares <span class="token operator">=</span> <span class="token punctuation">[</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> m3<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> middleware <span class="token operator">=</span> middlewares<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">middleware</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// å¯åŠ¨ä¸­é—´ä»¶</span>
<span class="token function">useApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä¾æ¬¡æ‰“å°ï¼š</span>
m1 run
m2 run
m3 run
result3
result2
result1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>express ä¸­é—´ä»¶çš„æ‰§è¡Œè¿‡ç¨‹</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">&quot;3000&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;å¯åŠ¨æœåŠ¡&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;end1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;second&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;end2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;third&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;end3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¯·æ±‚http://localhost:3000/#/</span>
ä¾æ¬¡æ‰“å°ï¼š
first
second
third
end3
end2
end1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>express å¸¸ç”¨çš„ä¸­é—´ä»¶</strong></p><table><thead><tr><th>ä¸­é—´ä»¶åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>express.static()</td><td>ç”¨æ¥è¿”å›é™æ€æ–‡ä»¶</td></tr><tr><td>body-parser</td><td>ç”¨äºè§£æ post æ•°æ®</td></tr><tr><td>multer</td><td>å¤„ç†æ–‡ä»¶ä¸Šä¼ </td></tr><tr><td>cookie-parser</td><td>ç”¨æ¥æ“ä½œ cookie</td></tr><tr><td>cookie-session</td><td>å¤„ç† session</td></tr></tbody></table><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2FKlausLily%2Farticle%2Fdetails%2F109506490" target="_blank" rel="noopener noreferrer">æ·±å…¥æµ…å‡º node ä¸­é—´ä»¶åŸç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2FxiaosongJiang%2Fp%2F10854467.html" target="_blank" rel="noopener noreferrer">nodejs ä¸­é—´ä»¶ç†è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="å®ç°ä¸€ä¸ªå¤§æ–‡ä»¶ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼ " tabindex="-1"><a class="header-anchor" href="#å®ç°ä¸€ä¸ªå¤§æ–‡ä»¶ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼ " aria-hidden="true">#</a> å®ç°ä¸€ä¸ªå¤§æ–‡ä»¶ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼ </h4><p>æ¨èä¸€ä¸ªä½¿ç”¨ node çš„ç»å…¸æ¡ˆä¾‹</p><p>è¯¥æ¡ˆä¾‹ä¼šä½¿ç”¨ node å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œè¿™ä¹Ÿæ˜¯ node æœ€å¸¸ç”¨çš„åœºæ™¯ä¹‹ä¸€</p><p>å…¶ä¸­ä¸€ä¸ªå…³é”®çš„çŸ¥è¯†ç‚¹ï¼š<code>pipeç®¡é“æµ</code></p><p><strong>ç®¡é“ï¼š</strong> ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºç›´æ¥æˆä¸ºä¸‹ä¸€ä¸ªç¨‹åºçš„è¾“å…¥ï¼Œå°±åƒæ°´æµè¿‡ç®¡é“ä¸€æ ·æ–¹ä¾¿ <code>readStream.pipe(writeStream)</code> å°±æ˜¯åœ¨å¯è¯»æµä¸å¯å†™æµä¸­é—´åŠ å…¥ä¸€ä¸ªç®¡é“ï¼Œå®ç°ä¸€è¾¹è¯»å–ï¼Œä¸€è¾¹å†™å…¥ï¼Œè¯»ä¸€ç‚¹å†™ä¸€ç‚¹ã€‚</p><p><strong>ç®¡é“æµçš„å¥½å¤„ï¼šèŠ‚çº¦å†…å­˜</strong></p><p>è¯»å‡ºçš„æ•°æ®ï¼Œä¸åšä¿å­˜ï¼Œç›´æ¥æµå‡ºã€‚å†™å…¥å†™å‡ºä¼šæå¤§çš„å ç”¨å†…å­˜ï¼Œstream å¯ä»¥è¾¹è¯»è¾¹å†™ï¼Œä¸å ç”¨å¤ªå¤šå†…å­˜ï¼Œå¹¶ä¸”å®Œæˆæ‰€éœ€ä»»åŠ¡</p><p><a href="https://juejin.cn/post/6844904046436843527" target="_blank" rel="noopener noreferrer">å­—èŠ‚è·³åŠ¨é¢è¯•å®˜ï¼šè¯·ä½ å®ç°ä¸€ä¸ªå¤§æ–‡ä»¶ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="å¦‚ä½•åšåˆ°æ¥å£é˜²åˆ·" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åšåˆ°æ¥å£é˜²åˆ·" aria-hidden="true">#</a> å¦‚ä½•åšåˆ°æ¥å£é˜²åˆ·</h4><p>å› ä¸ºä¹‹å‰åšçš„æ˜¯æŠ½å¥–ç³»ç»Ÿï¼Œæ¥å£é˜²åˆ·æ˜¯éå¸¸å¿…è¦çš„ï¼Œä¹Ÿæ˜¯<strong>é«˜å¹¶å‘</strong>ä¸‹çš„ç»å…¸åœºæ™¯</p><p>å…¶ä¸­çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œå·²ç»è¶…è¿‡äº†å‰ç«¯çš„èŒƒç•´ï¼Œä¸è¿‡æŠ€ä¸å‹èº«ï¼Œå¤šäº†è§£ä¸€äº›æ€»æ˜¯æ²¡é”™çš„</p><p><strong>1ï¼‰ç¬¬ä¸€æ­¥ï¼šè´Ÿè½½å‡è¡¡å±‚çš„é™æµï¼Œé˜²æ­¢ç”¨æˆ·é‡å¤æŠ½å¥–</strong></p><p>åœ¨è´Ÿè½½å‡è¡¡è®¾å¤‡ä¸­åšä¸€äº›é…ç½®ï¼Œåˆ¤æ–­å¦‚æœåŒä¸€ä¸ªç”¨æˆ·åœ¨ 1 åˆ†é’Ÿä¹‹å†…å¤šæ¬¡å‘é€è¯·æ±‚æ¥è¿›è¡ŒæŠ½å¥–ï¼Œå°±è®¤ä¸ºæ˜¯æ¶æ„é‡å¤æŠ½å¥–ï¼Œæˆ–è€…æ˜¯ä»–ä»¬è‡ªå·±å†™çš„è„šæœ¬åœ¨åˆ·</p><p>è¿™ç§æµé‡ä¸€å¾‹è®¤ä¸ºæ˜¯æ— æ•ˆæµé‡ï¼Œåœ¨è´Ÿè½½å‡è¡¡è®¾å¤‡é‚£ä¸ªå±‚æ¬¡å°±ç»™ç›´æ¥å±è”½æ‰ã€‚ æ‰€ä»¥è¿™é‡Œå°±å¯ä»¥æŠŠ<strong>æ— æ•ˆæµé‡ç»™æ‹¦æˆªæ‰</strong></p><p><strong>2ï¼‰ç¬¬äºŒæ­¥ï¼šæš´åŠ›æ‹¦æˆªæµé‡</strong></p><p>å…¶å®ç§’æ€ã€æŠ¢çº¢åŒ…ã€æŠ½å¥–ï¼Œè¿™ç±»ç³»ç»Ÿæœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å‡è®¾æœ‰ 50 ä¸‡è¯·æ±‚æ¶Œå…¥è¿›æ¥ï¼Œå¯èƒ½å‰ 5 ä¸‡è¯·æ±‚å°±ç›´æ¥æŠŠäº‹å„¿å¹²å®Œäº†ï¼Œç”šè‡³æ˜¯å‰ 500 è¯·æ±‚å°±æŠŠäº‹å„¿å¹²å®Œäº†</p><p>åç»­çš„å‡ åä¸‡æµé‡æ˜¯æ— æ•ˆçš„ï¼Œä¸éœ€è¦è®©ä»–ä»¬è¿›å…¥åå°ç³»ç»Ÿæ‰§è¡Œä¸šåŠ¡é€»è¾‘äº†</p><p>è¿™æ ·çš„è¯ï¼Œå…¶å®åœ¨è´Ÿè½½å‡è¡¡è¿™ä¸€å±‚ï¼ˆå¯ä»¥è€ƒè™‘ç”¨ Nginx ä¹‹ç±»çš„æ¥å®ç°ï¼‰å°±å¯ä»¥æ‹¦æˆªæ‰ 99%çš„æ— æ•ˆæµé‡</p><p><strong>3ï¼‰ç¬¬ä¸‰æ­¥ï¼šip æˆ–ç”¨æˆ·æŠ½å¥–æ¬¡æ•°æ ¡éªŒ</strong></p><p>å»ºç«‹ä¸€ä¸ªæŠ½å¥–è¡¨ï¼Œè¯¥è¡¨è®°å½•æ‰€æœ‰å‚ä¸æŠ½å¥–çš„ ip å’Œç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚åˆ¤æ–­ 5s å†…ï¼Œè¯¥ç”¨æˆ·è¿ç»­æŠ½å¥–äº† 2 æ¬¡ä»¥ä¸Šï¼Œå°±æ‹’ç»è¯¥è¯·æ±‚ï¼Œè®¤ä¸ºæ˜¯åœ¨åˆ·æ¥å£ï¼Œå°±æŠŠè¯¥ç”¨æˆ·å’Œ ip åŠ å…¥é»‘åå•</p><p><a href="https://juejin.cn/post/6844903847031226382" target="_blank" rel="noopener noreferrer">å¦‚ä½•è®¾è®¡ä¸€ä¸ªç™¾ä¸‡çº§ç”¨æˆ·çš„æŠ½å¥–ç³»ç»Ÿï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="mongodb-å’Œ-mysql-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#mongodb-å’Œ-mysql-çš„åŒºåˆ«" aria-hidden="true">#</a> mongoDb å’Œ mySQL çš„åŒºåˆ«</h4><p><strong>1ï¼‰mongoDb æ˜¯éå…³ç³»å‹æ•°æ®åº“ï¼ŒmySQL æ˜¯å…³ç³»å‹æ•°æ®åº“</strong></p><p>mongoDb é‡Œå­˜å‚¨çš„æ˜¯ json æ ¼å¼çš„æ•°æ®ï¼Œé”®å€¼å¯¹å½¢å¼ï¼Œè¯¥æ•°æ®ç»“æ„éå¸¸ç¬¦åˆå‰ç«¯çš„éœ€æ±‚</p><p>å…³ç³»å‹æ•°æ®å¤©ç„¶å°±æ˜¯è¡¨æ ¼å¼çš„ï¼Œå°±æ˜¯åç«¯å¸¸è¯´çš„â€œè¡¨â€ï¼Œæ•°æ®å­˜å‚¨åœ¨æ•°æ®è¡¨çš„è¡Œå’Œåˆ—ä¸­ã€‚æ•°æ®è¡¨å¯ä»¥å½¼æ­¤å…³è”åä½œå­˜å‚¨ï¼Œä¹Ÿå¾ˆå®¹æ˜“æå–æ•°æ®</p><p><strong>2ï¼‰å¯¹äº‹åŠ¡æ€§çš„æ”¯æŒä¸åŒ</strong></p><p>mongoDb ä¸æ”¯æŒäº‹åŠ¡ï¼ŒmySQL æ”¯æŒäº‹åŠ¡</p><p>äº‹åŠ¡çš„å¥½å¤„ä¾¿äºå›æ»šï¼Œå¦‚ç¬¬ä¸€ä¸ªè´¦æˆ·åˆ’å‡ºæ¬¾é¡¹å¿…é¡»ä¿è¯æ­£ç¡®çš„å­˜å…¥ç¬¬äºŒä¸ªè´¦æˆ·ï¼Œå¦‚æœç¬¬äºŒä¸ªç¯èŠ‚æ²¡æœ‰å®Œæˆï¼Œæ•´ä¸ªçš„è¿‡ç¨‹éƒ½åº”è¯¥å–æ¶ˆï¼Œå¦åˆ™å°±ä¼šå‘ç”Ÿä¸¢å¤±æ¬¾é¡¹çš„é—®é¢˜ã€‚è¿™æ—¶å°±éœ€è¦å›æ»šï¼Œæ¢å¤åˆ°åˆå§‹çš„çŠ¶æ€</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2F1488boss%2Fp%2F10754290.html" target="_blank" rel="noopener noreferrer">mongodb ä¸ mysql åŒºåˆ«ï¼ˆè¶…è¯¦ç»†ï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="é«˜å¹¶å‘æ—¶çš„å¦‚ä½•æ­£ç¡®ä¿®æ”¹åº“å­˜" tabindex="-1"><a class="header-anchor" href="#é«˜å¹¶å‘æ—¶çš„å¦‚ä½•æ­£ç¡®ä¿®æ”¹åº“å­˜" aria-hidden="true">#</a> é«˜å¹¶å‘æ—¶çš„å¦‚ä½•æ­£ç¡®ä¿®æ”¹åº“å­˜</h4><p><strong>åœºæ™¯ï¼š</strong> æŠ½å¥–æˆ–ç§’æ€æ´»åŠ¨ï¼ŒåŒæ—¶ä¸€åƒä¸ªè¯·æ±‚è¿‡æ¥ï¼Œä½†å¥–å“åº“å­˜åªæœ‰ä¸€ä¸ªï¼ŒæœŸæœ›çš„ç»“æœæ˜¯åªæœ‰ä¸€ä¸ªäººä¸­å¥–ï¼Œå‰©ä½™ 999 ä¸ªäººæ²¡æœ‰ä¸­å¥–</p><p>ä½†å‹æµ‹æ—¶ï¼Œé‡åˆ°çš„æƒ…å†µå´æ˜¯ 1000 ä¸ªéƒ½ä¸­å¥–äº†ï¼Œå¹¶ä¸”åº“å­˜è¿˜æ˜¯ä¸€ä¸ª</p><p>å“å¾—å½“æ—¶è„¸éƒ½ç»¿äº†ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µå•Šâ€¦â€¦</p><p>åŸå› å°±æ˜¯é«˜å¹¶å‘æ—¶ï¼Œä¸€åƒä¸ªè¯·æ±‚åŒæ—¶è¯»åˆ°çš„åº“å­˜éƒ½æ˜¯ä¸€ä¸ªï¼Œéƒ½ä¸­å¥–åï¼Œåº“å­˜åŒæ—¶å‡ä¸€ï¼Œæœ€åå¯¼è‡´åº“å­˜æ²¡æœ‰å‡å¯¹</p><p>è§£å†³æ­¤ç±»é—®é¢˜ï¼Œå°±æ˜¯è¦ç»™<strong>æ•°æ®åº“åŠ é”</strong>çš„æ¦‚å¿µï¼Œä¿è¯åº“å­˜<code>ä¸€ä¸ªä¸€ä¸ªå‡ã€ä¸²è¡Œçš„å‡</code>ï¼Œè§£å†³æ–¹å¼æ˜¯ä½¿ç”¨ mongoDb ä¸­<code>update</code>æ–¹æ³•å‡åº“å­˜</p><p><strong>mongoDb ä¸­ï¼Œæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å®ç°æ›´æ–°æ•°æ®ï¼š</strong></p><p>1ï¼‰<code>save</code>æ–¹æ³•ï¼Œå¦‚<code>db.collection.save(obj)</code>ï¼Œsave æ˜¯åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç”Ÿæˆçš„å¯¹è±¡ï¼Œéœ€è¦ä»å®¢æˆ·ç«¯å›å†™åˆ°æœåŠ¡å™¨ç«¯</p><p>2ï¼‰<code>findOneAndUpdate</code>æ–¹æ³•ï¼Œå¦‚<code>db.findOneAndUpdate(&lt;filter&gt;,{obj})</code>, å’Œ save ç±»ä¼¼ä¹Ÿéœ€è¦ä»å®¢æˆ·ç«¯å›å†™åˆ°æœåŠ¡å™¨ç«¯</p><p>3ï¼‰<code>update</code>æ–¹æ³•ï¼Œå¦‚<code>db.update(&lt;filter&gt;,{obj})</code>ï¼Œupdate æ˜¯æœåŠ¡å™¨ç«¯å¤„ç†çš„ï¼Œé€Ÿåº¦æœ€å¿«ï¼›å®æµ‹å½“å¹¶å‘æ•°è¶…è¿‡ 1000 æ¬¡æ¯ç§’æ—¶ï¼Œupdate çš„é€Ÿåº¦æ˜¯å…¶ä»–çš„ 2 å€</p><h4 id="redis" tabindex="-1"><a class="header-anchor" href="#redis" aria-hidden="true">#</a> Redis</h4><p><strong>Redis çš„ç‰¹ç‚¹</strong></p><p>1ï¼‰Redis ä¹Ÿæ˜¯ä¸€ç§æ•°æ®åº“ï¼ŒRedis ä¸­çš„æ•°æ®æ˜¯<strong>æ”¾åˆ°å†…å­˜ä¸­çš„ï¼ŒRedis æŸ¥è¯¢é€Ÿåº¦æå¿«</strong>ã€‚ä¸€äº›å¸¸ç”¨çš„æ•°æ®ï¼Œå¯ä»¥å­˜åˆ° Redis ä¸­ï¼Œç¼©çŸ­ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„æ—¶é—´</p><p>2ï¼‰Redis å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥å°†ä¸€äº›éœ€è¦å®šæœŸè¿‡æœŸçš„ä¿¡æ¯æ”¾åˆ° Redis ä¸­ï¼Œæœ‰ç‚¹ç±»ä¼¼ cookie</p><p><strong>è¿ç”¨åœºæ™¯</strong></p><p>1ï¼‰å°†ç»å¸¸æŸ¥è¯¢çš„ä¿¡æ¯å­˜å‚¨åˆ° redis ä¸­ï¼Œå¦‚æŠ½å¥–æ´»åŠ¨çš„é…ç½®ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æŸ¥è¯¢çš„é¢‘ç‡æœ€é«˜ï¼Œæ”¾åˆ° Redis ä¸­å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œè¿˜å¯ä»¥å­˜å‚¨ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼ˆæƒé™ã€åŸºç¡€ä¿¡æ¯ç­‰ï¼‰</p><p>2ï¼‰éœ€è¦è®¾ç½®è¿‡æœŸæ—¶é•¿çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å¾®ä¿¡æˆæƒï¼Œæ¯ 2 å°æ—¶å»è¿‡æœŸä¸€æ¬¡ï¼Œå°†å¯¹åº”çš„æˆæƒ code å­˜è¿›å»ï¼Œåˆ°æ—¶åˆ é™¤</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fwgw_dream%2Farticle%2Fdetails%2F83780503" target="_blank" rel="noopener noreferrer">Redis çš„ä¼˜ç¼ºç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="node-åˆ›å»ºå­è¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#node-åˆ›å»ºå­è¿›ç¨‹" aria-hidden="true">#</a> node åˆ›å»ºå­è¿›ç¨‹</h4><p>å½“çš„é¡¹ç›®ä¸­éœ€è¦æœ‰å¤§é‡è®¡ç®—çš„æ“ä½œæ—¶å€™ï¼Œå°±è¦è€ƒè™‘å¼€å¯å¤šè¿›ç¨‹æ¥å®Œæˆäº†ï¼Œç±»ä¼¼äº<a href="https://juejin.cn/post/7137728629986820126" target="_blank" rel="noopener noreferrer">web worker<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå¦åˆ™ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„æ‰§è¡Œ</p><p>Node æä¾›äº† <code>child_process</code> æ¨¡å—æ¥åˆ›å»ºå­è¿›ç¨‹</p><p><strong>è¿›ç¨‹é—´é€šä¿¡</strong>ï¼šä½¿ç”¨<code>fork</code>æ–¹æ³•åˆ›å»ºçš„å­è¿›ç¨‹ï¼Œå¯é€šè¿‡<code>sendã€on</code>ï¼ˆmessageï¼‰æ–¹æ³•æ¥å‘é€å’Œæ¥æ”¶è¿›ç¨‹é—´çš„æ•°æ®</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å…·ä½“ä»£ç </span>
<span class="token comment">// parent.js</span>
<span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// é€šè¿‡child_processä¸­çš„forkæ–¹æ³•æ¥ç”Ÿæˆå­è¿›ç¨‹</span>
<span class="token keyword">let</span> child <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">&quot;child.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;from_parent&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sendæ–¹æ³•å‘é€æ•°æ®</span>
child<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// onæ–¹æ³•æ¥æ”¶æ•°æ®</span>
<span class="token comment">// child.js</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;from_child&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fchyingp%2Fp%2Fnode-learning-guide-child_process.html" target="_blank" rel="noopener noreferrer">Nodejs è¿›é˜¶ï¼šå¦‚ä½•ç©è½¬å­è¿›ç¨‹ï¼ˆchild_processï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="pm2" tabindex="-1"><a class="header-anchor" href="#pm2" aria-hidden="true">#</a> PM2</h4><p>PM2 å¯ä»¥æ ¹æ® cpu æ ¸æ•°ï¼Œå¼€å¯å¤šä¸ªè¿›ç¨‹ï¼Œå……åˆ†åˆ©ç”¨ cpu çš„å¤šæ ¸æ€§èƒ½</p><p>å¦‚<code>pm2 start app.js -i 8</code> è¯¥å‘½ä»¤å¯ä»¥å¼€å¯ 8 ä¸ªè¿›ç¨‹</p><p><strong>ä¸»è¦ä½œç”¨ï¼š</strong></p><p>1ï¼‰å†…å»ºè´Ÿè½½å‡è¡¡ï¼ˆä½¿ç”¨<code>Node cluster</code>é›†ç¾¤æ¨¡å—ï¼‰ 2ï¼‰çº¿ç¨‹å®ˆæŠ¤ï¼Œkeep alive 3ï¼‰0 ç§’åœæœºé‡è½½ï¼Œç»´æŠ¤å‡çº§çš„æ—¶å€™ä¸éœ€è¦åœæœº 4ï¼‰åœæ­¢ä¸ç¨³å®šçš„è¿›ç¨‹ï¼ˆé¿å…æ— é™å¾ªç¯ï¼‰</p><p><strong>è´Ÿè½½å‡è¡¡ cluster çš„åŸç†</strong></p><p>1ï¼‰Node.js ç»™æˆ‘ä»¬æä¾›äº†<code>clusteræ¨¡å—</code>ï¼Œå®ƒå¯ä»¥ç”Ÿæˆå¤šä¸ªå·¥ä½œçº¿ç¨‹æ¥å…±äº«åŒä¸€ä¸ª TCP è¿æ¥</p><p>2ï¼‰é¦–å…ˆï¼ŒCluster ä¼šåˆ›å»ºä¸€ä¸ª masterï¼Œç„¶åæ ¹æ®ä½ æŒ‡å®šçš„æ•°é‡å¤åˆ¶å‡ºå¤šä¸ª server appï¼ˆä¹Ÿè¢«ç§°ä¹‹ä¸ºå·¥ä½œçº¿ç¨‹ï¼‰</p><p>3ï¼‰å®ƒé€šè¿‡ IPC é€šé“ä¸å·¥ä½œçº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„è´Ÿè½½å‡è¡¡æ¥æ›´å¥½åœ°å¤„ç†çº¿ç¨‹ä¹‹é—´çš„å‹åŠ›ï¼Œè¯¥è´Ÿè½½å‡è¡¡ä½¿ç”¨äº† Round-robin ç®—æ³•ï¼ˆä¹Ÿè¢«ç§°ä¹‹ä¸ºå¾ªç¯ç®—æ³•ï¼‰</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fjaxu%2Fp%2F5193643.html" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ PM2 å°† Node.js çš„é›†ç¾¤å˜å¾—æ›´åŠ å®¹æ˜“ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fjaxu%2Fp%2F5193643.html" target="_blank" rel="noopener noreferrer">PM2 å…¥é—¨æŒ‡å—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨" aria-hidden="true">#</a> è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨</h2><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2952cccf0f414e3bae38e939016b04ab~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="è®¡ç®—æœºç½‘ç»œä¸å®‰å…¨.png"></p><h3 id="ä»è¾“å…¥-url-åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ä»è¾“å…¥-url-åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆ" aria-hidden="true">#</a> ä»è¾“å…¥ URL åˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3><p>1ï¼‰æµè§ˆå™¨æŸ¥æ‰¾å½“å‰ URL æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œå¹¶æ¯”è¾ƒç¼“å­˜æ˜¯å¦è¿‡æœŸã€‚ï¼ˆå…ˆåˆ¤æ–­ HTTP è¯·æ±‚æµè§ˆå™¨æ˜¯å¦å·²ç¼“å­˜ï¼‰</p><p><strong>æœ‰ç¼“å­˜</strong></p><p>å¦‚ä¸º<strong>å¼ºåˆ¶ç¼“å­˜</strong>ï¼Œé€šè¿‡<code>Expiresæˆ–Cache-Controlï¼šmax-age</code>åˆ¤æ–­è¯¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œæœªè¿‡æœŸï¼Œç›´æ¥ä½¿ç”¨è¯¥èµ„æºï¼›Expires å’Œ max-ageï¼Œå¦‚æœä¸¤è€…åŒæ—¶å­˜åœ¨ï¼Œåˆ™è¢« Cache-Control çš„ max-age è¦†ç›–ã€‚</p><p>å¦‚ä¸º<strong>åå•†ç¼“å­˜</strong>ï¼Œè¯·æ±‚å¤´éƒ¨å¸¦ä¸Šç›¸å…³ä¿¡æ¯å¦‚<code>if-none-matchï¼ˆEtagï¼‰</code>ä¸<code>if-modified-since(last-modified)</code>ï¼ŒéªŒè¯ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼Œè‹¥æœ‰æ•ˆåˆ™è¿”å›çŠ¶æ€ç ä¸º<code>304</code>ï¼Œè‹¥æ— æ•ˆåˆ™é‡æ–°è¿”å›èµ„æºï¼ŒçŠ¶æ€ç ä¸º<code>200</code></p><p>2ï¼‰DNS è§£æ URL å¯¹åº”çš„ IPï¼ˆ<code>DNSè§£ææµç¨‹è§ä¸‹æ–‡</code>ï¼‰</p><p>3ï¼‰æ ¹æ® IP å»ºç«‹ TCP è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼ˆ<code>æ¡æ‰‹è¿‡ç¨‹è§ä¸‹æ–‡</code>ï¼‰</p><p>4ï¼‰HTTP å‘èµ·è¯·æ±‚</p><p>5ï¼‰æœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œæµè§ˆå™¨æ¥æ”¶ HTTP å“åº”</p><p>6ï¼‰æ¸²æŸ“é¡µé¢ï¼Œæ„å»º DOM æ ‘</p><p>â‘ HTML è§£æï¼Œç”Ÿæˆ DOM æ ‘ â‘¡ æ ¹æ® CSS è§£æç”Ÿæˆ CSS æ ‘ â‘¢ ç»“åˆ DOM æ ‘å’Œ CSS è§„åˆ™æ ‘ï¼Œç”Ÿæˆæ¸²æŸ“æ ‘ â‘£ æ ¹æ®æ¸²æŸ“æ ‘è®¡ç®—æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼ˆlayout å¸ƒå±€ï¼‰ â‘¤ æ ¹æ®è®¡ç®—å¥½çš„ä¿¡æ¯ç»˜åˆ¶é¡µé¢</p><p>å¦‚æœé‡åˆ° script æ ‡ç­¾ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦å«æœ‰ defer æˆ–è€… async å±æ€§ï¼Œå¦‚æœæœ‰ï¼Œå¼‚æ­¥å»ä¸‹è½½è¯¥èµ„æºï¼›å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œæš‚åœ dom çš„è§£æï¼Œå»åŠ è½½ script çš„èµ„æºï¼Œç„¶åæ‰§è¡Œè¯¥ js ä»£ç ï¼ˆ<strong>script æ ‡ç­¾åŠ è½½å’Œæ‰§è¡Œä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“</strong>ï¼‰</p><p>7ï¼‰å…³é—­ TCP è¿æ¥ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰ï¼ˆ<code>æŒ¥æ‰‹è¿‡ç¨‹è§ä¸‹æ–‡</code>ï¼‰</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fliutianzeng%2Fp%2F10456865.html" target="_blank" rel="noopener noreferrer">ä»è¾“å…¥ url åˆ°é¡µé¢åŠ è½½å®Œæˆå‘ç”Ÿäº†ä»€ä¹ˆè¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6844903922084085773" target="_blank" rel="noopener noreferrer">åœ¨æµè§ˆå™¨è¾“å…¥ URL å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼ˆè¶…è¯¦ç»†ç‰ˆï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="å½»åº•å¼„æ‡‚-cors-è·¨åŸŸè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#å½»åº•å¼„æ‡‚-cors-è·¨åŸŸè¯·æ±‚" aria-hidden="true">#</a> å½»åº•å¼„æ‡‚ cors è·¨åŸŸè¯·æ±‚</h3><p>cors æ˜¯è§£å†³è·¨åŸŸé—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ³•ï¼Œå…³é”®æ˜¯æœåŠ¡å™¨è¦è®¾ç½®<code>Access-Control-Allow-Origin</code>ï¼Œæ§åˆ¶å“ªäº›åŸŸåå¯ä»¥å…±äº«èµ„æº</p><p><code>origin</code>æ˜¯ cors çš„é‡è¦æ ‡è¯†ï¼Œåªè¦æ˜¯éåŒæºæˆ–è€… POST è¯·æ±‚éƒ½ä¼šå¸¦ä¸Š Origin å­—æ®µï¼Œæ¥å£è¿”å›åæœåŠ¡å™¨ä¹Ÿå¯ä»¥å°†<code>Access-Control-Allow-Origin</code>è®¾ç½®ä¸ºè¯·æ±‚çš„ Originï¼Œè§£å†³ cors å¦‚ä½•æŒ‡å®šå¤šä¸ªåŸŸåçš„é—®é¢˜</p><p><strong>cors å°†è¯·æ±‚åˆ†ä¸ºç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚</strong></p><p><strong>ç®€å•è¯·æ±‚</strong></p><p>1ï¼‰åªæ”¯æŒ HEADï¼Œgetã€post è¯·æ±‚æ–¹å¼ï¼›</p><p>2ï¼‰æ²¡æœ‰è‡ªå®šä¹‰çš„è¯·æ±‚å¤´ï¼›</p><p>3ï¼‰<code>Content-Type</code>ï¼šåªé™äºä¸‰ä¸ªå€¼<code>application/x-www-form-urlencoded</code>ã€<code>multipart/form-data</code>ã€<code>text/plain</code></p><p>å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ª<code>Origin</code>å­—æ®µã€‚å¦‚æœæµè§ˆå™¨å‘ç°è¿™ä¸ªæ¥å£å›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å«<code>Access-Control-Allow-Origin</code>å­—æ®µçš„è¯å°±ä¼šæŠ¥è·¨åŸŸé”™è¯¯</p><p><strong>éç®€å•è¯·æ±‚çš„è·¨åŸŸå¤„ç†</strong></p><p>éç®€å•è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º<code>&quot;é¢„æ£€&quot;è¯·æ±‚</code>ï¼ˆoptionsï¼‰,ç”¨æ¥åˆ¤æ–­å½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­</p><p>å¦‚æœåœ¨è®¸å¯åå•ä¸­ï¼Œå°±ä¼šå‘æ­£å¼è¯·æ±‚ï¼›å¦‚æœä¸åœ¨ï¼Œå°±ä¼šæŠ¥è·¨è¶Šé”™è¯¯</p><p>æ³¨ï¼šæ–°ç‰ˆ chrome æµè§ˆå™¨çœ‹ä¸åˆ° OPTIONS é¢„æ£€è¯·æ±‚ï¼Œå¯ä»¥ç½‘ä¸ŠæŸ¥æ‰¾å¯¹åº”çš„æŸ¥çœ‹æ–¹æ³•</p><p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2016%2F04%2Fcors.html" target="_blank" rel="noopener noreferrer">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="tcp-çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" tabindex="-1"><a class="header-anchor" href="#tcp-çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" aria-hidden="true">#</a> TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</h3><p><strong>ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼š</strong></p><p>1ï¼‰ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œè¯·æ±‚å‘é€åï¼Œå®¢æˆ·ç«¯ä¾¿è¿›å…¥ SYN-SENT çŠ¶æ€</p><p>2ï¼‰ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªåº”ç­”ï¼Œå‘é€å®Œæˆåä¾¿è¿›å…¥ SYN-RECEIVED çŠ¶æ€</p><p>3ï¼‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå½“å®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥åŒæ„çš„åº”ç­”åï¼Œè¿˜è¦å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ã€‚å®¢æˆ·ç«¯å‘å®Œè¿™ä¸ªæŠ¥æ–‡æ®µåä¾¿è¿›å…¥ ESTABLISHED(å·²å»ºç«‹çš„) çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªåº”ç­”åä¹Ÿè¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œæ­¤æ—¶è¿æ¥å»ºç«‹æˆåŠŸ</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</strong></p><p>ä¸‰æ¬¡æ¡æ‰‹ä¹‹æ‰€ä»¥æ˜¯ä¸‰æ¬¡ï¼Œæ˜¯ä¿è¯ client å’Œ server å‡è®©å¯¹æ–¹çŸ¥é“è‡ªå·±çš„æ¥æ”¶å’Œå‘é€èƒ½åŠ›æ²¡é—®é¢˜è€Œä¿è¯çš„æœ€å°æ¬¡æ•°ã€‚ä¸¤æ¬¡ä¸å®‰å…¨ï¼Œå››æ¬¡æµªè´¹èµ„æº</p><p><strong>å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹</strong></p><p>å½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å…³é—­æŠ¥æ–‡æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³å…³é—­ï¼Œå…ˆå›å¤ä¸€ä¸ªæŠ¥æ–‡ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œ&quot;ä½ å‘çš„ FIN æŠ¥æ–‡æˆ‘æ”¶åˆ°äº†&quot;ã€‚åªæœ‰ç­‰åˆ°æˆ‘ Server ç«¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½å‘é€å®Œäº†ï¼Œæˆ‘æ‰èƒ½å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ï¼Œå› æ­¤ä¸èƒ½ä¸€èµ·å‘é€ã€‚æ•…éœ€è¦å››æ­¥æŒ¥æ‰‹</p><p><strong>ä¸¾ä¾‹ï¼š</strong> Browser:å…ˆå‘Šè¯‰æœåŠ¡å™¨ â€œæˆ‘æ•°æ®éƒ½å‘å®Œäº†ï¼Œä½ å¯ä»¥å…³é—­è¿æ¥äº†ã€‚â€ Server:å›å¤æµè§ˆå™¨ â€œå…³é—­çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†ï¼Œæˆ‘å…ˆçœ‹çœ‹æˆ‘è¿™è¾¹è¿˜æœ‰æ²¡æœ‰æ•°æ®æ²¡ä¼ å®Œã€‚â€ Server:ç¡®è®¤è¿‡ä»¥åï¼Œå†æ¬¡å›å¤æµè§ˆå™¨ â€œæˆ‘è¿™è¾¹æ•°æ®ä¼ è¾“å®Œæˆäº†ï¼Œä½ å¯ä»¥å…³é—­è¿æ¥äº†ã€‚â€ Browser:å‘Šè¯‰æœåŠ¡å™¨ â€œå¥½çš„ï¼Œé‚£æˆ‘å…³é—­äº†ã€‚ä¸ç”¨å›å¤äº†ã€‚â€ å®¢æˆ·ç«¯åˆç­‰äº† 2MSLï¼Œç¡®è®¤ç¡®å®æ²¡æœ‰å†æ”¶åˆ°è¯·æ±‚äº†ï¼Œæ‰ä¼šçœŸçš„å…³é—­ TCP è¿æ¥ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</strong></p><p>1ï¼‰TCP ä½¿ç”¨å››æ¬¡æŒ¥æ‰‹çš„åŸå› ï¼Œæ˜¯å› ä¸º TCP çš„è¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥éœ€è¦åŒæ–¹åˆ†åˆ«é‡Šæ”¾æ‰å¯¹æ–¹çš„è¿æ¥</p><p>2ï¼‰å•ç‹¬ä¸€æ–¹çš„è¿æ¥é‡Šæ”¾ï¼Œåªä»£ è¡¨ä¸èƒ½å†å‘å¯¹æ–¹å‘é€æ•°æ®ï¼Œè¿æ¥å¤„äºçš„æ˜¯åŠé‡Šæ”¾çš„çŠ¶æ€</p><p>3ï¼‰æœ€åä¸€æ¬¡æŒ¥æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´å†å…³é—­çš„åŸå› ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„ç¡®è®¤æŠ¥æ–‡æ®µä¸¢å¤±æˆ–è€…å‡ºé”™ï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨ç«¯ä¸èƒ½æ­£å¸¸å…³é—­</p><p><strong>ä»€ä¹ˆæ˜¯ 2MSLï¼Ÿ</strong></p><p>MSL æ˜¯ Maximum Segment Lifetime è‹±æ–‡çš„ç¼©å†™ï¼Œä¸­æ–‡å¯ä»¥è¯‘ä¸ºâ€œæŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´â€</p><p><strong>å››æ¬¡æŒ¥æ‰‹åï¼Œä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åè¿˜è¦ç­‰å¾… 2MSLï¼Ÿ</strong></p><p>1ï¼‰ä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€åä¸€ä¸ª ACK æŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾æœåŠ¡å™¨ï¼Œå› ä¸ºè¿™ä¸ª ACK æŠ¥æ–‡å¯èƒ½ä¸¢å¤±ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ°ï¼ŒæœåŠ¡ç«¯ä¼šé‡å‘ä¸€æ¬¡ï¼Œè€Œå®¢æˆ·ç«¯å°±èƒ½åœ¨è¿™ä¸ª 2MSL æ—¶é—´æ®µå†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„æŠ¥æ–‡ï¼Œæ¥ç€ç»™å‡ºå›åº”æŠ¥æ–‡ï¼Œå¹¶ä¸”ä¼šé‡å¯ 2MSL è®¡æ—¶å™¨</p><p>2ï¼‰é˜²æ­¢â€œå·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºç°åœ¨æœ¬è¿æ¥ä¸­</p><p>å®¢æˆ·ç«¯å‘é€å®Œæœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡åï¼Œåœ¨è¿™ä¸ª 2MSL æ—¶é—´ä¸­ï¼Œå°±å¯ä»¥ä½¿æœ¬è¿æ¥æŒç»­çš„æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡éƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·æ–°çš„è¿æ¥ä¸­ä¸ä¼šå‡ºç°æ—§è¿æ¥çš„è¯·æ±‚æŠ¥æ–‡</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.yuque.com%2Fcuggz%2Finterview%2Fcdpgm0%23L6Ep1" target="_blank" rel="noopener noreferrer">TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fqq_38128179%2Farticle%2Fdetails%2F102561469" target="_blank" rel="noopener noreferrer">TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹åŠå¸¸è§é¢è¯•é¢˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fxiaofei0859%2Farticle%2Fdetails%2F6044694" target="_blank" rel="noopener noreferrer">ä»€ä¹ˆæ˜¯ 2MSL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="websocket" tabindex="-1"><a class="header-anchor" href="#websocket" aria-hidden="true">#</a> WebSocket</h3><p>WebSocket æ˜¯ HTML5 æä¾›çš„ä¸€ç§æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œå…¨åŒå·¥é€šè®¯çš„ç½‘ç»œæŠ€æœ¯ï¼Œå±äºåº”ç”¨å±‚åè®®ï¼ŒWebSocket æ²¡æœ‰è·¨åŸŸçš„é™åˆ¶</p><p>ç›¸æ¯”äºæ¥å£è½®è®­ï¼Œéœ€è¦ä¸æ–­çš„å»ºç«‹ http è¿æ¥ï¼Œä¸¥é‡æµªè´¹äº†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„èµ„æº</p><p>WebSocket åŸºäº TCP ä¼ è¾“åè®®ï¼Œå¹¶å¤ç”¨ HTTP çš„æ¡æ‰‹é€šé“ã€‚æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å»ºç«‹ä¸€æ¬¡ http è¿æ¥ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚</p><p><strong>ç¼ºç‚¹</strong> websocket ä¸ç¨³å®šï¼Œè¦å»ºç«‹å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œå¦‚æœæ–­å¼€ï¼Œè‡ªåŠ¨è¿æ¥</p><p>[æ‰‹æ‘¸æ‰‹æ•™ä½ ä½¿ç”¨ WebSocket<a href="https://juejin.cn/post/6844903698498322439" target="_blank" rel="noopener noreferrer">å…¶å® WebSocket ä¹Ÿä¸éš¾]<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fyournevermore%2Farticle%2Fdetails%2F103067079" target="_blank" rel="noopener noreferrer">socket åŠ websocket çš„æ¡æ‰‹è¿‡ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="tcp-å’Œ-udp-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#tcp-å’Œ-udp-çš„åŒºåˆ«" aria-hidden="true">#</a> TCP å’Œ UDP çš„åŒºåˆ«</h3><p><strong>ç›¸åŒç‚¹ï¼š</strong> UDP åè®®å’Œ TCP åè®®éƒ½æ˜¯ä¼ è¾“å±‚åè®®</p><p><strong>ä¸åŒç‚¹ï¼š</strong></p><p>1ï¼‰TCP é¢å‘æœ‰è¿æ¥ï¼› UDPï¼šé¢å‘æ— è¿æ¥</p><p>2ï¼‰TCP è¦æä¾›å¯é çš„ã€é¢å‘è¿æ¥çš„ä¼ è¾“æœåŠ¡ã€‚TCP åœ¨å»ºç«‹é€šä¿¡å‰ï¼Œå¿…é¡»å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼Œä¹‹åæ‰èƒ½ä¼ è¾“æ•°æ®ã€‚TCP å»ºç«‹ä¸€ä¸ªè¿æ¥éœ€è¦ 3 æ¬¡æ¡æ‰‹ï¼Œæ–­å¼€è¿æ¥éœ€è¦ 4 æ¬¡æŒ¥æ‰‹ï¼Œå¹¶ä¸”æä¾›è¶…æ—¶é‡å‘ï¼Œä¸¢å¼ƒé‡å¤æ•°æ®ï¼Œæ£€éªŒæ•°æ®ï¼Œæµé‡æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œä¿è¯æ•°æ®èƒ½ä»ä¸€ç«¯ä¼ åˆ°å¦ä¸€ç«¯</p><p>3ï¼‰UDP ä¸å¯é æ€§ï¼Œåªæ˜¯æŠŠåº”ç”¨ç¨‹åºä¼ ç»™ IP å±‚çš„æ•°æ®æŠ¥å‘é€å‡ºå»ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯å®ƒä»¬èƒ½åˆ°è¾¾ç›®çš„åœ°</p><p>4ï¼‰åº”ç”¨åœºæ™¯</p><p>TCP æ•ˆç‡è¦æ±‚ç›¸å¯¹ä½ï¼Œä½†å¯¹å‡†ç¡®æ€§è¦æ±‚ç›¸å¯¹é«˜çš„åœºæ™¯ã€‚å¦‚å¸¸è§çš„æ¥å£è°ƒç”¨ã€æ–‡ä»¶ä¼ è¾“ã€è¿œç¨‹ç™»å½•ç­‰</p><p>UDP æ•ˆç‡è¦æ±‚ç›¸å¯¹é«˜ï¼Œå¯¹å‡†ç¡®æ€§è¦æ±‚ç›¸å¯¹ä½çš„åœºæ™¯ã€‚å¦‚åœ¨çº¿è§†é¢‘ã€ç½‘ç»œè¯­éŸ³ç”µè¯ç­‰</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fsifanchao%2Farticle%2Fdetails%2F82285018" target="_blank" rel="noopener noreferrer">é¢è¯•é¢˜ï¼šUDP&amp;TCP çš„åŒºåˆ«<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fliangyc%2Fp%2F11628208.html" target="_blank" rel="noopener noreferrer">TCP å’Œ UDP çš„åŒºåˆ«åŠåº”ç”¨åœºæ™¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="keep-alive-æŒä¹…è¿æ¥" tabindex="-1"><a class="header-anchor" href="#keep-alive-æŒä¹…è¿æ¥" aria-hidden="true">#</a> keep-alive æŒä¹…è¿æ¥</h3><p>keep-alive åˆå«æŒä¹…è¿æ¥ï¼Œå®ƒé€šè¿‡é‡ç”¨ä¸€ä¸ª TCP è¿æ¥æ¥å‘é€/æ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚ï¼Œæ¥å‡å°‘åˆ›å»º/å…³é—­å¤šä¸ª TCP è¿æ¥çš„å¼€é”€ï¼Œå¯ç”¨ Keep-Alive æ¨¡å¼æ€§èƒ½æ›´é«˜</p><p>åœ¨ HTTP1.1 åè®®ä¸­é»˜è®¤å¼€å¯ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤´ä¸Šçœ‹åˆ° Connection: keep-alive å¼€å¯çš„æ ‡è¯†</p><p>åœ¨ HTTP1.0 ä¸­é KeepAlive æ¨¡å¼æ—¶ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½è¦æ–°å»ºä¸€ä¸ª TCP è¯·æ±‚ï¼Œè¯·æ±‚ç»“æŸåï¼Œè¦å…³é—­ TCP è¿æ¥ã€‚æ•ˆç‡å¾ˆä½</p><p>æ³¨æ„ï¼šæŒä¹…è¿æ¥é‡‡ç”¨é˜»å¡æ¨¡å¼ï¼Œä¸‹æ¬¡è¯·æ±‚å¿…é¡»ç­‰åˆ°ä¸Šæ¬¡å“åº”è¿”å›åæ‰èƒ½å‘èµ·ï¼Œå¦‚æœä¸Šæ¬¡çš„è¯·æ±‚è¿˜æ²¡è¿”å›å“åº”å†…å®¹ï¼Œä¸‹æ¬¡è¯·æ±‚å°±åªèƒ½ç­‰ç€ï¼ˆå°±æ˜¯å¸¸è¯´çš„çº¿å¤´é˜»å¡ï¼‰</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Flotabout.me%2F2019%2FThings-about-keepalive%2F" target="_blank" rel="noopener noreferrer">HTTP keep-alive äºŒä¸‰äº‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="http1ã€2ã€3-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#http1ã€2ã€3-çš„åŒºåˆ«" aria-hidden="true">#</a> http1ã€2ã€3 çš„åŒºåˆ«</h3><p><strong>http1ã€2 çš„åŒºåˆ«ï¼š</strong></p><p>1ï¼‰äºŒè¿›åˆ¶ä¼ è¾“ï¼ŒHTTP/2 é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ä¼ è¾“æ•°æ®ï¼Œè€Œé HTTP/1.x é‡Œçº¯æ–‡æœ¬å½¢å¼çš„æŠ¥æ–‡ ï¼ŒäºŒè¿›åˆ¶åè®®è§£æèµ·æ¥æ›´é«˜æ•ˆ</p><p>2ï¼‰Header å‹ç¼©</p><p>HTTP/1.x çš„è¯·æ±‚å’Œå“åº”å¤´éƒ¨å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡å¤å‘é€ã€‚HTTP2 åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨â€œé¦–éƒ¨è¡¨â€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®-å€¼å¯¹ï¼Œå¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€</p><p>3ï¼‰å¤šè·¯å¤ç”¨</p><p>å°±æ˜¯åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸­å¯ä»¥å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå¯ä»¥é¿å… HTTP æ—§ç‰ˆæœ¬ä¸­çš„çº¿å¤´é˜»å¡é—®é¢˜ï¼ˆä¸‹æ¬¡è¯·æ±‚å¿…é¡»ç­‰åˆ°ä¸Šæ¬¡å“åº”è¿”å›åæ‰èƒ½å‘èµ·ï¼‰</p><p>è¿™æ ·æŸä¸ªè¯·æ±‚ä»»åŠ¡è€—æ—¶ä¸¥é‡ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒè¿æ¥çš„æ­£å¸¸æ‰§è¡Œï¼Œæå¤§çš„æé«˜ä¼ è¾“æ€§èƒ½</p><p>åœ¨ HTTP/2 ä¸­ï¼Œæœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯å¸§ï¼ˆframeï¼‰å’Œæµï¼ˆstreamï¼‰ã€‚ å¸§ä»£è¡¨ç€æœ€å°çš„æ•°æ®å•ä½ï¼Œæ¯ä¸ªå¸§ä¼šæ ‡è¯†å‡ºè¯¥å¸§å±äºå“ªä¸ªæµï¼ˆå³è¯·æ±‚ï¼‰ï¼Œé€šè¿‡é‡æ–°æ’åºè¿˜åŸè¯·æ±‚</p><p>4ï¼‰æœåŠ¡ç«¯æ¨é€ï¼š è¿™é‡Œçš„æœåŠ¡ç«¯æ¨é€ï¼Œæ˜¯æŒ‡æŠŠå®¢æˆ·ç«¯æ‰€éœ€è¦çš„ css/js/img èµ„æºä¼´éšç€ index.htmlï¼Œä¸€èµ·å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œçœå»äº†å®¢æˆ·ç«¯é‡å¤è¯·æ±‚çš„æ­¥éª¤</p><p><strong>Http3.0 çš„åŒºåˆ«</strong></p><p>http åè®®æ˜¯åº”ç”¨å±‚åè®®ï¼Œéƒ½æ˜¯å»ºç«‹åœ¨ä¼ è¾“å±‚ä¹‹ä¸Šçš„ã€‚2.0 å’Œ 1.0 éƒ½æ˜¯åŸºäº TCP çš„ï¼Œè€Œ Http3.0 åˆ™æ˜¯å»ºç«‹åœ¨ UDP çš„åŸºç¡€ä¸Š</p><p><strong>http3.0 æ–°ç‰¹æ€§</strong></p><p>1ï¼‰å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³ TCP ä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ 2ï¼‰é›†æˆäº† TLS åŠ å¯†åŠŸèƒ½ 3ï¼‰å‘å‰çº é”™æœºåˆ¶</p><p><strong>http1ã€2ã€3 æ€»ç»“ï¼š</strong></p><p>1ï¼‰HTTP/1.1 æœ‰ä¸¤ä¸ªä¸»è¦çš„ç¼ºç‚¹ï¼šå®‰å…¨ä¸è¶³å’Œæ€§èƒ½ä¸é«˜</p><p>2ï¼‰HTTP/2 å®Œå…¨å…¼å®¹ HTTP/1ï¼Œæ˜¯â€œæ›´å®‰å…¨çš„ HTTPã€æ›´å¿«çš„ HTTPS&quot;ï¼Œå¤´éƒ¨å‹ç¼©ã€å¤šè·¯å¤ç”¨ç­‰æŠ€æœ¯å¯ä»¥å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œé™ä½å»¶è¿Ÿï¼Œä»è€Œå¤§å¹…åº¦æé«˜ä¸Šç½‘ä½“éªŒ</p><p>3ï¼‰QUIC åŸºäº UDP å®ç°ï¼Œæ˜¯ HTTP/3 ä¸­çš„åº•å±‚æ”¯æ’‘åè®®ï¼Œè¯¥åè®®åŸºäº UDPï¼Œåˆå–äº† TCP ä¸­çš„ç²¾åï¼Œå®ç°äº†å³å¿«åˆå¯é çš„åè®®</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000020714686" target="_blank" rel="noopener noreferrer">è§£å¯† HTTP/2 ä¸ HTTP/3 çš„æ–°ç‰¹æ€§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Flimeii.github.io%2F2019%2F06%2Fhttp2-http3%2F" target="_blank" rel="noopener noreferrer">HTTP/3 æ–°ç‰¹æ€§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="https-æ¡æ‰‹è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#https-æ¡æ‰‹è¿‡ç¨‹" aria-hidden="true">#</a> HTTPS æ¡æ‰‹è¿‡ç¨‹</h3><p><strong>https é‡‡ç”¨éå¯¹ç§°åŠ å¯†+å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†æ¥ä¼ é€’å¯†é’¥ï¼›å¯¹ç§°åŠ å¯†æ¥åŠ å¯†å†…å®¹</strong></p><p>1ï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ https çš„ url è®¿é—® web æœåŠ¡å™¨ï¼Œè¦æ±‚ä¸æœåŠ¡å™¨å»ºç«‹ ssl è¿æ¥</p><p>2ï¼‰æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚å, ä¼šå°†ç½‘ç«™çš„è¯ä¹¦(åŒ…å«å…¬é’¥)ä¼ é€ä¸€ä»½ç»™å®¢æˆ·ç«¯</p><p>3ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°ç½‘ç«™è¯ä¹¦åä¼šæ£€æŸ¥è¯ä¹¦çš„é¢å‘æœºæ„ä»¥åŠè¿‡æœŸæ—¶é—´, å¦‚æœæ²¡æœ‰é—®é¢˜å°±éšæœºäº§ç”Ÿä¸€ä¸ªç§˜é’¥</p><p>4ï¼‰å®¢æˆ·ç«¯åˆ©ç”¨å…¬é’¥å°†ä¼šè¯ç§˜é’¥åŠ å¯†, å¹¶ä¼ é€ç»™æœåŠ¡ç«¯</p><p>5ï¼‰æœåŠ¡ç«¯åˆ©ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºä¼šè¯ç§˜é’¥ï¼Œä¹‹åæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä½¿ç”¨ç§˜é’¥åŠ å¯†ä¼ è¾“</p><p><strong>åŠ å¯†é€Ÿåº¦å¯¹æ¯”</strong></p><p>å¯¹ç§°åŠ å¯†è§£å¯†çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œé€‚åˆæ•°æ®æ¯”è¾ƒé•¿æ—¶çš„ä½¿ç”¨</p><p>éå¯¹ç§°åŠ å¯†å’Œè§£å¯†èŠ±è´¹çš„æ—¶é—´é•¿ã€é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œåªé€‚åˆå¯¹å°‘é‡æ•°æ®çš„ä½¿ç”¨</p><p>ï¼ˆéå¯¹ç§°åŠ å¯†ï¼šæœ‰å…¬é’¥ç§é’¥ï¼Œå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼›å¯¹ç§°åŠ å¯†ï¼šåŒä¸€ä¸ªç§˜é’¥è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†ï¼‰</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FStqqafHePlBkWAPQZg3NrA" target="_blank" rel="noopener noreferrer">ä¸€ä¸ªæ•…äº‹è®²å®Œ https<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»" tabindex="-1"><a class="header-anchor" href="#ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»" aria-hidden="true">#</a> ä»‹ç»ä¸‹ä¸­é—´äººæ”»å‡»</h3><p><strong>ä¸­é—´äººæ”»å‡»è¿‡ç¨‹å¦‚ä¸‹ï¼š</strong></p><p>1ï¼‰å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å»ºç«‹è¿æ¥çš„è¯·æ±‚ 2ï¼‰æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å…¬é’¥ 3ï¼‰æ”»å‡»è€…æˆªè·å…¬é’¥ï¼Œä¿ç•™åœ¨è‡ªå·±æ‰‹ä¸Š 4ï¼‰ç„¶åæ”»å‡»è€…è‡ªå·±ç”Ÿæˆä¸€ä¸ªã€ä¼ªé€ çš„ã€‘å…¬é’¥ï¼Œå‘ç»™å®¢æˆ·ç«¯ 5ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°ä¼ªé€ çš„å…¬é’¥åï¼Œç”ŸæˆåŠ å¯†çš„ç§˜é’¥å€¼å‘ç»™æœåŠ¡å™¨ 6ï¼‰æ”»å‡»è€…è·å¾—åŠ å¯†ç§˜é’¥ï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†è·å¾—ç§˜é’¥ 7ï¼‰åŒæ—¶ç”Ÿæˆå‡çš„åŠ å¯†ç§˜é’¥ï¼Œå‘ç»™æœåŠ¡å™¨ 8ï¼‰æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†è·å¾—å‡ç§˜é’¥ 9ï¼‰æœåŠ¡å™¨ç”¨å‡ç§˜é’¥åŠ å¯†ä¼ è¾“ä¿¡æ¯</p><p><strong>é˜²èŒƒæ–¹æ³•ï¼š</strong></p><p>æœåŠ¡ç«¯åœ¨å‘é€æµè§ˆå™¨çš„å…¬é’¥ä¸­åŠ å…¥ CA è¯ä¹¦ï¼Œæµè§ˆå™¨å¯ä»¥éªŒè¯ CA è¯ä¹¦çš„æœ‰æ•ˆæ€§</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.muyiy.cn%2Fquestion%2Fnetwork%2F91.html" target="_blank" rel="noopener noreferrer">ä»‹ç»ä¸‹ HTTPS ä¸­é—´äººæ”»å‡»<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="dns-è§£æè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#dns-è§£æè¿‡ç¨‹" aria-hidden="true">#</a> DNS è§£æè¿‡ç¨‹</h3><p><strong>DNS è§£æè¿‡ç¨‹:å°†åŸŸåè§£ææˆ IP åœ°å€</strong></p><p>DNS å«åšåŸŸåç³»ç»Ÿï¼Œæ˜¯åŸŸåå’Œå¯¹åº” ip åœ°å€çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚æœ‰äº†å®ƒï¼Œå°±å¯ä»¥ç”¨åŸŸåæ¥è®¿é—®å¯¹åº”çš„æœåŠ¡å™¨</p><p><strong>è¿‡ç¨‹ï¼š</strong></p><p>1ï¼‰åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å url åï¼Œä¼šä¼˜å…ˆåœ¨æµè§ˆå™¨ dns ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæœ‰ç¼“å­˜ï¼Œåˆ™ç›´æ¥å“åº”ç”¨æˆ·çš„è¯·æ±‚</p><p>2ï¼‰å¦‚æœæ²¡æœ‰è¦è®¿é—®çš„åŸŸåï¼Œå°±ç»§ç»­åœ¨æ“ä½œç³»ç»Ÿçš„ dns ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰ï¼Œæœ€åé€šè¿‡æœ¬åœ°çš„ dns æœåŠ¡å™¨æŸ¥åˆ°å¯¹åº”çš„ ip åœ°å€</p><p>3ï¼‰DNS æœåŠ¡å™¨å®Œæ•´çš„æŸ¥è¯¢è¿‡ç¨‹</p><p>æœ¬åœ° DNS æœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæ ¹åŸŸåæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ‰€æŸ¥è¯¢åŸŸçš„é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€</p><p>æœ¬åœ° DNS æœåŠ¡å™¨å‘é¡¶çº§åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæ¥å—è¯·æ±‚çš„æœåŠ¡å™¨æŸ¥è¯¢è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æœæœ‰è®°å½•ï¼Œå°±è¿”å›æŸ¥è¯¢ç»“æœï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›ç›¸å…³çš„ä¸‹ä¸€çº§çš„æƒå¨åŸŸåæœåŠ¡å™¨çš„åœ°å€</p><p>æœ¬åœ° DNS æœåŠ¡å™¨å‘æƒå¨åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæƒå¨åŸŸåæœåŠ¡å™¨è¿”å›å¯¹åº”çš„ç»“æœ</p><p>æœ¬åœ° DNS æœåŠ¡å™¨å°†è¿”å›ç»“æœä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä¾¿äºä¸‹æ¬¡ä½¿ç”¨</p><p>æœ¬åœ° DNS æœåŠ¡å™¨å°†è¿”å›ç»“æœè¿”å›ç»™æµè§ˆå™¨</p><p><strong>DNS é¢„è§£æ</strong></p><p>DNS Prefetch æ˜¯ä¸€ç§ DNS é¢„è§£ææŠ€æœ¯ï¼Œå½“ä½ æµè§ˆç½‘é¡µæ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨å¯¹ç½‘é¡µä¸­çš„åŸŸåè¿›è¡Œè§£æç¼“å­˜ï¼Œè¿™æ ·å½“é¡µé¢ä¸­éœ€è¦åŠ è½½è¯¥åŸŸåçš„èµ„æºæ—¶å°±æ— éœ€è§£æï¼Œå‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//hhh.images.test.com.cn&quot;&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.yuque.com%2Fcuggz%2Finterview%2Fcdpgm0%23egcXy" target="_blank" rel="noopener noreferrer">DNS å®Œæ•´çš„æŸ¥è¯¢è¿‡ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.sojson.com%2Fblog%2F218.html" target="_blank" rel="noopener noreferrer">dns-prefetch å¯¹ç½‘ç«™é€Ÿåº¦èƒ½æå‡æœ‰å¤šå°‘ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="xss-è·¨ç«™è„šæœ¬æ”»å‡»" tabindex="-1"><a class="header-anchor" href="#xss-è·¨ç«™è„šæœ¬æ”»å‡»" aria-hidden="true">#</a> XSS(è·¨ç«™è„šæœ¬æ”»å‡»)</h3><p><strong>XSS æ”»å‡»ä»‹ç»ï¼š</strong> æ”»å‡»è€…é€šè¿‡åœ¨é¡µé¢æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œä½¿ä¹‹åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œ</p><p>æ”»å‡»æ¡ˆä¾‹ï¼š</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>alert(&#39;XSS&#39;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:alert(&#39;XSS&#39;)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>alert(&quot;xssæ”»å‡»&quot;)<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>é“¾æ¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>XSS æ”»å‡»çš„å‡ ç§æ–¹å¼</strong></p><p>1ï¼‰å¸¸è§äºå¸¦æœ‰ç”¨æˆ·æäº¤æ•°æ®çš„ç½‘ç«™åŠŸèƒ½ï¼Œå¦‚å¡«å†™åŸºæœ¬ä¿¡æ¯ã€è®ºå›å‘å¸–ã€å•†å“è¯„è®ºç­‰ï¼›åœ¨å¯è¾“å…¥å†…å®¹çš„åœ°æ–¹æäº¤å¦‚<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ä¹‹ç±»çš„ä»£ç </p><p>XSS çš„æ¶æ„ä»£ç å­˜åœ¨æ•°æ®åº“é‡Œï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œ</p><p>2ï¼‰ç”¨æˆ·ç‚¹å‡»<code>http://xxx/search?keyword=&quot;&gt;&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt;</code>ï¼Œå‰ç«¯ç›´æ¥ä» url ä¸­å°† keyword åçš„å‚æ•°å–å‡ºæ¥ï¼Œå¹¶æ˜¾ç¤ºåˆ°é¡µé¢ä¸Šï¼Œä½†æ˜¯æ²¡æœ‰åšè½¬ä¹‰ï¼Œå°±é€ æˆäº† XSS æ”»å‡»ã€‚</p><p><strong>XSS æ”»å‡»çš„é˜²èŒƒ</strong></p><p>1ï¼‰å‰ç«¯å°½é‡å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹é•¿åº¦æ§åˆ¶ã€è¾“å…¥å†…å®¹é™åˆ¶ï¼ˆæ¯”å¦‚ç”µè¯å·ç ã€é‚®ç®±ã€åŒ…æ‹¬ç‰¹æ®Šå­—ç¬¦çš„é™åˆ¶ï¼‰</p><p>2ï¼‰æœåŠ¡å™¨å¯¹å‰ç«¯æäº¤çš„å†…å®¹åšå¥½å¿…è¦çš„è½¬ä¹‰ï¼Œé¿å…å°†æ¶æ„ä»£ç å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œé€ æˆå­˜å‚¨æ€§ xss æ”»å‡»</p><p>3ï¼‰å‰ç«¯å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®åšå¥½å¿…è¦çš„è½¬ä¹‰ï¼Œä¿è¯æ˜¾ç¤ºåˆ°é¡µé¢çš„å†…å®¹æ­£å¸¸</p><p><strong>vue ä¸­å¦‚ä½•é˜²æ­¢ XSS æ”»å‡»</strong></p><p>1ï¼‰vue ä¸­ä½¿ç”¨<code>{{}}æ¨¡æ¿</code>æ¸²æŸ“æ•°æ®æˆ–é€šè¿‡ v-bind ç»™å…ƒç´ ç»‘å®šå±æ€§æ—¶ï¼Œéƒ½å·²å°†å†…å®¹è½¬ä¹‰ï¼Œé˜²æ­¢ xss æ”»å‡»</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>// æ¡ˆä¾‹
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{string}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
string = &#39;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>alert(&quot;hi&quot;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>&#39;`
//è¢«è½¬ä¹‰æˆä¸ºå¦‚ä¸‹ <span class="token entity named-entity" title="&lt;">&amp;lt;</span>script<span class="token entity named-entity" title="&gt;">&amp;gt;</span>alert(<span class="token entity named-entity" title="&quot;">&amp;quot;</span>hi<span class="token entity named-entity" title="&quot;">&amp;quot;</span>)<span class="token entity named-entity" title="&lt;">&amp;lt;</span>/script<span class="token entity named-entity" title="&gt;">&amp;gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰å°½é‡é¿å…ä½¿ç”¨<code>v-html</code>ï¼Œå¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>vue-xss</code>æ’ä»¶å¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œè½¬ä¹‰ï¼Œè¯¥æ’ä»¶å¯ä»¥åŒæ—¶å»æ‰ä¸Šé¢ç»‘å®šçš„äº‹ä»¶</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code>// æ¡ˆä¾‹
`&lt;div v-html=<span class="token string">&quot;$xss(xss)&quot;</span>&gt;&lt;/div&gt;`
// pæ ‡ç­¾æ­£å¸¸æ˜¾ç¤ºï¼Œä½†ä¸Šé¢ç»‘å®šçš„äº‹ä»¶å·²è¢«å»æ‰
xss= <span class="token string">&quot;&lt;p onclick=&#39;console.log(document.cookie)&#39;&gt;123&lt;/p&gt;&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Ftech.meituan.com%2F2018%2F09%2F27%2Ffe-security.html" target="_blank" rel="noopener noreferrer">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é˜²æ­¢ XSS æ”»å‡»ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ " tabindex="-1"><a class="header-anchor" href="#csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ " aria-hidden="true">#</a> csrf è·¨ç«™è¯·æ±‚ä¼ªé€ </h3><p><strong>csrf çš„æ”»å‡»åŸç†ï¼š</strong></p><p>è¯±å¯¼å—å®³è€…è¿›å…¥é’“é±¼ç½‘ç«™ï¼Œåœ¨é’“é±¼ç½‘ç«™ä¸­åˆ©ç”¨ä½ åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç™»å½•çš„å‡­è¯ï¼ˆå‡­è¯å­˜åœ¨ cookie ä¸­ï¼‰ï¼Œå†’å……ç”¨æˆ·å‘é€æ¶æ„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å› ä¸ºæºå¸¦æœ‰ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œä¼šè¢«æœåŠ¡å™¨å½“åšæ­£å¸¸çš„è¯·æ±‚å¤„ç†ï¼Œä»è€Œä½¿ä½ çš„ä¸ªäººéšç§æ³„éœ²æˆ–è´¢äº§æŸå¤±</p><p><strong>csrf çš„æ”»å‡»è¿‡ç¨‹ï¼š</strong></p><p>1ï¼‰å—å®³è€…ç™»å½• A ç«™ç‚¹ï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆCookieï¼‰</p><p>2ï¼‰æ”»å‡»è€…è¯±å¯¼å—å®³è€…è®¿é—®äº†ç«™ç‚¹ B</p><p>3ï¼‰ç«™ç‚¹ B å‘ç«™ç‚¹ A å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦ç«™ç‚¹ A çš„ Cookie ä¿¡æ¯</p><p>4ï¼‰ç«™ç‚¹ A æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…å‘é€çš„è¯·æ±‚</p><p>5ï¼‰ç«™ç‚¹ A ä»¥å—å®³è€…çš„åä¹‰æ‰§è¡Œäº†ç«™ç‚¹ B çš„è¯·æ±‚ï¼Œæ”»å‡»å®Œæˆï¼Œæ”»å‡»è€…åœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå†’å……å—å®³è€…å®Œæˆäº†æ”»å‡»</p><p><strong>csrf çš„æ”»å‡»çš„å¿…è¦æ¡ä»¶ï¼š</strong></p><p>1ï¼‰ç”¨æˆ·å·²ç™»å½•è¿‡æŸç½‘ç«™ï¼Œå¹¶ä¸”æ²¡æœ‰é€€å‡ºï¼Œç™»å½•ä¿¡æ¯å­˜å‚¨åœ¨ cookie ä¸­ï¼ˆå‘é€è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸Šå¸¦ä¸Šè¦è¯·æ±‚åŸŸåçš„ cookieï¼‰</p><p>2ï¼‰åœ¨ä¸ç™»å‡º A çš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™ B</p><p><strong>CSRF å¦‚ä½•é˜²å¾¡</strong></p><p>1ï¼‰æ ¹æ®æ”»å‡»çš„åŸç†å¯ä»¥çœ‹å‡ºï¼Œcsrf é€šå¸¸æ˜¯è·¨åŸŸè¯·æ±‚ï¼ˆä»é’“é±¼ç½‘ç«™ B å‘é€è¯·æ±‚ç½‘ç«™ A çš„è¯·æ±‚ï¼‰ï¼Œè¯·æ±‚å¤´ä¸Šçš„ Referer æˆ– origin å­—æ®µå¯ä»¥åˆ¤æ–­è¯·æ±‚çš„æ¥æºï¼Œå¦‚æœæœåŠ¡å™¨åˆ¤æ–­è¯·æ±‚çš„åŸŸåä¸åœ¨ç™½åå•ä¸­ï¼Œå°±æ‹’ç»å¯¹åº”çš„è¯·æ±‚</p><p>2ï¼‰æ·»åŠ  token éªŒè¯</p><p>CSRF æ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºç”¨æˆ·éªŒè¯ä¿¡æ¯éƒ½å­˜åœ¨ cookie ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥å®Œå…¨ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ã€‚ä»è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ä¸­æ·»åŠ ç”¨æˆ·çš„ token ç”¨æ¥éªŒè¯ç”¨æˆ·ï¼Œå¦‚æœè¯·æ±‚æ²¡æœ‰æˆ– token ä¸å¯¹ï¼Œå°±æ‹’ç»å¯¹åº”çš„è¯·æ±‚</p><p>3ï¼‰éªŒè¯ç </p><p>å¯¹äºè½¬è´¦æˆ–æ”¯ä»˜çš„ç¯èŠ‚ï¼Œå¼ºåˆ¶ç”¨æˆ·å¿…é¡»ä¸åº”ç”¨è¿›è¡Œäº¤äº’ï¼Œæ‰èƒ½å®Œæˆæœ€ç»ˆè¯·æ±‚</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Ftech.meituan.com%2F2018%2F10%2F11%2Ffe-security-csrf.html" target="_blank" rel="noopener noreferrer">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•é˜²æ­¢ CSRF æ”»å‡»ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F855395f9603b" target="_blank" rel="noopener noreferrer">WEB å®‰å…¨ä¹‹-CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="jsonp-å®‰å…¨é˜²èŒƒ" tabindex="-1"><a class="header-anchor" href="#jsonp-å®‰å…¨é˜²èŒƒ" aria-hidden="true">#</a> jsonp å®‰å…¨é˜²èŒƒ</h3><p>jsonp æ˜¯ä»¥ callback çš„å½¢å¼ï¼Œè¿”å›æœåŠ¡ç«¯çš„æ•°æ® å¦‚<code>http://www.qq.com/getUserInfo?callback=action</code></p><p>1ï¼‰ç™½åå•éªŒè¯</p><p>é€šè¿‡è¯·æ±‚å¤´ä¸Šçš„<code>Refereræˆ–origin</code>å­—æ®µå¯ä»¥åˆ¤æ–­è¯·æ±‚çš„æ¥æºï¼Œå¦‚æœæœåŠ¡å™¨åˆ¤æ–­è¯·æ±‚çš„åŸŸåä¸åœ¨ç™½åå•ä¸­ï¼Œå°±æ‹’ç»å¯¹åº”çš„è¯·æ±‚</p><p>2ï¼‰å¯¹è¿”å›çš„å†…å®¹è¿›è¡ŒéªŒè¯æˆ–è½¬ä¹‰</p><p>æ ¹æ® jsonp çš„åŸç†ï¼Œå½“æ‹¿åˆ° callback çš„å‚æ•°åï¼Œä¼šç›´æ¥å½“ js ä»£ç æ‰§è¡Œï¼Œå¦‚æœ callback åé¢çš„å‚æ•°æ˜¯ script æ ‡ç­¾ï¼Œå°±ä¼šå˜æˆ xss æ”»å‡»äº†ï¼Œæ‰€ä»¥è¦å¯¹è¿”å›çš„å†…å®¹è¿›è¡Œè½¬ä¹‰å¹¶é™åˆ¶é•¿åº¦ï¼Œé˜²èŒƒç±»ä¼¼çš„æ”»å‡»</p><p>ä¾‹å¦‚<code>http://youdomain.com?callback=&lt;script&gt;alert(1)&lt;/script&gt;</code></p><p><a href="https://juejin.cn/post/6844903660678299661" target="_blank" rel="noopener noreferrer">å‰ç«¯ä¹Ÿéœ€è¦äº†è§£çš„ JSONP å®‰å…¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="æµè§ˆå™¨å¦‚ä½•éªŒè¯-ca-è¯ä¹¦çš„æœ‰æ•ˆæ€§" tabindex="-1"><a class="header-anchor" href="#æµè§ˆå™¨å¦‚ä½•éªŒè¯-ca-è¯ä¹¦çš„æœ‰æ•ˆæ€§" aria-hidden="true">#</a> æµè§ˆå™¨å¦‚ä½•éªŒè¯ ca è¯ä¹¦çš„æœ‰æ•ˆæ€§</h3><p>æµè§ˆå™¨è¯»å–è¯ä¹¦ä¸­çš„è¯ä¹¦æ‰€æœ‰è€…ã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯è¿›è¡Œæ ¡éªŒ</p><p>1ï¼‰æ ¡éªŒè¯ä¹¦çš„ç½‘ç«™åŸŸåæ˜¯å¦ä¸è¯ä¹¦é¢å‘çš„åŸŸåä¸€è‡´</p><p>2ï¼‰æ ¡éªŒè¯ä¹¦æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…</p><p>3ï¼‰æµè§ˆå™¨æŸ¥æ‰¾æ“ä½œç³»ç»Ÿä¸­å·²å†…ç½®çš„å—ä¿¡ä»»çš„è¯ä¹¦å‘å¸ƒæœºæ„ï¼Œä¸æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸­çš„é¢å‘è€…åšæ¯”å¯¹ï¼Œç”¨äºæ ¡éªŒè¯ä¹¦æ˜¯å¦ä¸ºåˆæ³•æœºæ„é¢å‘</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.muyiy.cn%2Fquestion%2Fnetwork%2F45.html" target="_blank" rel="noopener noreferrer">HTTPS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="csp-å†…å®¹å®‰å…¨ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#csp-å†…å®¹å®‰å…¨ç­–ç•¥" aria-hidden="true">#</a> csp å†…å®¹å®‰å…¨ç­–ç•¥</h3><p>å†…å®¹å®‰å…¨ç­–ç•¥ CSP (Content Security Policy) ï¼ŒCSP é˜²æ­¢ XSS æ”»å‡»ï¼Œ æµè§ˆå™¨è‡ªåŠ¨ç¦æ­¢å¤–éƒ¨è„šæœ¬æ³¨å…¥</p><p>CSP çš„å®è´¨å°±æ˜¯ç™½åå•åˆ¶åº¦ï¼Œå¼€å‘è€…æ˜ç¡®å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œï¼Œç­‰åŒäºæä¾›ç™½åå•ã€‚å®ƒçš„å®ç°å’Œæ‰§è¡Œå…¨éƒ¨ç”±æµè§ˆå™¨å®Œæˆï¼Œå¼€å‘è€…åªéœ€æä¾›é…ç½®</p><p>CSP å¤§å¤§å¢å¼ºäº†ç½‘é¡µçš„å®‰å…¨æ€§ã€‚æ”»å‡»è€…å³ä½¿å‘ç°äº†æ¼æ´ï¼Œä¹Ÿæ²¡æ³•æ³¨å…¥è„šæœ¬ï¼Œé™¤éè¿˜æ§åˆ¶äº†ä¸€å°åˆ—å…¥äº†ç™½åå•çš„å¯ä¿¡ä¸»æœº</p><p><strong>é…ç½®æ–¹å¼ï¼š</strong></p><p>1ï¼‰é€šè¿‡ HTTP å¤´ä¿¡æ¯çš„<code>Content-Security-Policy</code>çš„å­—æ®µ <code>Content-Security-Policy: script-src &#39;self&#39;; object-src &#39;none&#39;; style-src cdn.example.org third-party.org; child-src https:</code></p><p>2ï¼‰é€šè¿‡ç½‘é¡µçš„æ ‡ç­¾</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code>&lt;meta http-equiv=<span class="token string">&quot;Content-Security-Policy&quot;</span> content=<span class="token string">&quot;script-src &#39;self&#39;; object-src &#39;none&#39;; style-src cdn.example.org third-party.org; child-src https:&quot;</span>&gt;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤ç§é…ç½®æ–¹å¼çš„æ•ˆæœä¸€æ ·</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2016%2F09%2Fcsp.html" target="_blank" rel="noopener noreferrer">Content Security Policy å…¥é—¨æ•™ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FGY3gsWRidT38ll00D0lTGQ" target="_blank" rel="noopener noreferrer">WEB å®‰å…¨ä¹‹å†…å®¹å®‰å…¨ç­–ç•¥(CSP)è¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="æµè§ˆå™¨åŸç†" tabindex="-1"><a class="header-anchor" href="#æµè§ˆå™¨åŸç†" aria-hidden="true">#</a> æµè§ˆå™¨åŸç†</h2><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eff43e716d994b9bbc95c5f43e5d0672~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="æµè§ˆå™¨åŸç†.png"></p><h4 id="js-çš„å•çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#js-çš„å•çº¿ç¨‹" aria-hidden="true">#</a> js çš„å•çº¿ç¨‹</h4><p>js æ˜¯å•çº¿ç¨‹ï¼Œåªæ˜¯è¯´ js çš„æ‰§è¡Œæ˜¯å•çº¿ç¨‹çš„ï¼Œä½† js çš„å®¿ä¸»ç¯å¢ƒï¼Œæ— è®ºæ˜¯ Node è¿˜æ˜¯æµè§ˆå™¨éƒ½æ˜¯å¤šçº¿ç¨‹çš„</p><p>ä»¥ Chrome æµè§ˆå™¨ä¸­ä¸ºä¾‹ï¼Œå½“ä½ æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ¯”å¦‚æ¸²æŸ“çº¿ç¨‹ã€JS å¼•æ“çº¿ç¨‹ã€HTTP è¯·æ±‚çº¿ç¨‹ç­‰ç­‰ã€‚ å½“ä½ å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“è¯·æ±‚ç»“æŸåï¼Œè¯¥çº¿ç¨‹å¯èƒ½å°±ä¼šè¢«é”€æ¯ã€‚</p><p><strong>JS ä¸ºä»€ä¹ˆè®¾è®¡æˆå•çº¿ç¨‹ï¼Ÿ</strong></p><p>å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸ª DOM èŠ‚ç‚¹ä¸Šæ·»åŠ å†…å®¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ é™¤äº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¼šæœ‰å¾ˆå¤§å†²çªï¼Œä¸ºäº†é¿å…è¿™ä¸ªå†²çªï¼Œæ‰€ä»¥å†³å®šäº†å®ƒåªèƒ½æ˜¯å•çº¿ç¨‹</p><h4 id="çº¿ç¨‹ä¸è¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹ä¸è¿›ç¨‹" aria-hidden="true">#</a> çº¿ç¨‹ä¸è¿›ç¨‹</h4><p>ä¸€å¥è¯ï¼šè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹</p><p>è¿›ç¨‹æ˜¯ CPU èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼›çº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„æœ€å°å•ä½</p><p><strong>æµè§ˆå™¨è¿›ç¨‹åŒ…æ‹¬ï¼š</strong></p><p>1ï¼‰<code>æµè§ˆå™¨ä¸»è¿›ç¨‹ï¼ˆBrowserè¿›ç¨‹ï¼‰</code></p><p>ä¸»è¦è´Ÿè´£ç•Œé¢æ˜¾ç¤ºã€ç”¨æˆ·äº¤äº’ã€å­è¿›ç¨‹ç®¡ç†ï¼ŒåŒæ—¶æä¾›å­˜å‚¨ç­‰åŠŸèƒ½ã€‚</p><p>2ï¼‰<code>æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹ï¼ˆRendererè¿›ç¨‹ï¼‰</code></p><p>æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹ï¼šå³é€šå¸¸æ‰€è¯´çš„<code>æµè§ˆå™¨å†…æ ¸</code></p><p>æ ¸å¿ƒä»»åŠ¡æ˜¯å°† HTMLã€CSS å’Œ JavaScript è½¬æ¢ä¸ºç”¨æˆ·å¯ä»¥ä¸ä¹‹äº¤äº’çš„ç½‘é¡µï¼Œæ’ç‰ˆå¼•æ“ Blink å’Œ JavaScript å¼•æ“ V8 éƒ½æ˜¯è¿è¡Œåœ¨è¯¥è¿›ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒChrome ä¼šä¸ºæ¯ä¸ª Tab æ ‡ç­¾åˆ›å»ºä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ¸²æŸ“è¿›ç¨‹éƒ½æ˜¯è¿è¡Œåœ¨æ²™ç®±æ¨¡å¼ä¸‹</p><p>3ï¼‰<code>GPU è¿›ç¨‹</code></p><p>GPU çš„ä½¿ç”¨åˆè¡·æ˜¯ä¸ºäº†å®ç° 3D CSS çš„æ•ˆæœï¼Œåªæ˜¯éšåç½‘é¡µã€Chrome çš„ UI ç•Œé¢éƒ½é€‰æ‹©é‡‡ç”¨ GPU æ¥ç»˜åˆ¶</p><p>4ï¼‰<code>ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹</code></p><p>ä¸»è¦æ˜¯è´Ÿè´£æ’ä»¶çš„è¿è¡Œï¼Œå› æ’ä»¶æ˜“å´©æºƒï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡æ’ä»¶è¿›ç¨‹æ¥éš”ç¦»ï¼Œæ¯ç§ç±»å‹çš„æ’ä»¶å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œ ä»¥ä¿è¯æ’ä»¶è¿›ç¨‹å´©æºƒä¸ä¼šå¯¹æµè§ˆå™¨å’Œé¡µé¢é€ æˆå½±å“ã€‚</p><p><strong>æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹ï¼ˆRenderer è¿›ç¨‹ï¼‰åŒ…å« 5 ç§çº¿ç¨‹ï¼š</strong></p><p>1ï¼‰GUI æ¸²æŸ“çº¿ç¨‹</p><p>ä¸»è¦è´Ÿè´£é¡µé¢çš„æ¸²æŸ“ï¼Œè§£æ HTMLã€CSSï¼Œæ„å»º DOM æ ‘ï¼Œå¸ƒå±€å’Œç»˜åˆ¶ç­‰</p><p>2ï¼‰JS å¼•æ“çº¿ç¨‹</p><p>è¯¥çº¿ç¨‹ä¸»è¦è´Ÿè´£å¤„ç† JavaScript è„šæœ¬ï¼Œæ‰§è¡Œä»£ç ã€‚è¯¥çº¿ç¨‹ä¸ GUI æ¸²æŸ“çº¿ç¨‹äº’æ–¥ï¼Œå½“ JS å¼•æ“çº¿ç¨‹æ‰§è¡Œ JavaScript è„šæœ¬æ—¶é—´è¿‡é•¿ï¼Œå°†å¯¼è‡´é¡µé¢æ¸²æŸ“çš„é˜»å¡ã€‚</p><p>3ï¼‰äº‹ä»¶è§¦å‘çº¿ç¨‹</p><p>ä¸»è¦è´Ÿè´£å°†å‡†å¤‡å¥½çš„äº‹ä»¶äº¤ç»™ JS å¼•æ“çº¿ç¨‹æ‰§è¡Œã€‚æ¯”å¦‚ setTimeout å®šæ—¶å™¨è®¡æ•°ç»“æŸï¼Œ ajax ç­‰å¼‚æ­¥è¯·æ±‚æˆåŠŸå¹¶è§¦å‘å›è°ƒå‡½æ•°ï¼Œæˆ–è€…ç”¨æˆ·è§¦å‘ç‚¹å‡»äº‹ä»¶æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šå°†æ•´è£…å¾…å‘çš„äº‹ä»¶ä¾æ¬¡åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾… JS å¼•æ“çº¿ç¨‹çš„æ‰§è¡Œ</p><p>4ï¼‰å®šæ—¶å™¨è§¦å‘çº¿ç¨‹</p><p>è´Ÿè´£æ‰§è¡Œå¼‚æ­¥å®šæ—¶å™¨ä¸€ç±»çš„å‡½æ•°çš„çº¿ç¨‹ï¼Œå¦‚ï¼š setTimeoutï¼ŒsetInterval</p><p>5ï¼‰å¼‚æ­¥ http è¯·æ±‚çº¿ç¨‹</p><p>è´Ÿè´£æ‰§è¡Œå¼‚æ­¥è¯·æ±‚ä¸€ç±»çš„å‡½æ•°çš„çº¿ç¨‹ï¼Œå¦‚ï¼š Promiseï¼Œaxiosï¼Œajax ç­‰</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fc1808d0c1d45" target="_blank" rel="noopener noreferrer">æµè§ˆå™¨çš„çº¿ç¨‹å’Œè¿›ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6844903962216824839" target="_blank" rel="noopener noreferrer">æµè§ˆå™¨ç›¸å…³åŸç†(é¢è¯•é¢˜)è¯¦ç»†æ€»ç»“ä¸€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F54882306" target="_blank" rel="noopener noreferrer">æµè§ˆå™¨ä¸ Node çš„äº‹ä»¶å¾ªç¯(Event Loop)æœ‰ä½•åŒºåˆ«?<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="æµè§ˆå™¨é¡µé¢æ¸²æŸ“æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#æµè§ˆå™¨é¡µé¢æ¸²æŸ“æœºåˆ¶" aria-hidden="true">#</a> æµè§ˆå™¨é¡µé¢æ¸²æŸ“æœºåˆ¶</h4><p><strong>æµè§ˆå™¨æœ‰ GUI æ¸²æŸ“çº¿ç¨‹ä¸ JS å¼•æ“çº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹æ˜¯äº’æ–¥çš„å…³ç³»</strong></p><p>JavaScript çš„åŠ è½½ã€è§£æä¸æ‰§è¡Œä¼šé˜»å¡ DOM çš„æ„å»ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ„å»º DOM æ—¶ï¼ŒHTML è§£æå™¨è‹¥é‡åˆ°äº† JavaScriptï¼Œé‚£ä¹ˆå®ƒä¼šæš‚åœæ„å»º DOMï¼Œå°†æ§åˆ¶æƒç§»äº¤ç»™ JavaScript å¼•æ“ï¼Œç­‰ JavaScript å¼•æ“è¿è¡Œå®Œæ¯•ï¼Œæµè§ˆå™¨å†ä»ä¸­æ–­çš„åœ°æ–¹æ¢å¤ DOM æ„å»º</p><p>ä½†æ˜¯å¦‚æœé‡åˆ°å¸¦æœ‰ async å’Œ defer çš„ script æ ‡ç­¾ï¼Œå°±ä¼šå¼‚æ­¥è¯·æ±‚è¿™äº›èµ„æºï¼Œä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“</p><p>æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹åˆ†ä¸ºï¼šæ„å»º DOM -&gt; æ„å»º CSSOM -&gt; æ„å»ºæ¸²æŸ“æ ‘ -&gt; layout å¸ƒå±€ -&gt; ç»˜åˆ¶</p><h4 id="script-æ ‡ç­¾-async-defer-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#script-æ ‡ç­¾-async-defer-çš„åŒºåˆ«" aria-hidden="true">#</a> script æ ‡ç­¾ async defer çš„åŒºåˆ«</h4><p>ç›´æ¥ä½¿ç”¨ script ä¼šé˜»å¡ DOM æ¸²æŸ“ï¼Œåœ¨è„šæœ¬åŠ è½½&amp;æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šé˜»å¡åç»­çš„ DOM æ¸²æŸ“</p><p>ä½¿ç”¨ async å’Œ deferï¼Œè¿™ä¸¤ä¸ªå±æ€§ä½¿å¾— script éƒ½ä¸ä¼šé˜»å¡ DOM çš„æ¸²æŸ“</p><p><strong>async å’Œ defer çš„åŒºåˆ«</strong>ï¼š</p><p>async æ˜¯æ— é¡ºåºçš„åŠ è½½ï¼Œè€Œ defer æ˜¯æœ‰é¡ºåºçš„åŠ è½½</p><p>1ï¼‰æ‰§è¡Œé¡ºåºçš„åŒºåˆ«</p><p>async çš„æ‰§è¡Œï¼Œå¹¶ä¸ä¼šæŒ‰ç…§ script åœ¨é¡µé¢ä¸­çš„é¡ºåºæ¥æ‰§è¡Œï¼Œè€Œæ˜¯è°å…ˆåŠ è½½å®Œè°æ‰§è¡Œ</p><p>defer çš„æ‰§è¡Œï¼Œåˆ™ä¼šæŒ‰ç…§å¼•å…¥çš„é¡ºåºæ‰§è¡Œï¼Œå³ä¾¿æ˜¯åé¢çš„ script èµ„æºå…ˆè¿”å›</p><p>2ï¼‰å¯¹ window.onload çš„å½±å“</p><p>ä½¿ç”¨ defer çš„ script æ ‡ç­¾ï¼Œä¼šåœ¨ window.onload äº‹ä»¶ä¹‹å‰è¢«æ‰§è¡Œ</p><p>ä½¿ç”¨ async çš„ script æ ‡ç­¾ï¼Œå¯¹ window.onload äº‹ä»¶æ²¡æœ‰å½±å“ï¼Œwindow.onload å¯ä»¥åœ¨ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œ</p><p><strong>ä½¿ç”¨åœºæ™¯çš„åŒºåˆ«</strong></p><p>1ï¼‰defer å¯ä»¥ç”¨æ¥æ§åˆ¶ js æ–‡ä»¶çš„åŠ è½½é¡ºåº</p><p>æ¯”å¦‚ jq å’Œ Bootstrapï¼Œå› ä¸º Bootstrap ä¸­çš„ js æ’ä»¶ä¾èµ–äº jqeryï¼Œæ‰€ä»¥å¿…é¡»å…ˆå¼•å…¥ jQueryï¼Œå†å¼•å…¥ Bootstrap js æ–‡ä»¶</p><p>2ï¼‰å¦‚æœä½ çš„è„šæœ¬å¹¶ä¸å…³å¿ƒé¡µé¢ä¸­çš„ DOM å…ƒç´ ï¼ˆæ–‡æ¡£æ˜¯å¦è§£æå®Œæ¯•ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šäº§ç”Ÿå…¶ä»–è„šæœ¬éœ€è¦çš„æ•°æ®ï¼Œä½¿ç”¨ asyncï¼Œ å¦‚ç»Ÿè®¡ã€åŸ‹ç‚¹ç­‰åŠŸèƒ½</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fjiasm%2Fp%2F7683930.html" target="_blank" rel="noopener noreferrer">æµ…è°ˆ script æ ‡ç­¾ä¸­çš„ async å’Œ defer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="dom-äº‹ä»¶æµ" tabindex="-1"><a class="header-anchor" href="#dom-äº‹ä»¶æµ" aria-hidden="true">#</a> DOM äº‹ä»¶æµ</h4><p>DOM äº‹ä»¶æµï¼šäº‹ä»¶æµç®€å•æ¥è¯´å°±æ˜¯äº‹ä»¶æ‰§è¡Œé¡ºåº</p><p>DOM åŒæ—¶æ”¯æŒä¸¤ç§äº‹ä»¶æ¨¡å‹ï¼šæ•è·å‹äº‹ä»¶æµå’Œå†’æ³¡å‹äº‹ä»¶æµ</p><p>DOM2 äº‹ä»¶æµçš„ä¸‰ä¸ªé˜¶æ®µï¼š</p><p>1ï¼‰äº‹ä»¶æ•è·é˜¶æ®µ 2ï¼‰å¤„äºç›®æ ‡é˜¶æ®µ 3ï¼‰äº‹ä»¶å†’æ³¡é˜¶æ®µ</p><p>DOM äº‹ä»¶æ•è·çš„å…·ä½“æµç¨‹ï¼š</p><p>windowâ¡ï¸documentâ¡ï¸htmlâ¡ï¸bodyâ¡ï¸ ç›®æ ‡å…ƒç´ ï¼› äº‹ä»¶å†’æ³¡ï¼šå°±æ˜¯è¿™ä¸ªé¡ºåºåè¿‡æ¥</p><p><strong>è¿ç”¨ï¼š</strong> <strong>äº‹ä»¶å§”æ‰˜</strong>ï¼Œåˆ©ç”¨äº‹ä»¶å†’æ³¡åŸç†</p><p>äº‹ä»¶å§”æ‰˜ï¼šå½“ä¸€ç»„å…ƒç´ è¦æ·»åŠ ç›¸åŒçš„äº‹ä»¶æ—¶ï¼Œå¯ä»¥åœ¨çˆ¶å…ƒç´ ä¸Šç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œåˆ©ç”¨äº‹ä»¶å†’æ³¡åŸç†ï¼Œè¾¾åˆ°çˆ¶å…ƒç´ ä»£ç†å­å…ƒç´ äº‹ä»¶ï¼Œç‚¹å‡»å­å…ƒç´ ï¼Œé€šè¿‡ e.target || e.srcElement å¯ä»¥è·å–ç‚¹å‡»çš„å…·ä½“å­å…ƒç´ </p><p><strong>æ—¶é—´å§”æ‰˜çš„ä¼˜ç‚¹</strong>ï¼š</p><p>å¯ä»¥å‡å°‘äº‹ä»¶çš„æ³¨å†Œï¼ŒèŠ‚çœå†…å­˜ï¼Œä¹Ÿå¯ä»¥å®ç°å½“æ–°å¢å¯¹è±¡æ—¶æ— éœ€å†æ¬¡å¯¹å…¶ç»‘å®šäº‹ä»¶</p><p><strong>addEventListener çš„ç¬¬ä¸‰ä¸ªå‚æ•°</strong></p><p>ç¬¬ä¸‰ä¸ªå‚æ•°é»˜è®¤æ˜¯ falseï¼Œè¡¨ç¤ºåœ¨äº‹ä»¶å†’æ³¡é˜¶æ®µè°ƒç”¨ï¼›å½“è¯¥å€¼ä¸º true è¡¨ç¤ºåœ¨äº‹ä»¶æ•è·é˜¶æ®µè°ƒç”¨ã€‚</p><p>éªŒè¯æ•´ä¸ªäº‹ä»¶æµæ‰§è¡Œé¡ºåºï¼ˆå…ˆæ•è·å†å†’æ³¡ï¼‰</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// é¼ æ ‡ç‚¹å‡»å­å…ƒç´ åï¼Œæ‰“å°é¡ºåºä¸º</span>
<span class="token comment">// çˆ¶æ•è·</span>
<span class="token comment">// å­æ•è·</span>
<span class="token comment">// å­å†’æ³¡</span>
<span class="token comment">// çˆ¶å†’æ³¡</span>

<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;parent&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;child&quot;</span><span class="token operator">&gt;</span>å­å…ƒç´ <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
     <span class="token keyword">let</span> parentDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.parent&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     parentDom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;çˆ¶æ•è·&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
     parentDom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;çˆ¶å†’æ³¡&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

     <span class="token keyword">let</span> childDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.child&#39;</span><span class="token punctuation">)</span>
     childDom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å­æ•è·&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
     childDom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å­å†’æ³¡&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æµè§ˆå™¨ç©ºé—²æ—¶é—´" tabindex="-1"><a class="header-anchor" href="#æµè§ˆå™¨ç©ºé—²æ—¶é—´" aria-hidden="true">#</a> æµè§ˆå™¨ç©ºé—²æ—¶é—´</h4><p>é¡µé¢æ˜¯ä¸€å¸§ä¸€å¸§ç»˜åˆ¶å‡ºæ¥çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè®¾å¤‡çš„å±å¹•åˆ·æ–°ç‡ä¸º 1s 60 æ¬¡ï¼Œè€Œå½“ FPS å°äº 60 æ—¶ï¼Œä¼šå‡ºç°ä¸€å®šç¨‹åº¦çš„å¡é¡¿ç°è±¡</p><p><strong>ä¸‹é¢æ¥çœ‹å®Œæ•´çš„ä¸€å¸§ä¸­ï¼Œå…·ä½“åšäº†å“ªäº›äº‹æƒ…:</strong></p><p>1ï¼‰é¦–å…ˆéœ€è¦å¤„ç†è¾“å…¥äº‹ä»¶ï¼Œèƒ½å¤Ÿè®©ç”¨æˆ·å¾—åˆ°æœ€æ—©çš„åé¦ˆ</p><p>2ï¼‰æ¥ä¸‹æ¥æ˜¯å¤„ç†å®šæ—¶å™¨ï¼Œéœ€è¦æ£€æŸ¥å®šæ—¶å™¨æ˜¯å¦åˆ°æ—¶é—´ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å›è°ƒ</p><p>3ï¼‰æ¥ä¸‹æ¥å¤„ç† Begin Frameï¼ˆå¼€å§‹å¸§ï¼‰ï¼Œå³æ¯ä¸€å¸§çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬ window.resizeã€scrollã€media query change ç­‰</p><p>4ï¼‰æ¥ä¸‹æ¥æ‰§è¡Œè¯·æ±‚åŠ¨ç”»å¸§ requestAnimationFrameï¼ˆrAFï¼‰ï¼Œå³åœ¨æ¯æ¬¡ç»˜åˆ¶ä¹‹å‰ï¼Œä¼šæ‰§è¡Œ rAF å›è°ƒ</p><p>5ï¼‰ç´§æ¥ç€è¿›è¡Œ Layout æ“ä½œï¼ŒåŒ…æ‹¬è®¡ç®—å¸ƒå±€å’Œæ›´æ–°å¸ƒå±€ï¼Œå³è¿™ä¸ªå…ƒç´ çš„æ ·å¼æ˜¯æ€æ ·çš„ï¼Œå®ƒåº”è¯¥åœ¨é¡µé¢å¦‚ä½•å±•ç¤º</p><p>6ï¼‰æ¥ç€è¿›è¡Œ Paint æ“ä½œï¼Œå¾—åˆ°æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å°ºå¯¸ä¸ä½ç½®ç­‰ä¿¡æ¯ï¼Œæµè§ˆå™¨é’ˆå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå†…å®¹å¡«å……</p><p>7ï¼‰åˆ°è¿™æ—¶ä»¥ä¸Šçš„å…­ä¸ªé˜¶æ®µéƒ½å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å¤„äºç©ºé—²é˜¶æ®µï¼ˆIdle Peroidï¼‰</p><p><strong>requestIdleCallback</strong></p><p>åœ¨ç©ºé—²é˜¶æ®µï¼ˆIdle Peroidï¼‰æ—¶ï¼Œå¯ä»¥æ‰§è¡Œ requestIdleCallback é‡Œæ³¨å†Œçš„ä»»åŠ¡</p><p>requestIdleCallback æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š <code>window.requestIdleCallback(callback, { timeout: 1000 }</code>)</p><p>1ï¼‰ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å…¥å‚ï¼Œå¯ä»¥è·å–å½“å‰å¸§çš„å‰©ä½™æ—¶é—´ï¼Œä»¥åŠè¯¥ä»»åŠ¡æ˜¯å¦è¶…æ—¶</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">window.requestIdleCallback(deadline</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; {</span>
  // è¿”å›å½“å‰å¸§è¿˜å‰©å¤šå°‘æ—¶é—´ä¾›ç”¨æˆ·ä½¿ç”¨
  deadline.timeRamining;
  // è¿”å› callback ä»»åŠ¡æ˜¯å¦è¶…æ—¶
  deadline.didTimeout;
});

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ï¼‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ å…¥ timeout å‚æ•°è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåˆ°äº†è¶…æ—¶æ—¶é—´ï¼Œæµè§ˆå™¨å¿…é¡»ç«‹å³æ‰§è¡Œ</p><p>ä¾‹å­ï¼šæ‰“å°æ­¤å¸§çš„å‰©ä½™æ—¶é—´</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code>// è¯¥å‡½æ•°çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡1s
function calc() {
  <span class="token key attr-name">let start</span> <span class="token punctuation">=</span> <span class="token value attr-value">performance.now();</span>
  <span class="token key attr-name">let sum</span> <span class="token punctuation">=</span> <span class="token value attr-value">0;</span>
  <span class="token key attr-name">for (let i</span> <span class="token punctuation">=</span> <span class="token value attr-value">0; i &lt; 10000; i++) {</span>
    <span class="token key attr-name">for (let i</span> <span class="token punctuation">=</span> <span class="token value attr-value">0; i &lt; 10000; i++) {</span>
      <span class="token key attr-name">sum +</span><span class="token punctuation">=</span> <span class="token value attr-value">Math.random();</span>
    }
  }
  <span class="token key attr-name">let end</span> <span class="token punctuation">=</span> <span class="token value attr-value">performance.now();</span>
  <span class="token key attr-name">let totolTime</span> <span class="token punctuation">=</span> <span class="token value attr-value">end - start;</span>
  // å¾—åˆ°è¯¥å‡½æ•°çš„è®¡ç®—ç”¨æ—¶
  console.log(totolTime, &quot;totolTime&quot;);
}

<span class="token key attr-name">let tasks</span> <span class="token punctuation">=</span> <span class="token value attr-value">[</span>
  <span class="token key attr-name">()</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; {</span>
    calc();
    console.log(1);
  },
  <span class="token key attr-name">()</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; {</span>
    calc();
    console.log(2);
  },
  <span class="token key attr-name">()</span> <span class="token punctuation">=</span><span class="token value attr-value">&gt; {</span>
    console.log(3);
  }
];

<span class="token key attr-name">let work</span> <span class="token punctuation">=</span> <span class="token value attr-value">deadline =&gt; {</span>
  console.log(`æ­¤å¸§çš„å‰©ä½™æ—¶é—´ä¸º: ${deadline.timeRemaining()}`);

  // å¦‚æœæ­¤å¸§å‰©ä½™æ—¶é—´å¤§äº0æˆ–è€…å·²ç»åˆ°äº†å®šä¹‰çš„è¶…æ—¶æ—¶é—´ï¼ˆä¸Šæ–‡å®šä¹‰äº†timeoutæ—¶é—´ä¸º1000ï¼Œåˆ°è¾¾æ—¶é—´æ—¶å¿…é¡»å¼ºåˆ¶æ‰§è¡Œï¼‰ï¼Œä¸”å½“æ—¶å­˜åœ¨ä»»åŠ¡ï¼Œåˆ™ç›´æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡
  // å¦‚æœæ²¡æœ‰å‰©ä½™æ—¶é—´ï¼Œåˆ™åº”è¯¥æ”¾å¼ƒæ‰§è¡Œä»»åŠ¡æ§åˆ¶æƒï¼ŒæŠŠæ‰§è¡Œæƒäº¤è¿˜ç»™æµè§ˆå™¨
  while (
    (deadline.timeRemaining() &gt; 0 || deadline.didTimeout) &amp;&amp;
    tasks.length &gt; 0
  ) {
    <span class="token key attr-name">let fn</span> <span class="token punctuation">=</span> <span class="token value attr-value">tasks.shift();</span>
    fn();
  }
  // å¦‚æœè¿˜æœ‰æœªå®Œæˆçš„ä»»åŠ¡ï¼Œç»§ç»­è°ƒç”¨requestIdleCallbackç”³è¯·ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡
  if (tasks.length &gt; 0) {
    window.requestIdleCallback(work, { timeout: 500 });
  }
};
window.requestIdleCallback(work, { timeout: 500 });

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œç»“æœï¼šåˆ† 3 å¸§è¿›è¡Œè®¡ç®—</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f28583ec06034c3ea2118b3c17a4e391~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="requestIdcallback.jpg"></p><p><a href="https://juejin.cn/post/6943896410987659277#heading-6" target="_blank" rel="noopener noreferrer">èµ°è¿› React Fiber çš„ä¸–ç•Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="æµè§ˆå™¨ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#æµè§ˆå™¨ç¼“å­˜" aria-hidden="true">#</a> æµè§ˆå™¨ç¼“å­˜</h4><p>åˆ†ä¸ºåå•†ç¼“å­˜å’Œå¼ºåˆ¶ç¼“å­˜</p><h5 id="åå•†ç¼“å­˜çš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#åå•†ç¼“å­˜çš„æµç¨‹" aria-hidden="true">#</a> åå•†ç¼“å­˜çš„æµç¨‹</h5><p>1ï¼‰<strong>ç¬¬ä¸€æ¬¡è¯·æ±‚</strong></p><p>1ã€å®¢æˆ·ç«¯å‘é€ GET è¯·æ±‚ï¼Œå»è¯·æ±‚æ–‡ä»¶ï¼› 2ã€æœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œè¿”å›æ–‡ä»¶å†…å®¹å’Œä¸€å † Headerï¼ŒåŒ…æ‹¬ Etagï¼ŒçŠ¶æ€ç  200</p><p>2ï¼‰<strong>ç¬¬äºŒæ¬¡è¯·æ±‚</strong></p><p>1ã€å®¢æˆ·ç«¯å‘èµ· HTTP GET è¯·æ±‚ä¸€ä¸ªæ–‡ä»¶ï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸Šï¼Œä¼šå¸¦ä¸Š<code>if-none-matchå€¼ä¸ºEtag</code>å’Œ<code>if-modified-sinceå€¼ä¸ºlast-modified</code></p><p>2ã€æœåŠ¡å™¨ä¼˜å…ˆåˆ¤æ–­ Etag å’Œè®¡ç®—å‡ºæ¥çš„ Etag åŒ¹é…ï¼Œè‹¥åŒ¹é… status çŠ¶æ€ä¸º<code>304</code>ï¼Œå®¢æˆ·ç«¯ç»§ç»­ä½¿ç”¨æœ¬åœ°ç¼“å­˜</p><h5 id="etag" tabindex="-1"><a class="header-anchor" href="#etag" aria-hidden="true">#</a> Etag</h5><p>Etag æ˜¯æœåŠ¡å™¨æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œå½“æ–‡ä»¶å†…å®¹å˜åŒ–æ—¶ Etag å€¼ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</p><p>Etag ä¸»è¦ä¸ºäº†è§£å†³ Last-Modified æ— æ³•è§£å†³çš„ä¸€äº›é—®é¢˜ã€‚ä¸€äº›æ–‡ä»¶ä¹Ÿè®¸ä¼šå‘¨æœŸæ€§çš„æ›´æ”¹ï¼Œä½†æ˜¯å®ƒçš„å†…å®¹å¹¶ä¸æ”¹å˜(ä»…ä»…æ”¹å˜çš„ä¿®æ”¹æ—¶é—´)ï¼Œæ­¤æ—¶å¸Œæœ›é‡ç”¨ç¼“å­˜ï¼Œè€Œä¸æ˜¯é‡æ–°è¯·æ±‚</p><h5 id="etag-æ¯”-last-modified-å“ªä¸ªä¼˜å…ˆçº§æ›´é«˜" tabindex="-1"><a class="header-anchor" href="#etag-æ¯”-last-modified-å“ªä¸ªä¼˜å…ˆçº§æ›´é«˜" aria-hidden="true">#</a> Etag æ¯” last-modified å“ªä¸ªä¼˜å…ˆçº§æ›´é«˜ï¼Ÿ</h5><p>å½“ ETag å’Œ Last-Modified åŒæ—¶å­˜åœ¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼˜å…ˆæ£€æŸ¥ ETag</p><h5 id="å¼ºç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#å¼ºç¼“å­˜" aria-hidden="true">#</a> å¼ºç¼“å­˜</h5><p>å¼ºç¼“å­˜æ˜¯åˆ©ç”¨ http å¤´ä¸­çš„ <code>Expires</code> å’Œ <code>Cache-Control</code> ä¸¤ä¸ªå­—æ®µæ¥æ§åˆ¶çš„</p><p><strong>å½“åŒæ—¶å­˜åœ¨ Expires å’Œ Cache-Controlï¼šmax-age æ—¶ å“ªä¸ªä¼˜å…ˆçº§é«˜ï¼Ÿ</strong></p><p>Cache-Controlï¼šmax-age ä¼˜å…ˆçº§é«˜ï¼ŒCache-Controlï¼šmax-age è¡¨ç¤ºç¼“å­˜å†…å®¹åœ¨ xxx ç§’åå¤±æ•ˆï¼›Expires è¡¨ç¤ºæœåŠ¡ç«¯è¿”å›çš„åˆ°æœŸæ—¶é—´</p><p>Expires ç¼ºç‚¹ï¼šè¿”å›çš„æ˜¯æœåŠ¡ç«¯æ—¶é—´ï¼Œä¸å®¢æˆ·ç«¯æ—¶é—´ç›¸æ¯”ï¼Œå¯èƒ½ä¼šå‡ºç°æ—¶é—´ä¸ä¸€è‡´</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Ftiwlin%2Farchive%2F2011%2F06%2F10%2F2077193.html" target="_blank" rel="noopener noreferrer">Etag è¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_43912756%2Farticle%2Fdetails%2F108481083" target="_blank" rel="noopener noreferrer">ä¸ºä»€ä¹ˆ Etag æ¯” last-modified ä¼˜å…ˆçº§æ›´é«˜ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="cache-control-no-cache-å’Œ-no-store-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#cache-control-no-cache-å’Œ-no-store-çš„åŒºåˆ«" aria-hidden="true">#</a> Cache-Control: no-cache å’Œ no-store çš„åŒºåˆ«</h4><p><code>Cache-Control: no-cache</code>ï¼šè¿™ä¸ªå¾ˆå®¹æ˜“è®©äººäº§ç”Ÿè¯¯è§£ï¼Œä½¿äººè¯¯ä»¥ä¸ºæ˜¯å“åº”ä¸è¢«ç¼“å­˜</p><p>å®é™…ä¸Š<code>Cache-Control: no-cache</code>æ˜¯ä¼šè¢«ç¼“å­˜çš„ï¼Œåªä¸è¿‡æµè§ˆå™¨æ¯æ¬¡éƒ½ä¼šå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œæ¥éªŒè¯å½“å‰ç¼“å­˜çš„æœ‰æ•ˆæ€§</p><p><code>Cache-Control: no-store</code>ï¼šè¿™ä¸ªæ‰æ˜¯å“åº”ä¸è¢«ç¼“å­˜çš„æ„æ€</p><h4 id="åƒåœ¾å›æ”¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶æœºåˆ¶" aria-hidden="true">#</a> åƒåœ¾å›æ”¶æœºåˆ¶</h4><h5 id="gc-åƒåœ¾å›æ”¶ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#gc-åƒåœ¾å›æ”¶ç­–ç•¥" aria-hidden="true">#</a> GC åƒåœ¾å›æ”¶ç­–ç•¥</h5><p>1ï¼‰æ ‡è®°æ¸…é™¤</p><p>åˆ†ä¸º <code>æ ‡è®°</code> å’Œ <code>æ¸…é™¤</code> ä¸¤ä¸ªé˜¶æ®µï¼Œæ ‡è®°é˜¶æ®µå³ä¸ºæ‰€æœ‰æ´»åŠ¨å¯¹è±¡åšä¸Šæ ‡è®°ï¼Œæ¸…é™¤é˜¶æ®µåˆ™æŠŠæ²¡æœ‰æ ‡è®°ï¼ˆä¹Ÿå°±æ˜¯éæ´»åŠ¨å¯¹è±¡ï¼‰é”€æ¯</p><p>åœ¨è¿è¡Œæ—¶ä¼šç»™å†…å­˜ä¸­çš„æ‰€æœ‰å˜é‡éƒ½åŠ ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œå‡è®¾å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åƒåœ¾ï¼Œå…¨æ ‡è®°ä¸º 0</p><p>ç„¶åä»å„ä¸ªæ ¹å¯¹è±¡å¼€å§‹éå†ï¼ŒæŠŠä¸æ˜¯åƒåœ¾çš„èŠ‚ç‚¹æ”¹æˆ 1ï¼Œæ¸…ç†æ‰€æœ‰æ ‡è®°ä¸º 0 çš„åƒåœ¾ï¼Œé”€æ¯å¹¶å›æ”¶å®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚æœ€åï¼ŒæŠŠæ‰€æœ‰å†…å­˜ä¸­å¯¹è±¡æ ‡è®°ä¿®æ”¹ä¸º 0ï¼Œç­‰å¾…ä¸‹ä¸€è½®åƒåœ¾å›æ”¶</p><p>2ï¼‰å¼•ç”¨è®¡æ•°</p><p>ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–å¯¹è±¡å¼•ç”¨åˆ°å®ƒï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯<code>é›¶å¼•ç”¨</code>ï¼Œå°†è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶</p><p>å®ƒçš„ç­–ç•¥æ˜¯è·Ÿè¸ªè®°å½•æ¯ä¸ªå˜é‡å€¼è¢«ä½¿ç”¨çš„æ¬¡æ•°</p><p>ä¸€ä¸ªå¯¹è±¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°å°±ä¸º 1ï¼Œå¦‚æœåŒä¸€ä¸ªå€¼åˆè¢«èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆå¼•ç”¨æ•°åŠ  1ï¼Œå¦‚æœè¯¥å˜é‡çš„å€¼è¢«å…¶ä»–çš„å€¼è¦†ç›–äº†ï¼Œåˆ™å¼•ç”¨æ¬¡æ•°å‡ 1</p><p>å½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å˜ä¸º 0 çš„æ—¶å€™ï¼Œè¯´æ˜æ²¡æœ‰å˜é‡åœ¨ä½¿ç”¨ï¼Œè¿™ä¸ªå€¼æ²¡æ³•è¢«è®¿é—®äº†ï¼Œå›æ”¶ç©ºé—´ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šåœ¨è¿è¡Œçš„æ—¶å€™æ¸…ç†æ‰å¼•ç”¨æ¬¡æ•°ä¸º 0 çš„å€¼å ç”¨çš„å†…å­˜</p><h5 id="åˆ†ä»£å¼åƒåœ¾å›æ”¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#åˆ†ä»£å¼åƒåœ¾å›æ”¶æœºåˆ¶" aria-hidden="true">#</a> åˆ†ä»£å¼åƒåœ¾å›æ”¶æœºåˆ¶</h5><p>V8 é‡‡ç”¨äº†ä¸€ç§ä»£å›æ”¶çš„ç­–ç•¥ï¼Œå°†å†…å­˜åˆ†ä¸ºä¸¤ä¸ªç”Ÿä»£ï¼šæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£</p><p><strong>æ–°ç”Ÿä»£</strong>ä¸­çš„å¯¹è±¡ä¸ºå­˜æ´»æ—¶é—´è¾ƒçŸ­çš„å¯¹è±¡ï¼Œ<strong>è€ç”Ÿä»£</strong>ä¸­çš„å¯¹è±¡ä¸ºå­˜æ´»æ—¶é—´è¾ƒé•¿æˆ–å¸¸é©»å†…å­˜çš„å¯¹è±¡</p><h5 id="å†…å­˜å›æ”¶çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å†…å­˜å›æ”¶çš„ä¾‹å­" aria-hidden="true">#</a> å†…å­˜å›æ”¶çš„ä¾‹å­</h5><p>å‡è®¾ä»£ç ä¸­æœ‰ä¸€ä¸ªå¯¹è±¡ jerry ï¼Œè¿™ä¸ªå¯¹è±¡ä»åˆ›å»ºåˆ°è¢«é”€æ¯ï¼Œåˆšå¥½èµ°å®Œäº†æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œé€šå¸¸ä¼šæ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹</p><p>1ï¼‰è¿™ä¸ªå¯¹è±¡è¢«åˆ†é…åˆ°äº†æ–°ç”Ÿä»£ï¼›éšç€ç¨‹åºçš„è¿è¡Œï¼Œæ–°ç”Ÿä»£å¡æ»¡äº†ï¼ŒGC å¼€å§‹æ¸…ç† æ–°ç”Ÿä»£é‡Œçš„æ­»å¯¹è±¡ï¼Œjerry å› ä¸ºè¿˜å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œæ‰€ä»¥æ²¡è¢«æ¸…ç†å‡ºå»ï¼›</p><p>2ï¼‰GC æ¸…ç†äº†ä¸¤éæ–°ç”Ÿä»£ï¼Œå‘ç° jerry ä¾ç„¶è¿˜æ´»è·ƒç€ï¼Œå°±æŠŠ jerry ç§»åŠ¨åˆ°äº†è€ç”Ÿä»£</p><p>3ï¼‰éšç€ç¨‹åºçš„è¿è¡Œï¼Œè€ç”Ÿä»£ä¹Ÿå¡æ»¡äº†ï¼ŒGC å¼€å§‹æ¸…ç†è€ç”Ÿä»£ï¼Œè¿™æ—¶å€™å‘ç° jerry å·²ç»æ²¡æœ‰è¢«å¼•ç”¨äº†ï¼Œå°±æŠŠ jerry ç»™æ¸…ç†å‡ºå»äº†ã€‚</p><h5 id="æ–°è€ç”Ÿä»£åƒåœ¾å›æ”¶æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#æ–°è€ç”Ÿä»£åƒåœ¾å›æ”¶æ–¹å¼" aria-hidden="true">#</a> æ–°è€ç”Ÿä»£åƒåœ¾å›æ”¶æ–¹å¼</h5><p>æ–°è€ç”Ÿä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•æ¥æé«˜æ•ˆç‡ï¼Œå¯¹è±¡æœ€å¼€å§‹éƒ½ä¼šå…ˆè¢«åˆ†é…åˆ°æ–°ç”Ÿä»£ï¼ˆå¦‚æœæ–°ç”Ÿä»£å†…å­˜ç©ºé—´ä¸å¤Ÿï¼Œç›´æ¥åˆ†é…åˆ°è€ç”Ÿä»£ï¼‰ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ä¼šåœ¨æ»¡è¶³æŸäº›æ¡ä»¶åï¼Œè¢«ç§»åŠ¨åˆ°è€ç”Ÿä»£ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå«æ™‹å‡</p><p><strong>æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶æ–¹å¼</strong></p><p>å°†å†…å­˜ç©ºé—´ä¸€åˆ†ä¸ºäºŒï¼Œåˆ†ä¸º From ç©ºé—´ï¼ˆä½¿ç”¨çŠ¶æ€ï¼‰ï¼Œ To ç©ºé—´ï¼ˆé—²ç½®çŠ¶æ€ï¼‰</p><p>å½“æ–°ç”Ÿä»£å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šå°† From ç©ºé—´ä¸­å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°åˆ° To ç©ºé—´ï¼Œç„¶åå°† From ç©ºé—´æ¸…ç©ºï¼Œäº¤æ¢ From ç©ºé—´å’Œ To ç©ºé—´ï¼ˆå°†åŸæ¥çš„ From ç©ºé—´å˜ä¸º To ç©ºé—´ï¼‰ï¼Œç»§ç»­ä¸‹ä¸€è½®</p><p><strong>è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶æ–¹å¼</strong></p><p>V8 åœ¨è€ç”Ÿä»£ä¸­ä¸»è¦é‡‡ç”¨äº† Mark-Sweep å’Œ Mark-Compact ç›¸ç»“åˆçš„æ–¹å¼</p><p>Mark-Sweep éå†å †å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œåœ¨éšåçš„æ¸…é™¤é˜¶æ®µï¼Œåªæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</p><p>Mark-Sweep æœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼Œåœ¨è¿›è¡Œæ¸…é™¤å›æ”¶ä»¥åï¼Œå†…å­˜ç©ºé—´ä¼šå‡ºç°ä¸è¿ç»­çš„çŠ¶æ€ï¼Œä¼šé€ æˆå†…å­˜ç¢ç‰‡åŒ–</p><p>Mark-Compact ç”¨æ¥è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œå°†å°†å­˜æ´»å¯¹è±¡å‘å†…å­˜ä¸€ä¾§ç§»åŠ¨ï¼Œæ¸…ç©ºå†…å­˜çš„å¦ä¸€ä¾§ï¼Œè¿™æ ·ç©ºé—²çš„å†…å­˜éƒ½æ˜¯è¿ç»­çš„</p><p><strong>åˆ†ä»£å†…å­˜</strong></p><p>64 ä½ç³»ç»Ÿï¼Œæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º 32MBï¼Œè€ç”Ÿä»£å†…å­˜ä¸º 1.4Gï¼›32 ä½ç³»ç»Ÿï¼Œæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º 16MBï¼Œè€ç”Ÿä»£å†…å­˜ä¸º 0.7G</p><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F33816534" target="_blank" rel="noopener noreferrer">V8 å†…å­˜æµ…æ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.cn/post/6981588276356317214" target="_blank" rel="noopener noreferrer">ã€Œç¡¬æ ¸ JSã€ä½ çœŸçš„äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶å—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></footer><nav class="page-nav"><a href="/coding/frontend/summary/3.%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%AF%87/" class="nav-link prev" aria-label="å·¥ç¨‹åŒ–"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->å·¥ç¨‹åŒ–</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Apache 2.0 Licensed | Copyright Â© 2022-present</div><!----></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.02ae940c.js" defer></script>
  </body>
</html>
